{"version":3,"file":"src_app_home_home_module_ts.js","mappings":"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","sources":["./src/app/home/home-routing.module.ts","./src/app/home/home.module.ts","./src/app/home/home.page.ts","./src/app/home/home.page.html","./src/app/services/geocode.service.ts","./src/app/services/map.service.ts","./src/app/services/network.service.ts","./node_modules/@capacitor/app/dist/esm/definitions.js","./node_modules/@capacitor/app/dist/esm/index.js","./node_modules/@capacitor/geolocation/dist/esm/index.js","./node_modules/@capacitor/google-maps/dist/esm/definitions.js","./node_modules/@capacitor/google-maps/dist/esm/implementation.js","./node_modules/@capacitor/google-maps/dist/esm/index.js","./node_modules/@capacitor/google-maps/dist/esm/map.js","./node_modules/rxjs/dist/esm/internal/observable/interval.js","./node_modules/@capacitor/synapse/dist/synapse.mjs"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { HomePage } from './home.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: HomePage,\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class HomePageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { HomePage } from './home.page';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\n\r\nimport { HomePageRoutingModule } from './home-routing.module';\r\n\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    HomePageRoutingModule\r\n  ],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA],\r\n  declarations: [HomePage ]\r\n    //NearbyTripsComponent]\r\n})\r\nexport class HomePageModule {}\r\n","/// <reference types=\"google.maps\" />\r\nimport { AfterViewInit, Component, ElementRef, NgZone, ViewChild } from '@angular/core';\r\nimport { Geolocation, Position } from '@capacitor/geolocation';\r\nimport { ModalOptions, ModalController, Platform, NavController, AlertController, ToastController, ActionSheetController } from '@ionic/angular';\r\nimport { AutocompleteComponent } from '../autocomplete/autocomplete.component';\r\nimport { OverlayService } from '../services/overlay.service';\r\nimport { GeocodeService } from '../services/geocode.service';\r\nimport { MapService } from '../services/map.service';\r\nimport { AvatarService } from '../services/avatar.service';\r\nimport { Drivers } from '../interfaces/drivers';\r\nimport { Observable, timer, interval, BehaviorSubject, throwError, Subscription } from 'rxjs';\r\nimport { doc as firestoreDoc, updateDoc, getDoc, collection, onSnapshot, doc, Firestore, query, where } from '@angular/fire/firestore';\r\nimport { Marker, Polyline } from '@capacitor/google-maps';\r\nimport { AuthService } from '../services/auth.service';\r\nimport { EnrouteChatComponent } from '../enroute-chat/enroute-chat.component';\r\nimport { NetworkService } from '../services/network.service'\r\nimport { Network } from '@capacitor/network';\r\nimport { Router } from '@angular/router';\r\nimport { App } from '@capacitor/app';\r\nimport { PaymentService } from '../services/payment.service';\r\nimport { AddCardComponent } from '../add-card/add-card.component';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { LatLngLiteral } from '@googlemaps/google-maps-services-js';\r\nimport { LatLng } from '@capacitor/google-maps/dist/typings/definitions';\r\nimport { Preferences } from '@capacitor/preferences';\r\nimport { Auth, onAuthStateChanged } from '@angular/fire/auth';\r\n\r\nimport { TripSummaryComponent } from '../trip-summary/trip-summary.component';\r\nimport { geohashForLocation } from 'geofire-common';\r\n\r\ndeclare var google;\r\n\r\n@Component({\r\n  selector: 'app-home',\r\n  templateUrl: 'home.page.html',\r\n  styleUrls: ['home.page.scss'],\r\n})\r\nexport class HomePage implements AfterViewInit {\r\n  [x: string]: any;\r\n  profile = null;\r\n  presets: Array<any> = [];\r\n  @ViewChild('map',  { static: true }) mapRef: ElementRef<HTMLElement>;\r\n  @ViewChild('topBar', { static: true }) topBar: ElementRef<HTMLElement>;\r\n  @ViewChild('bottomBar', { static: true }) bottomBar: ElementRef<HTMLElement>;\r\n  mappy;\r\n  @ViewChild('mapElement') mapElement: ElementRef<HTMLElement>;\r\n  coordinates: Position;\r\n  address: any = 'Unknown';\r\n  bookingStage: any;\r\n  confirmStage: any;\r\n  trackingStage: any;\r\n  searchingStage: any;\r\n  noDriverStage: any;\r\n  drivingToDestinationStage: any;\r\n  data: any;\r\n  cash: any = false;\r\n  state: any = [];\r\n  mapPinStage: boolean;\r\n  D_LatLng: { lat: any; lng: any; };\r\n  mapPinDrag: any;\r\n  showResetLocationButton: any = false;\r\n  showloader: boolean;\r\n  mapClass: any;\r\n  destinationAddress: string = 'Drag To Pick Destination';\r\n  locationAddress: string = null;\r\n  distance: any;\r\n  direction: any;\r\n  actualDestination: any;\r\n  markers: any;\r\n  allDrivers: Observable<Drivers[]>;\r\n  NoDrivers: boolean;\r\n  driverMarker: string;\r\n  driver_duration_apart: number;\r\n  driver_number_of_seats: any;\r\n  price: any = 0;\r\n  carname: any;\r\n  driver_ID: any;\r\n  bounds: any;\r\n  DriverLatLng: { lat: any; lng: any; };\r\n  drivers_Requested: any[];\r\n  current_Request_Number: number = -1;\r\n  Driver_Rejected: any;\r\n  numCalls: any;\r\n  currentDriver: any;\r\n  private countdownActive = false;\r\n\r\n  unsubscribe: import(\"@angular/fire/firestore\").Unsubscribe;\r\n  driverInfo: import(\"@angular/fire/firestore\").DocumentData;\r\n  duration: any = null;\r\n  riderCleared: any;\r\n  updateDriverSubcription: any;\r\n  canCheck: boolean;\r\n  marker1: any;\r\n  marker2: any;\r\n  actualLocation: string;\r\n  LatLng: { lat: number; lng: number; };\r\n  mapy: boolean;\r\n  AllCarMarkers: Marker[];\r\n  private _carmarkers: { id: string, marker: any }[] = [];\r\n  private rider_marker: any;\r\n  private driver_marker: any;\r\n\r\n  cards: import(\"@angular/fire/firestore\").DocumentData[];\r\n  selected: any;\r\n  selectedCard: any;\r\n  closeDrivers: any;\r\n  countDown: any;\r\n  places: import(\"@angular/fire/firestore\").DocumentData[];\r\n  newPoly: string[];\r\n  isConnected: boolean;\r\n  private networkStatus$ = new BehaviorSubject<boolean>(true);\r\n  pollingInterval: any;\r\n  animatedMarker: any;\r\n  driverImage: any;\r\n  private permissionCheckInterval: any;\r\n  savedPaymentMethods: any;\r\n  requestID: string;\r\n  rideHasStarted: boolean;\r\n  driverLocation: { lat: number, lng: number } | null = null;\r\n  stopPolling: boolean = false;\r\n  riderMarker: string;\r\n  routePath: google.maps.MVCArray<google.maps.LatLng> | (google.maps.LatLng | google.maps.LatLngLiteral)[];\r\n  destinationMarker: any;\r\n  D_duration: any;\r\n  routePolyline: any;\r\n  paymentProcessed: boolean = false;\r\n  processingPaymentForRide: string | null = null; // Track which ride payment is being processed for\r\n  private routeUpdateSubscription: Subscription;\r\n  topBarHeight: any;\r\n  bottomBarHeight:any;\r\n  private readonly RIDE_STATE_KEY = 'activeRideState';\r\n  private isLoadingDriver = false;\r\n\r\n  // Add these stage constants at the class level\r\n  private readonly STAGES = {\r\n    BOOKING: 'booking',\r\n    CONFIRM: 'confirm',\r\n    TRACKING: 'tracking',\r\n    SEARCHING: 'searching',\r\n    DRIVING: 'driving',\r\n    NO_DRIVER: 'noDriver',\r\n    MAP_PIN: 'mapPin',\r\n    NO_DRIVERS: 'noDrivers'\r\n  } as const;\r\n\r\n  // Add this to your class properties\r\n  private lastHandledState: string | null = null;\r\n\r\n  // Add this property to the class\r\n  private isRideStopProcessed = false;\r\n\r\n  // Update interval for route tracking (in milliseconds)\r\n  private readonly UPDATE_INTERVAL = 5000; // Update every 5 seconds\r\n\r\n  constructor(\r\n    private auth: Auth,\r\n    private authService: AuthService,\r\n    private router: Router,\r\n    private networkService: NetworkService,\r\n    public map: MapService,\r\n    private nav: NavController,\r\n    private platform: Platform,\r\n    private firestore: Firestore,\r\n    private readonly database: AvatarService,\r\n    private ngZone: NgZone,\r\n    private geocode: GeocodeService,\r\n    private overlay: OverlayService,\r\n    private modalCtrl: ModalController,\r\n    private alert: AlertController,\r\n    private payME: PaymentService,\r\n    private toastController: ToastController,\r\n    private actionSheetController: ActionSheetController\r\n  \r\n  ) {\r\n    this.initializeApp();\r\n  }\r\n\r\n  async ngOnDestroy() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    // window.removeEventListener('resize', this.setMapHeight.bind(this));\r\n    this.clearSubscriptions();\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n  }\r\n\r\n\r\n  async ionViewWillEnter() {\r\n    // Refresh payment methods every time the view is entered\r\n    await this.fetchSavedPaymentMethods();\r\n  }\r\n\r\n  async ngAfterViewInit() {\r\n    try {\r\n      // First check location permissions\r\n      const hasPermission = await this.checkAndRequestLocationPermissions();\r\n      if (!hasPermission) {\r\n        return;\r\n      }\r\n      \r\n      // Initialize profile first\r\n      await this.initializeProfile();\r\n      \r\n      // Then proceed with other initializations\r\n      await this.initializeApp();\r\n      await this.initializeNetworkMonitoring();\r\n      await this.fetchSavedPaymentMethods();\r\n  // load user preset places (localStorage-backed)\r\n  await this.loadPresets();\r\n      \r\n      // Initialize geolocation and map BEFORE entering booking stage\r\n      await this.initializeGeolocation();\r\n      await this.initializeMap();\r\n      \r\n      // Now it's safe to enter booking stage (map is initialized)\r\n      this.EnterBookingStage();\r\n      \r\n      // Set up real-time listener for ride state\r\n      this.initializeRideStateListener();\r\n    } catch (e) {\r\n      console.log('Error in ngAfterViewInit:', e);\r\n      //this.overlay.hideLoader();\r\n      //this.overlay.showAlert('Error', 'An error occurred during initialization. Please try again.');\r\n    }\r\n  }\r\n\r\n  // Preset places management (localStorage)\r\n  async loadPresets() {\r\n    try {\r\n      const raw = localStorage.getItem('presetPlaces');\r\n      if (raw) {\r\n        this.presets = JSON.parse(raw);\r\n      } else {\r\n        // default presets\r\n        this.presets = [\r\n          { name: 'Queensbay Mall, Penang', address: 'Queensbay Mall, Bayan Lepas, Penang', lat: 5.2939, lng: 100.2719 },\r\n          { name: 'George Town Ferry Terminal', address: 'Weld Quay, George Town, Penang', lat: 5.4141, lng: 100.3294 }\r\n        ];\r\n        localStorage.setItem('presetPlaces', JSON.stringify(this.presets));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load presets', e);\r\n      this.presets = [];\r\n    }\r\n  }\r\n\r\n  async savePresets() {\r\n    try {\r\n      localStorage.setItem('presetPlaces', JSON.stringify(this.presets));\r\n    } catch (e) {\r\n      console.error('Failed to save presets', e);\r\n    }\r\n  }\r\n\r\n  // Add current destination as preset\r\n  async addCurrentAsPreset() {\r\n    try {\r\n      if (!this.destinationAddress || !this.D_LatLng || !this.D_LatLng.lat) {\r\n        const alert = await this.alert.create({\r\n          header: 'Add preset',\r\n          message: 'Please choose a destination on the map first (pin or search).',\r\n          buttons: ['OK']\r\n        });\r\n        await alert.present();\r\n        return;\r\n      }\r\n\r\n      const name = this.destinationAddress || 'New Place';\r\n      this.presets.unshift({ name, address: name, lat: this.D_LatLng.lat, lng: this.D_LatLng.lng });\r\n      // keep only latest 10\r\n      if (this.presets.length > 10) this.presets.length = 10;\r\n      await this.savePresets();\r\n    } catch (e) {\r\n      console.error('Error adding preset', e);\r\n    }\r\n  }\r\n\r\n  // Delete preset by index\r\n  async deletePreset(i: number) {\r\n    this.presets.splice(i, 1);\r\n    await this.savePresets();\r\n  }\r\n\r\n  // Select a preset: set destination and trigger directions\r\n  async selectPreset(preset: any) {\r\n    try {\r\n      this.destinationAddress = preset.name || preset.address || '';\r\n      if (preset.lat && preset.lng) {\r\n        this.D_LatLng = { lat: preset.lat, lng: preset.lng };\r\n        // trigger distance/directions calculation\r\n        await this.getDistanceAndDirections();\r\n      } else {\r\n        // fallback: if no coords, open autocomplete modal with address prefilled\r\n        // set data for modal then open it\r\n        await this.showAutocompleteModal();\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to select preset', e);\r\n    }\r\n  }\r\n\r\n  // Add this new method\r\n  private async initializeProfile() {\r\n    try {\r\n      // Show loader while initializing profile\r\n     // await this.overlay.showLoader('Loading profile...');\r\n\r\n      // Wait for auth state to be ready\r\n      const user = await new Promise<any>((resolve) => {\r\n        const unsubscribe = onAuthStateChanged(this.auth, (user) => {\r\n          unsubscribe();\r\n          resolve(user);\r\n        });\r\n      });\r\n\r\n      if (!user) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n\r\n      // Get profile data\r\n      this.profile = await this.database.getUserProfile();\r\n      \r\n      if (!this.profile) {\r\n        console.log('Creating new profile...');\r\n        // If profile doesn't exist, create it with default values\r\n        this.profile = {\r\n          userId: user.uid,\r\n          email: user.email,\r\n          createdAt: new Date().toISOString(),\r\n          // Add any other default profile fields you need\r\n        };\r\n        await this.database.createUserProfile(this.profile);\r\n      }\r\n\r\n      console.log('Profile initialized:', this.profile);\r\n      this.overlay.hideLoader();\r\n    } catch (error) {\r\n      console.error('Error initializing profile:', error);\r\n      this.overlay.hideLoader();\r\n      await this.overlay.showAlert(\r\n        'Profile Error',\r\n        'Unable to initialize user profile. Please try again or contact support.'\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Add this method to check profile before any ride-related action\r\n  private async ensureProfileInitialized(): Promise<boolean> {\r\n    if (!this.profile) {\r\n      try {\r\n        await this.initializeProfile();\r\n        return true;\r\n      } catch (error) {\r\n        console.error('Error ensuring profile is initialized:', error);\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private initializeRideStateListener() {\r\n    console.log('Initializing ride state listener');\r\n    \r\n    // Reset lastHandledState on initialization to ensure proper state restoration\r\n    this.lastHandledState = null;\r\n    \r\n    onAuthStateChanged(this.auth, (user) => {\r\n      if (!user) return;\r\n\r\n      // Listen to the Request collection for active rides for this user\r\n      const requestsQuery = query(\r\n        collection(this.firestore, 'Request'),\r\n        where('Rider_id', '==', user.uid),\r\n        where('status', 'in', ['pending', 'confirmed', 'started'])\r\n      );\r\n\r\n      this.unsubscribe = onSnapshot(requestsQuery, async (snapshot) => {\r\n        try {\r\n          // If no active rides found, go to booking stage\r\n          if (snapshot.empty) {\r\n            console.log('No active rides found');\r\n            this.setStage(this.STAGES.BOOKING);\r\n            return;\r\n          }\r\n\r\n          // Get the most recent active ride\r\n          const activeRides = snapshot.docs;\r\n          const currentRide = activeRides[0];\r\n          const rideData = currentRide.data();\r\n          this.requestID = currentRide.id;\r\n\r\n          // Restore price information\r\n          this.price = rideData.price || 0;\r\n          console.log('Restored ride price:', this.price);\r\n          console.log('Current ride status:', rideData.status);\r\n\r\n          // IMPORTANT: On app initialization, always restore ride state regardless of lastHandledState\r\n          const isAppInitialization = !this.lastHandledState;\r\n          \r\n          // Only skip if we've already handled this state AND it's not initial app load\r\n          if (this.lastHandledState === rideData.status && !isAppInitialization) {\r\n            console.log('State already properly handled:', rideData.status);\r\n            return;\r\n          }\r\n\r\n          // Store location data for later use\r\n          if (rideData.Loc_lat && rideData.Loc_lng) {\r\n            this.LatLng = {\r\n              lat: rideData.Loc_lat,\r\n              lng: rideData.Loc_lng\r\n            };\r\n          }\r\n          \r\n          if (rideData.Des_lat && rideData.Des_lng) {\r\n            this.D_LatLng = {\r\n              lat: rideData.Des_lat,\r\n              lng: rideData.Des_lng\r\n            };\r\n          }\r\n          \r\n          // Store addresses\r\n          this.locationAddress = rideData.Rider_Location || 'Unknown location';\r\n          this.destinationAddress = rideData.Rider_Destination || 'Unknown destination';\r\n\r\n          console.log('Restoring ride state:', rideData.status);\r\n\r\n          // Handle different ride states\r\n          switch (rideData.status) {\r\n            case 'pending':\r\n              await this.handlePendingState();\r\n              break;\r\n            case 'confirmed':\r\n              console.log('Handling confirmed state on restore...');\r\n              await this.handleRideConfirmation(rideData);\r\n              break;\r\n            case 'started':\r\n              await this.handleRideStart(currentRide);\r\n              break;\r\n            case 'cancelled':\r\n              await this.handleRideCancellation(rideData);\r\n              break;\r\n            default:\r\n              console.log('Unknown ride status:', rideData.status);\r\n              this.setStage(this.STAGES.BOOKING);\r\n          }\r\n          \r\n          // Only update lastHandledState AFTER successful handling\r\n          this.lastHandledState = rideData.status;\r\n          \r\n        } catch (error) {\r\n          console.error('Error handling ride state:', error);\r\n          if (error.code === 'permission-denied' || error.code === 'not-found') {\r\n            this.overlay.showAlert('Error', 'Failed to restore ride state. Please try again.');\r\n            this.setStage(this.STAGES.BOOKING);\r\n          }\r\n        }\r\n      }, (error) => {\r\n        console.error('Error in ride state listener:', error);\r\n        this.setStage(this.STAGES.BOOKING);\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  private handleRemovedRide() {\r\n    console.log('Ride was removed');\r\n    this.clearRideData();\r\n    this.setStage(this.STAGES.BOOKING);\r\n  }\r\n\r\n  private clearRideData() {\r\n    this.requestID = null;\r\n    this.driverInfo = null;\r\n    this.rideHasStarted = false;\r\n    this.lastHandledState = null;\r\n    this.paymentProcessed = false; // Reset payment flag\r\n    this.processingPaymentForRide = null; // Reset processing flag\r\n    // Clear any other ride-specific data\r\n  }\r\n\r\n  async checkAndRequestLocationPermissions() {\r\n    try {\r\n      // Check if running on web platform\r\n      if (this.platform.is('capacitor')) {\r\n        const permissionStatus = await Geolocation.checkPermissions();\r\n        \r\n        if (permissionStatus.location === 'granted') {\r\n          this.overlay.hideLoader();\r\n          return true;\r\n        }\r\n\r\n        const alert = await this.alert.create({\r\n          header: 'Location Permission Required',\r\n          message: 'This app needs access to your location to function properly.',\r\n          buttons: [\r\n            {\r\n              text: 'Enable Location',\r\n              handler: async () => {\r\n                const newStatus = await Geolocation.requestPermissions();\r\n                this.overlay.hideLoader();\r\n                \r\n                if (newStatus.location !== 'granted') {\r\n                  await this.showLocationRequiredAlert();\r\n                  return false;\r\n                }\r\n                return true;\r\n              }\r\n            }\r\n          ],\r\n          backdropDismiss: false\r\n        });\r\n\r\n        await alert.present();\r\n        const { role } = await alert.onDidDismiss();\r\n        \r\n        if (role === 'backdrop') {\r\n          this.overlay.hideLoader();\r\n          await this.showLocationRequiredAlert();\r\n          return false;\r\n        }\r\n      } else {\r\n        // Web platform - use browser's geolocation API\r\n        if ('geolocation' in navigator) {\r\n          return new Promise((resolve) => {\r\n            navigator.permissions.query({ name: 'geolocation' }).then((result) => {\r\n              if (result.state === 'granted') {\r\n                this.overlay.hideLoader();\r\n                resolve(true);\r\n              } else {\r\n                this.overlay.hideLoader();\r\n                resolve(this.showWebLocationPrompt());\r\n              }\r\n            });\r\n          });\r\n        } else {\r\n          this.overlay.hideLoader();\r\n          await this.overlay.showAlert('Error', 'Geolocation is not supported in this browser.');\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error checking/requesting location permissions:', error);\r\n      this.overlay.hideLoader();\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async showWebLocationPrompt(): Promise<boolean> {\r\n    const alert = await this.alert.create({\r\n      header: 'Location Access',\r\n      message: 'This app needs your location. Please allow location access when prompted by your browser.',\r\n      buttons: [\r\n        {\r\n          text: 'OK',\r\n          handler: () => {\r\n            return new Promise((resolve) => {\r\n              navigator.geolocation.getCurrentPosition(\r\n                () => resolve(true),\r\n                () => {\r\n                  this.showLocationRequiredAlert();\r\n                  resolve(false);\r\n                }\r\n              );\r\n            });\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n    return true;\r\n  }\r\n\r\n  private async showLocationRequiredAlert() {\r\n    const alert = await this.alert.create({\r\n      header: 'Location Required',\r\n      message: 'Location permission is required to use this app. Please enable location services in your device settings.',\r\n      buttons: ['OK']\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async fetchSavedPaymentMethods() {\r\n    try {\r\n      this.savedPaymentMethods = await this.database.getSavedPaymentMethods();\r\n      console.log('Saved Payment Methods:', this.savedPaymentMethods);\r\n      \r\n      // Set default payment method to cash if no cards are saved\r\n      if (this.savedPaymentMethods.length === 0) {\r\n        this.selectedCard = 'cash';\r\n        this.cash = true;\r\n      } else {\r\n        this.selectedCard = this.savedPaymentMethods[0].cardId;\r\n        this.cash = false;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching saved payment methods:', error);\r\n    }\r\n  }\r\n\r\n  chooseCard(event: any) {\r\n    const selectedValue = event.detail.value;\r\n    \r\n    // Handle the \\\"Add Card\\\" option\r\n    if (selectedValue === 'add_card') {\r\n      this.openAddCardModal();\r\n      // Reset to previous selection if user cancels or if no cards after modal\r\n      if (!this.selectedCard || this.selectedCard === 'add_card') {\r\n        this.selectedCard = this.savedPaymentMethods.length > 0 ? this.savedPaymentMethods[0].cardId : 'cash';\r\n        this.cash = this.selectedCard === 'cash';\r\n      }\r\n      return;\r\n    }\r\n    \r\n    this.selectedCard = selectedValue;\r\n    this.cash = this.selectedCard === 'cash';\r\n    if (!this.cash) {\r\n     // this.processPayment(this.authService.user.email, this.defaultAmount, this.selectedCard);\r\n    }\r\n  }\r\n\r\n  // async processPayment(email: string, amount: number, cardId: any) {\r\n  //   //this.overlay.showLoader('Processing payment...');\r\n\r\n  //   try {\r\n  //     const paymentResult = await this.payME.processPaymentWithCardId(email, amount, cardId).toPromise();\r\n  //     console.log('Payment successful:', paymentResult);\r\n  //     await this.overlay.showAlert('Success', 'Payment successful!');\r\n  //   } catch (error) {\r\n  //     console.error('Error during payment:', error);\r\n  //     const errorMessage = error.error ? error.error.error : 'An unexpected error occurred.';\r\n  //     await this.showPaymentErrorModal(errorMessage);\r\n  //   } finally {\r\n  //     //this.overlay.hideLoader();\r\n  //   }\r\n  // }\r\n\r\n  async processRidePayment(rideData: any) {\r\n    try {\r\n      // Check if payment was already processed for this ride\r\n      if (this.paymentProcessed) {\r\n        console.log('Payment already processed for this ride, skipping...');\r\n        return;\r\n      }\r\n\r\n      // Check if payment was already processed in the database\r\n      const rideRef = doc(this.firestore, 'Request', this.requestID);\r\n      const rideDoc = await getDoc(rideRef);\r\n      const existingData = rideDoc.data();\r\n      \r\n      if (existingData?.paymentProcessed) {\r\n        console.log('Payment already processed in database, skipping...');\r\n        this.paymentProcessed = true;\r\n        return;\r\n      }\r\n      \r\n      console.log('Processing ride payment...');\r\n      \r\n      // Validate price before processing\r\n      if (!this.price || typeof this.price !== 'number' || this.price <= 0) {\r\n        console.error('Invalid price for payment:', this.price);\r\n        throw new Error('Invalid price amount');\r\n      }\r\n      \r\n      // Calculate split: 80% to driver, 20% to company\r\n      const totalAmount = Math.round(this.price * 100); // Convert to cents\r\n      \r\n      // Stripe requires minimum 50 cents\r\n      if (totalAmount < 50) {\r\n        console.error('Amount too small for Stripe:', totalAmount);\r\n        throw new Error('Payment amount is too small (minimum $0.50)');\r\n      }\r\n      \r\n      const driverAmount = Math.round(totalAmount * 0.80);\r\n      const companyAmount = totalAmount - driverAmount;\r\n      \r\n      console.log('Payment amounts - Total:', totalAmount, 'cents, Driver:', driverAmount, 'cents, Company:', companyAmount, 'cents');\r\n      \r\n      // Validate required fields\r\n      if (!this.selectedCard || this.selectedCard === 'cash') {\r\n        console.error('Invalid payment method:', this.selectedCard);\r\n        throw new Error('No valid payment method selected');\r\n      }\r\n      \r\n      if (!this.database.user?.email) {\r\n        console.error('User email not found');\r\n        throw new Error('User email is required for payment');\r\n      }\r\n      \r\n      if (!this.requestID) {\r\n        console.error('Request ID not found');\r\n        throw new Error('Ride ID is required for payment');\r\n      }\r\n      \r\n      const paymentData = {\r\n        email: this.database.user.email,\r\n        amount: totalAmount,\r\n        currency: 'usd',\r\n        paymentMethodId: this.selectedCard,\r\n        driverId: rideData.driverDetails?.Driver_id || this.driverInfo?.Driver_id || '',\r\n        rideId: this.requestID,\r\n        driverAmount: driverAmount,\r\n        companyAmount: companyAmount,\r\n        description: `Ride from ${this.locationAddress || 'pickup'} to ${this.destinationAddress || 'destination'}`\r\n      };\r\n      \r\n      console.log('Payment data:', JSON.stringify(paymentData, null, 2));\r\n      \r\n      // Show loading indicator using overlay service\r\n      //this.overlay.showLoader('Processing payment...');\r\n      \r\n      // Process the payment\r\n      const paymentResult = await this.payME.processRidePayment(paymentData).toPromise();\r\n      \r\n      //this.overlay.hideLoader();\r\n      \r\n      if (paymentResult.success) {\r\n        console.log('Payment processed successfully:', paymentResult);\r\n        \r\n        // Mark payment as processed FIRST\r\n        this.paymentProcessed = true;\r\n        \r\n        // Update ride document with payment information\r\n        await updateDoc(doc(this.firestore, 'Request', this.requestID), {\r\n          paymentProcessed: true,\r\n          paymentIntentId: paymentResult.paymentIntentId,\r\n          paymentAmount: totalAmount,\r\n          paymentTimestamp: new Date(),\r\n          driverAmount: driverAmount,\r\n          companyAmount: companyAmount\r\n        });\r\n        \r\n        // Show success toast\r\n        const toast = await this.toastController.create({\r\n          message: 'Payment processed successfully',\r\n          duration: 2000,\r\n          position: 'bottom',\r\n          color: 'success'\r\n        });\r\n        await toast.present();\r\n      } else {\r\n        throw new Error(paymentResult.error || 'Payment failed');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error processing ride payment:', error);\r\n      this.overlay.hideLoader();\r\n      \r\n      // Extract meaningful error message\r\n      let errorMessage = 'Payment could not be processed.';\r\n      if (error?.error?.error) {\r\n        errorMessage = error.error.error;\r\n      } else if (error?.message) {\r\n        errorMessage = error.message;\r\n      } else if (typeof error === 'string') {\r\n        errorMessage = error;\r\n      }\r\n      \r\n      console.error('Payment error details:', errorMessage);\r\n      \r\n      // Show error to user but don't cancel the ride\r\n      const alert = await this.alert.create({\r\n        header: 'Payment Error',\r\n        message: `${errorMessage}\\n\\nYou can pay cash to the driver instead.`,\r\n        buttons: [\r\n          {\r\n            text: 'Pay Cash',\r\n            handler: async () => {\r\n              // Switch to cash payment\r\n              this.cash = true;\r\n              this.paymentProcessed = true; // Mark as processed to prevent retry\r\n              if (this.requestID) {\r\n                await updateDoc(doc(this.firestore, 'Request', this.requestID), {\r\n                  cash: true,\r\n                  paymentMethod: 'cash',\r\n                  paymentProcessed: true\r\n                });\r\n              }\r\n            }\r\n          },\r\n          {\r\n            text: 'Retry Payment',\r\n            handler: async () => {\r\n              // Reset the flag before retrying\r\n              this.paymentProcessed = false;\r\n              await this.processRidePayment(rideData);\r\n            }\r\n          }\r\n        ]\r\n      });\r\n      await alert.present();\r\n    }\r\n  }\r\n\r\n  async showPaymentErrorModal(errorMessage: string) {\r\n    const alert = await this.alert.create({\r\n      header: 'Payment Error',\r\n      message: errorMessage,\r\n      buttons: [\r\n        {\r\n          text: 'Add New Card',\r\n          handler: async () => {\r\n            await this.openAddCardModal();\r\n          }\r\n        },\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async openAddCardModal() {\r\n    const modal = await this.modalCtrl.create({\r\n      component: AddCardComponent,\r\n    });\r\n    await modal.present();\r\n    const { data } = await modal.onWillDismiss();\r\n    if (data && data.success) {\r\n      // Refresh payment methods after adding a card\r\n      await this.fetchSavedPaymentMethods();\r\n      // Select the newly added card if available\r\n      if (this.savedPaymentMethods.length > 0) {\r\n        this.selectedCard = this.savedPaymentMethods[this.savedPaymentMethods.length - 1].cardId;\r\n        this.cash = false;\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n    async updateMapPadding(bottomPadding: number) {\r\n    if (this.map && this.map.newMap) {\r\n      await this.map.newMap.setPadding({\r\n        top: 0,\r\n        left: 0,\r\n        right: 0,\r\n        bottom: bottomPadding\r\n      });\r\n    }\r\n  }\r\n\r\n  setMapHeight() {\r\n    this.updateMapPadding(0);\r\n  }\r\n\r\n  setMapHeightCreateAndAddMarkers() {\r\n    this.updateMapPadding(40);\r\n  }\r\n\r\n  setMapHeightHandleDrivertoRider() {\r\n    this.updateMapPadding(20);\r\n  }\r\n\r\n  setMapHeightHandleDrivertoDestination() {\r\n    this.updateMapPadding(0);\r\n  }\r\n\r\n  ResetMapHeight() {\r\n    this.updateMapPadding(0);\r\n  }\r\n\r\n  private async initializeNetworkMonitoring() {\r\n    const status = await Network.getStatus();\r\n    this.isConnected = status.connected;\r\n    this.networkStatus$.next(this.isConnected);\r\n    console.log('Network monitoring initialized. Initial status:', this.isConnected);\r\n\r\n    Network.addListener('networkStatusChange', (status) => {\r\n      console.log('Network status changed:', status);\r\n      this.isConnected = status.connected;\r\n      this.networkStatus$.next(this.isConnected);\r\n    });\r\n\r\n    this.networkStatus$.subscribe((isConnected) => {\r\n      if (isConnected) {\r\n        this.router.navigate(['home']);\r\n      } else {\r\n        this.router.navigate(['network']);\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  initializeApp() {\r\n    this.platform.ready().then(async () => {\r\n      try {\r\n        await this.initializeRideStateListener();\r\n      } catch (error) {\r\n        console.error('Error initializing app:', error);\r\n        this.setStage(this.STAGES.BOOKING);\r\n      }\r\n    });\r\n  }\r\n\r\n  \r\n \r\n  async initializeGeolocation() {\r\n    try {\r\n      let coordinates;\r\n      \r\n      if (this.platform.is('capacitor')) {\r\n        coordinates = await Geolocation.getCurrentPosition({\r\n          timeout: 10000\r\n        });\r\n      } else {\r\n        // Web fallback\r\n        coordinates = await new Promise((resolve, reject) => {\r\n          navigator.geolocation.getCurrentPosition(\r\n            (position) => {\r\n              resolve({\r\n                coords: {\r\n                  latitude: position.coords.latitude,\r\n                  longitude: position.coords.longitude,\r\n                  accuracy: position.coords.accuracy,\r\n                  altitude: position.coords.altitude,\r\n                  altitudeAccuracy: position.coords.altitudeAccuracy,\r\n                  heading: position.coords.heading,\r\n                  speed: position.coords.speed\r\n                },\r\n                timestamp: position.timestamp\r\n              });\r\n            },\r\n            (error) => reject(error),\r\n            { timeout: 10000 }\r\n          );\r\n        });\r\n      }\r\n      \r\n      this.coordinates = coordinates;\r\n      this.LatLng = {\r\n        lat: coordinates.coords.latitude,\r\n        lng: coordinates.coords.longitude\r\n      };\r\n      \r\n      await this.database.updateLocation(this.LatLng);\r\n      console.log('Geolocation initialized:', this.LatLng);\r\n      \r\n      this.startPollingPosition();\r\n    } catch (error) {\r\n      console.error('Error initializing geolocation:', error);\r\n      this.overlay.hideLoader();\r\n      await this.overlay.showAlert(\r\n        'Location Error',\r\n        'Unable to get your location. Please check your device settings and try again.'\r\n      );\r\n    }\r\n  }\r\n  \r\n  startPermissionPolling() {\r\n    this.permissionCheckInterval = setInterval(async () => {\r\n      const permissionStatus = await Geolocation.checkPermissions();\r\n      if (permissionStatus.location === 'granted') {\r\n        this.overlay.hideLoader();\r\n        clearInterval(this.permissionCheckInterval);\r\n        // Try to get the current position again if permissions are granted\r\n        const coordinates = await Geolocation.getCurrentPosition();\r\n        this.coordinates = coordinates;\r\n        this.LatLng = {\r\n          lat: coordinates.coords.latitude,\r\n          lng: coordinates.coords.longitude,\r\n        };\r\n        console.log('Geolocation initialized:', this.LatLng);\r\n  \r\n        // Start polling the user's position\r\n        this.startPollingPosition();\r\n      }\r\n    }, 1000); // Check every second\r\n  }\r\n\r\n  \r\n  startPollingPosition() {\r\n    let lastLatLng = { lat: null, lng: null };\r\n    let lastAddress = null;\r\n  \r\n    this.pollingInterval = setInterval(async () => {\r\n      try {\r\n        let position;\r\n        \r\n        if (this.platform.is('capacitor')) {\r\n          position = await Geolocation.getCurrentPosition();\r\n        } else {\r\n          // Web fallback\r\n          position = await new Promise((resolve, reject) => {\r\n            navigator.geolocation.getCurrentPosition(resolve, reject);\r\n          });\r\n        }\r\n\r\n        const newLatLng = {\r\n          lat: position.coords.latitude,\r\n          lng: position.coords.longitude,\r\n        };\r\n\r\n        await this.database.updateLocation(newLatLng);\r\n  \r\n        if (this.hasSignificantLocationChange(lastLatLng, newLatLng, 50)) { // Check if moved at least 50 meters\r\n          lastLatLng = newLatLng;\r\n  \r\n          const address = await this.map.getAddress(newLatLng.lat, newLatLng.lng);\r\n          \r\n          if (address && address.results && address.results.length > 1) {\r\n            const components = address.results[1].address_components;\r\n            if (components.length >= 2) {\r\n              this.locationAddress = components[0].long_name + ' ' + components[1].long_name;\r\n              this.actualLocation = address.results[0].formatted_address;\r\n              if (this.locationAddress !== lastAddress) {\r\n                console.log('Updated Location Address:', this.locationAddress);\r\n                lastAddress = this.locationAddress;\r\n              }\r\n            }\r\n          } else {\r\n            console.log('Unable to update location address');\r\n          }\r\n        }\r\n  \r\n        if (this.networkService.isConnected() && !this.stopPolling) {\r\n          const center: [number, number] = [newLatLng.lat, newLatLng.lng];\r\n          const radiusInM = 8000; // Example radius in meters\r\n          await this.fetchAndDisplayDrivers(center, radiusInM);\r\n        } else {\r\n          console.log('No network connection.', this.stopPolling);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error getting position:', err);\r\n        // Reduce error alerts by not showing specific errors repeatedly\r\n      }\r\n    }, 3000); // Poll every 3 seconds for more responsive location updates\r\n  }\r\n  \r\n  hasSignificantLocationChange(oldLatLng, newLatLng, minDistance) {\r\n    if (!oldLatLng.lat || !oldLatLng.lng) return true;\r\n    \r\n    const R = 6371e3; // Earth radius in meters\r\n    const 1 = oldLatLng.lat * Math.PI/180;\r\n    const 2 = newLatLng.lat * Math.PI/180;\r\n    const  = (newLatLng.lat - oldLatLng.lat) * Math.PI/180;\r\n    const  = (newLatLng.lng - oldLatLng.lng) * Math.PI/180;\r\n  \r\n    const a = Math.sin(/2) * Math.sin(/2) +\r\n              Math.cos(1) * Math.cos(2) *\r\n              Math.sin(/2) * Math.sin(/2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n  \r\n    const distance = R * c; // Distance in meters\r\n  \r\n    return distance >= minDistance;\r\n  }\r\n\r\n  \r\n  stopPollingPosition() {\r\n    if (this.pollingInterval) {\r\n      clearInterval(this.pollingInterval);\r\n      this.pollingInterval = null;\r\n      console.log('Stopped polling position.');\r\n    } else {\r\n      console.log('No polling to stop.');\r\n    }\r\n  }\r\n  \r\n  async initializeMap() {\r\n    try {\r\n      // Ensure coordinates are available before creating map\r\n      \r\n      if (!this.coordinates || !this.coordinates.coords) {\r\n         await this.overlay.showAlert('Coordinates not available, using default location', '');\r\n        console.warn('Coordinates not available, using default location');\r\n        // Use default coordinates (Kuala Lumpur, Malaysia)\r\n        this.coordinates = {\r\n          coords: {\r\n            latitude: 3.1390,\r\n            longitude: 101.6869,\r\n            accuracy: 0,\r\n            altitude: null,\r\n            altitudeAccuracy: null,\r\n            heading: null,\r\n            speed: null\r\n          },\r\n          timestamp: Date.now()\r\n        };\r\n      }\r\n      \r\n      await this.map.createMap(this.mapRef.nativeElement, this.coordinates);\r\n      this.mapy = true;\r\n      this.actualLocation = this.map.actualLocation;\r\n     // console.log('Map initialized:', this.actualLocation, this.locationAddress);\r\n    } catch (error) {\r\n      this.overlay.showAlert('Error initializing map:', error);\r\n      throw new Error('Map initialization failed');\r\n    }\r\n  }\r\n  \r\n  initializeDatabaseSubscriptions() {\r\n    this.database.getKnownPlaces().subscribe((d) => {\r\n      console.log('Received data:', d);\r\n      this.places = d.slice(0, 3);\r\n    });\r\n  }\r\n\r\n\r\n  initializeBackButtonCustomHandler(): void {\r\n    this.platform.backButton.subscribeWithPriority(10, () => {\r\n      console.log('Back button pressed');\r\n    });\r\n  \r\n    App.addListener('backButton', ({ canGoBack }) => {\r\n      if (!canGoBack) {\r\n        // Show a confirmation dialog before exiting the app\r\n        if (confirm('Are you sure you want to exit the app?')) {\r\n          App.exitApp();\r\n        }\r\n      } else {\r\n        console.log(\"back clicked\");\r\n        // Use Ionic's NavController to navigate back\r\n        // Replace 'NavController' with your specific navigation method\r\n        // this.navCtrl.pop();\r\n        window.history.back();\r\n      }\r\n    });\r\n\r\n    // App.addListener('appStateChange', (state) => {\r\n    //   if (!state.isActive) {\r\n    //     this.stopPollingPosition();\r\n    //   } else {\r\n    //     this.startPollingPosition();\r\n    //   }\r\n    // });\r\n  }\r\n  \r\n\r\n\r\n  \r\n  setupMapListeners() {\r\n    this.map.newMap.setOnCameraIdleListener(async (g) => {\r\n      this.ngZone.run(async () => {\r\n        this.showResetLocationButton = true;\r\n        if (this.mapPinStage) {\r\n          const addressResponse = await this.geocode.getAddress(g.latitude, g.longitude).toPromise();\r\n          this.processAddressResponse(addressResponse);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  async logout() {\r\n    await this.authService.logout();\r\n  }\r\n  \r\n  async fetchAndDisplayDrivers(center: [number, number], radiusInM: number): Promise<void> {\r\n    try {\r\n      const drivers: Drivers[] = await this.database.checkDriversWithin(center, radiusInM);\r\n      console.log('Fetched drivers:', drivers);\r\n  \r\n      await this.handleDrivers(drivers);\r\n  \r\n      if (this.drivers_Requested.length > 0) {\r\n        this.current_Request_Number = 0; // Set to the first available driver\r\n        await this.UpdateCarMarker(this.drivers_Requested);\r\n        this.NoDrivers = false;\r\n      } else {\r\n        this.current_Request_Number = -1; // No valid driver\r\n        await this.UpdateCarMarker([]); // Clear all markers if no drivers are requested\r\n        this.NoDrivers = true;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching drivers:', error);\r\n      this.current_Request_Number = -1; // Reset the request number\r\n      await this.UpdateCarMarker([]); // Clear all markers if there's an error\r\n      this.NoDrivers = true;\r\n    }\r\n  }\r\n  \r\n  \r\n  async handleDrivers(drivers: Drivers[]) {\r\n    this.drivers_Requested = [];\r\n    this.closeDrivers = null;\r\n  \r\n    console.log('Handling drivers:', drivers);\r\n  \r\n    if (drivers.length === 0) {\r\n      this.NoDrivers = true;\r\n      console.log('No drivers found.');\r\n      return;\r\n    }\r\n  \r\n    drivers.forEach((driver) => {\r\n      if (driver) {\r\n        console.log('Processing driver:', driver);\r\n        if (driver.duration <= 1000 && driver.onlineState) {\r\n          this.drivers_Requested.push(driver);\r\n          this.updateDriverInfo(driver);\r\n        }\r\n  \r\n        if (!this.closeDrivers || driver.duration < this.closeDrivers.duration) {\r\n          this.closeDrivers = driver;\r\n        }\r\n      } else {\r\n        console.error('Driver is null or undefined:', driver);\r\n      }\r\n    });\r\n  \r\n    if (this.drivers_Requested.length === 0) {\r\n      this.NoDrivers = true;\r\n    } else {\r\n      // Ensuring current_Request_Number is within the bounds\r\n      this.current_Request_Number = Math.min(this.current_Request_Number, this.drivers_Requested.length - 1);\r\n    }\r\n  \r\n    console.log('Final requested drivers list:', this.drivers_Requested);\r\n  }\r\n  \r\n   // Unsubscribe from all active listeners (for cleanup)\r\n   cleanupListeners() {\r\n    Object.values(this.database.activeListeners).forEach(unsubscribe => unsubscribe());\r\n    this.database.activeListeners = {};\r\n  }\r\n \r\n  \r\n  updateDriverInfo(driver) {\r\n    console.log(this.drivers_Requested);\r\n    this.carname = driver.Driver_car;\r\n    this.driverImage = driver.Driver_imgUrl,\r\n    this.driver_duration_apart = Math.ceil(driver.duration / 60000);\r\n    this.driver_ID = driver.Driver_id;\r\n    this.driver_number_of_seats = driver.seats;\r\n    this.DriverLatLng = {\r\n      lat: driver.Driver_lat,\r\n      lng: driver.Driver_lng\r\n    };\r\n  }\r\n  \r\n  async StartRide() {\r\n    if (this.isLoadingDriver) {\r\n      console.log('Ride request already in progress...');\r\n      return;\r\n    }\r\n\r\n    this.isLoadingDriver = true;\r\n    this.overlay.showLoader('Preparing your ride...');\r\n\r\n    try {\r\n      // Group operations that can be done concurrently\r\n      await Promise.all([\r\n        this.clearPrevMarkers(),\r\n        this.clearAllPolylines()\r\n      ]);\r\n      \r\n      this.map.newMap.enableTouch();\r\n      await this.BookRide();\r\n      \r\n    } catch (error) {\r\n      console.error('Error starting ride:', error);\r\n      await this.overlay.showAlert('Starting Ride Error', error.message || 'Failed to start ride');\r\n    } finally {\r\n      // Ensure we always hide the loader and reset the loading state\r\n      this.isLoadingDriver = false;\r\n      this.overlay.hideLoader();\r\n    }\r\n  }\r\n\r\nasync clearMarkers() {\r\n  // Check if map is initialized\r\n  if (!this.map || !this.map.newMap) {\r\n    console.warn('Map not initialized when clearing markers');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    if (this.marker1 !== null && this.marker1 !== undefined) {\r\n      await this.map.newMap.removeMarker(this.marker1).catch(e => \r\n        console.error('Error removing marker1:', e)\r\n      );\r\n      this.marker1 = null;\r\n    }\r\n\r\n    if (this.marker2 !== null && this.marker2 !== undefined) {\r\n      await this.map.newMap.removeMarker(this.marker2).catch(e => \r\n        console.error('Error removing marker2:', e)\r\n      );\r\n      this.marker2 = null;\r\n    }\r\n\r\n    if (this._carmarkers && Array.isArray(this._carmarkers)) {\r\n      for (const { marker } of this._carmarkers) {\r\n        if (marker !== null && marker !== undefined) {\r\n          await this.map.newMap.removeMarker(marker).catch(e => \r\n            console.error('Error removing car marker:', e)\r\n          );\r\n        }\r\n      }\r\n      this._carmarkers = [];\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in clearMarkers:', error);\r\n  }\r\n}\r\n\r\nasync BookRide() {\r\n  try {\r\n    if (!await this.ensureProfileInitialized()) {\r\n      throw new Error('Profile not initialized');\r\n    }\r\n    if (!this.hasValidDriver()) {\r\n      this.showNoDriversAlert();\r\n      return;\r\n    }\r\n    \r\n    const driver = this.drivers_Requested[this.current_Request_Number];\r\n    const userDocRef = doc(this.firestore, `Drivers`, driver.Driver_id);\r\n    \r\n    const docSnapshot = await getDoc(userDocRef);\r\n    \r\n    if (!docSnapshot.exists()) {\r\n      throw new Error('Driver document not found');\r\n    }\r\n\r\n    const data = docSnapshot.data();\r\n    if (!data?.onlineState) {\r\n      await this.handleNoAvailableDriver();\r\n      return;\r\n    }\r\n\r\n    this.driverInfo = data;\r\n    await this.requestRideWithDriverDetails(driver, userDocRef);\r\n    this.updateDriverInfo(driver);\r\n    \r\n  } catch (error) {\r\n    console.error('Error in BookRide:', error);\r\n    this.overlay.showAlert('Error', 'Unable to book ride. Please try again.');\r\n  }\r\n}\r\n\r\nhasValidDriver(): boolean {\r\n  return this.drivers_Requested?.[this.current_Request_Number]?.Driver_id != null;\r\n}\r\n\r\nasync requestRideWithDriverDetails(driver, userDocRef) {\r\n  try {\r\n    if (!await this.ensureProfileInitialized()) {\r\n      throw new Error('Profile not initialized');\r\n    }\r\n    const requestDetails = {\r\n      latLng: this.LatLng,\r\n      destinationAddress: this.destinationAddress,\r\n      locationAddress: this.locationAddress,\r\n      dLatLng: this.D_LatLng,\r\n      driverId: driver.Driver_id,\r\n      price: this.price,\r\n      cash: this.cash\r\n    };\r\n\r\n    this.requestID = await this.database.RequestRideWithRiderDetails(requestDetails);\r\n\r\n    if (this.requestID) {\r\n      this.currentDriver = driver;\r\n      \r\n      // Set up listener before handling pending state\r\n      const rideRequestDocRef = doc(this.firestore, `Request`, this.requestID);\r\n      const unsub = onSnapshot(rideRequestDocRef, async (doc) => {\r\n        if (doc.exists()) {\r\n          await this.handleRideUpdates(doc);\r\n        } else {\r\n          console.error('Ride request document does not exist.');\r\n        }\r\n      });\r\n\r\n      this.unsubscribe = unsub;\r\n      \r\n      // Now handle the pending state\r\n      await this.handlePendingState();\r\n    } else {\r\n      throw new Error('Failed to generate requestID');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in requestRideWithDriverDetails:', error);\r\n    this.overlay.showAlert('Error', 'Unable to request ride. Please try again.');\r\n  }\r\n}\r\n\r\nshowNoDriversAlert() {\r\n  console.error('No valid driver available to book a ride.');\r\n  this.overlay.showAlert('No Drivers ', 'No available drivers found. Please try again later.');\r\n}\r\n\r\nasync handleNoAvailableDriver() {\r\n  console.log('Driver is not available, moving to next.');\r\n  this.current_Request_Number++;\r\n  if (this.hasValidDriver()) {\r\n    await this.BookRide();\r\n  } else {\r\n    this.showNoDriversAlert();\r\n  }\r\n}\r\n\r\n// Make sure to clear the subscription when it's no longer needed\r\nclearSubscriptions() {\r\n  console.log('Clearing all subscriptions');\r\n  \r\n  // Clear routeUpdateSubscription first as it's the main culprit\r\n  if (this.routeUpdateSubscription) {\r\n    this.routeUpdateSubscription.unsubscribe();\r\n    this.routeUpdateSubscription = null;\r\n  }\r\n  \r\n  // Clear other subscriptions\r\n  if (this.numCalls) {\r\n    this.numCalls.unsubscribe();\r\n    this.numCalls = null;\r\n  }\r\n  if (this.countDown) {\r\n    this.countDown.unsubscribe();\r\n    this.countDown = null;\r\n  }\r\n  if (this.unsubscribe) {\r\n    this.unsubscribe();\r\n    this.unsubscribe = null;\r\n  }\r\n  \r\n  // Stop any polling interval\r\n  if (this.pollingInterval) {\r\n    clearInterval(this.pollingInterval);\r\n    this.pollingInterval = null;\r\n  }\r\n  \r\n  // Reset any animation state\r\n  this.animatedMarker = null;\r\n}\r\n\r\nasync handleRideUpdates(doc) {\r\n  const data = doc.data();\r\n  if (!data) return;\r\n\r\n  try {\r\n    switch (data.status) {\r\n      case 'confirmed':\r\n        await this.handleRideConfirmation(doc);\r\n        break;\r\n      case 'started':\r\n        await this.handleRideStart(doc);\r\n        break;\r\n      case 'stopped':\r\n        await this.handleRideStop(doc);\r\n        break;\r\n      case 'cancelled':\r\n        await this.handleRideCancellation(data);\r\n        break;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error handling ride updates:', error);\r\n    if (error.code === 'permission-denied' || error.code === 'not-found') {\r\n      await this.ReturnHome();\r\n    }\r\n  }\r\n}\r\n\r\n\r\nasync handlePendingState() {\r\n  try {\r\n    // Don't show another loader here since BookRide is already showing one\r\n    if (!this.currentDriver?.Driver_id) {\r\n      throw new Error('No valid driver ID found');\r\n    }\r\n\r\n    // Get driver location with timeout\r\n    const locationPromise = this.getDriverLocation(this.currentDriver.Driver_id);\r\n    const timeoutPromise = new Promise((_, reject) => \r\n      setTimeout(() => reject(new Error('Location fetch timeout')), 10000)\r\n    );\r\n    \r\n    await Promise.race([locationPromise, timeoutPromise]);\r\n\r\n    if (!this.DriverLatLng) {\r\n      throw new Error('Failed to get driver location');\r\n    }\r\n\r\n    // Group all map operations\r\n    await Promise.all([\r\n      this.clearPrevMarkers(),\r\n      this.clearPolyline(this.newPoly),\r\n      this.map.newMap.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom: 15,\r\n        coordinate: this.DriverLatLng\r\n      })\r\n    ]);\r\n    \r\n    // Update map height properly instead of using fixed positioning\r\n    this.ngZone.run(() => {\r\n      this.setMapHeightHandleDrivertoRider();\r\n    });\r\n    \r\n    await this.handleDriverToRider(this.DriverLatLng, this.LatLng);\r\n    this.EnterSearchingStage();\r\n    await this.startCountdown(20, this.requestID);\r\n    \r\n  } catch (error) {\r\n    console.error('Error in handlePendingState:', error);\r\n    throw error; // Let BookRide handle the error and cleanup\r\n  }\r\n}\r\n\r\n\r\nasync presentCancelRideActionSheet() {\r\n  const actionSheet = await this.actionSheetController.create({\r\n    header: 'Cancel Ride',\r\n    buttons: [\r\n      {\r\n        text: 'Changed my mind',\r\n        handler: () => {\r\n          this.cancelRide('Changed my mind');\r\n        }\r\n      },\r\n      {\r\n        text: 'Driver took too long',\r\n        handler: () => {\r\n          this.cancelRide('Driver took too long');\r\n        }\r\n      },\r\n      {\r\n        text: 'Found another ride',\r\n        handler: () => {\r\n          this.cancelRide('Found another ride');\r\n        }\r\n      },\r\n      {\r\n        text: 'Other',\r\n        handler: () => {\r\n          this.cancelRide('Other');\r\n        }\r\n      },\r\n      {\r\n        text: 'Cancel',\r\n        role: 'cancel'\r\n      }\r\n    ]\r\n  });\r\n  await actionSheet.present();\r\n}\r\n\r\nasync cancelRide(reason: string) {\r\n  const rideRef = doc(this.firestore, 'Request', this.requestID);\r\n  await updateDoc(rideRef, {\r\n    status: 'cancelled',\r\n    cancellationReason: reason,\r\n    canceledBy: 'rider'\r\n  });\r\n  const toast = await this.toastController.create({\r\n    message: 'Ride has been cancelled.',\r\n    duration: 2000\r\n  });\r\n  await toast.present();\r\n}\r\n\r\n\r\n\r\nasync handleRideCancellation(data) {\r\n  this.stopCountdown();\r\n  await this.clearPrevMarkers();\r\n  this.unsubscribe();\r\n  this.clearSubscriptions();\r\n  if (this.drivers_Requested[this.current_Request_Number + 1] && !this.rideHasStarted) {\r\n    this.current_Request_Number++;\r\n    await this.BookRide();\r\n        } else {\r\n    if (data.canceledBy == 'driver') {\r\n      this.overlay.showAlert('Cancelled', 'Driver cancelled');\r\n    } \r\n    this.ClearRide();\r\n      this.ReturnHome();\r\n  }\r\n}\r\n\r\n\r\nasync handleRideStart(doc) {\r\n  try {\r\n    console.log('Starting ride tracking setup...');\r\n    \r\n    // Clear previous visual elements\r\n    await this.clearPrevMarkers();\r\n    await this.clearPolyline(this.newPoly);\r\n    \r\n    // Get ride data and validate\r\n    const data = doc.data();\r\n    if (!data) {\r\n      console.warn('handleRideStart: No data found in document');\r\n      throw new Error('No ride data available');\r\n    }\r\n    \r\n    console.log('handleRideStart data:', data);\r\n    \r\n    // Set ride state flag first to prevent race conditions\r\n    this.rideHasStarted = true;\r\n    \r\n    // Set current driver from document data with fallback options\r\n    if (data.driverDetails) {\r\n      this.currentDriver = data.driverDetails;\r\n      this.driverInfo = data.driverDetails;\r\n    } else if (data.driverId) {\r\n      console.log('Driver details missing, attempting to fetch from driver ID');\r\n      try {\r\n        const driverDoc = await getDoc(doc(this.firestore, 'Drivers', data.driverId));\r\n        if (driverDoc.exists()) {\r\n          this.driverInfo = driverDoc.data();\r\n          this.currentDriver = this.driverInfo;\r\n        }\r\n      } catch (error) {\r\n        console.warn('Failed to fetch driver details:', error);\r\n        // Continue with limited driver info\r\n      }\r\n    }\r\n    \r\n    // Adjust map height before adding markers\r\n    this.setMapHeightHandleDrivertoDestination();\r\n    // window.addEventListener('resize', this.setMapHeightHandleDrivertoDestination.bind(this));\r\n    \r\n    // Initialize locations with fallbacks\r\n    this.LatLng = {\r\n      lat: data.Loc_lat || (this.LatLng?.lat || 0),\r\n      lng: data.Loc_lng || (this.LatLng?.lng || 0)\r\n    };\r\n    \r\n    this.D_LatLng = {\r\n      lat: data.Des_lat || (this.D_LatLng?.lat || 0),\r\n      lng: data.Des_lng || (this.D_LatLng?.lng || 0)\r\n    };\r\n    \r\n    // Ensure map is initialized\r\n    if (!this.map.newMap) {\r\n      console.log('Map not initialized in handleRideStart, initializing now...');\r\n      try {\r\n        await this.initializeMap();\r\n      } catch (mapError) {\r\n        console.error('Failed to initialize map:', mapError);\r\n        // Allow continuation with limited functionality\r\n      }\r\n    }\r\n    \r\n    // Get driver location with better error handling\r\n    let driverLocationFetched = false;\r\n    \r\n    if (data.driverId) {\r\n      try {\r\n        console.log('Fetching driver location for ID:', data.driverId);\r\n        \r\n        // Use Promise.race with a timeout to prevent hanging\r\n        const locationPromise = this.database.getDriverLocation(data.driverId);\r\n        const timeoutPromise = new Promise((_, reject) => \r\n          setTimeout(() => reject(new Error('Driver location fetch timeout')), 5000)\r\n        );\r\n        \r\n        const driverLocation = await Promise.race([locationPromise, timeoutPromise]) as any;\r\n        \r\n        if (driverLocation && typeof driverLocation === 'object' && 'lat' in driverLocation && 'lng' in driverLocation) {\r\n          console.log('Got real-time driver location:', driverLocation);\r\n          this.DriverLatLng = {\r\n            lat: driverLocation.lat,\r\n            lng: driverLocation.lng\r\n          };\r\n          driverLocationFetched = true;\r\n        }\r\n      } catch (locationError) {\r\n        console.warn('Error getting real-time driver location:', locationError);\r\n        // Will use fallback below\r\n      }\r\n    }\r\n    \r\n    // Fallback to location in document if real-time fetch failed\r\n    if (!driverLocationFetched) {\r\n      console.log('Using driver location from document data');\r\n      this.DriverLatLng = {\r\n        lat: data.driverDetails?.Driver_lat || data.driver_lat || this.LatLng.lat,\r\n        lng: data.driverDetails?.Driver_lng || data.driver_lng || this.LatLng.lng\r\n      };\r\n    }\r\n    \r\n    // Setup UI state even if visualization might fail\r\n    this.EnterDrivingToDestinationStage();\r\n    this.canCheck = true;\r\n    \r\n    // Proceed with visualization if we have valid coordinates\r\n    if (this.DriverLatLng?.lat && this.D_LatLng?.lat) {\r\n      console.log('Calling handleRiderToDestination with locations:', \r\n                  'Driver:', this.DriverLatLng, \r\n                  'Destination:', this.D_LatLng);\r\n      \r\n      try {\r\n        await this.handleRiderToDestination(this.DriverLatLng, this.D_LatLng);\r\n      } catch (visualError) {\r\n        console.warn('Failed to visualize route, but ride is still active:', visualError);\r\n        // Show a non-blocking toast or notification\r\n        const toast = await this.toastController.create({\r\n          message: 'Route visualization failed, but your ride is still active',\r\n          duration: 3000\r\n        });\r\n        toast.present();\r\n      }\r\n    } else {\r\n      console.warn('Invalid coordinates for visualization:', this.DriverLatLng, this.D_LatLng);\r\n      const toast = await this.toastController.create({\r\n        message: 'Location data incomplete. Your ride is active but not fully visualized.',\r\n        duration: 3000\r\n      });\r\n      toast.present();\r\n    }\r\n    \r\n    console.log('Ride tracking setup completed successfully');\r\n    \r\n  } catch (error) {\r\n    console.error('Error in handleRideStart:', error);\r\n    \r\n    // Still enter driving stage so user can see at least some UI\r\n    this.EnterDrivingToDestinationStage();\r\n    this.canCheck = true;\r\n    \r\n    // Show a less alarming message to the user\r\n    const toast = await this.toastController.create({\r\n      message: 'Some ride details couldn\\'t be loaded. Your ride is still active.',\r\n      duration: 3000\r\n    });\r\n    toast.present();\r\n  }\r\n}\r\n\r\n// Improve handleRideStop to better handle map errors\r\nasync handleRideStop(docSnapshot) {\r\n  try {\r\n    console.log('Handling ride stop...');\r\n    \r\n    // If already processed, exit immediately\r\n    if (this.isRideStopProcessed) {\r\n      console.log('Ride stop already processed, exiting function');\r\n      return;\r\n    }\r\n    \r\n    // Set flag immediately to prevent re-processing\r\n    this.isRideStopProcessed = true;\r\n    \r\n    // Stop all location polling and mapping activities immediately\r\n    this.stopPolling = true;\r\n    \r\n    // Unsubscribe from route updates first\r\n    if (this.routeUpdateSubscription) {\r\n      this.routeUpdateSubscription.unsubscribe();\r\n      this.routeUpdateSubscription = null;\r\n    }\r\n    \r\n    // Then clear other subscriptions\r\n    this.clearSubscriptions();\r\n    \r\n    // Force removal of all map elements with multiple attempts if needed\r\n    for (let attempt = 0; attempt < 3; attempt++) {\r\n      try {\r\n        await this.clearPrevMarkers();\r\n        await this.clearAllPolylines();\r\n        break; // Exit loop if successful\r\n      } catch (e) {\r\n        console.error(`Map cleanup attempt ${attempt + 1} failed:`, e);\r\n        // Short delay before retry\r\n        await new Promise(resolve => setTimeout(resolve, 100));\r\n      }\r\n    }\r\n    \r\n    // Prepare ride data with proper fallbacks for required fields\r\n    const docData = docSnapshot.data ? docSnapshot.data() : docSnapshot;\r\n    const tripId = docSnapshot.id || this.requestID;\r\n    \r\n    \r\n    const rideData = {\r\n      tripId: tripId || '',\r\n      riderId: this.database.user?.uid || '',\r\n      driverId: docData?.driverDetails?.Driver_id || this.driverInfo?.Driver_id || '',\r\n      driverName: docData?.driverDetails?.Driver_name || this.driverInfo?.Driver_name || 'Unknown Driver',\r\n      driverImage: docData?.driverDetails?.Driver_imgUrl || this.driverInfo?.Driver_imgUrl || '',\r\n      driverCar: docData?.driverDetails?.Driver_car || this.driverInfo?.Driver_car || '',\r\n      driverPlate: docData?.driverDetails?.Driver_plate || this.driverInfo?.Driver_plate || '',\r\n      driverRating: docData?.driverDetails?.Driver_rating || this.driverInfo?.Driver_rating || 0,\r\n      pickup: docData?.Rider_Location || this.locationAddress || 'Unknown pickup',\r\n      destination: docData?.Rider_Destination || this.destinationAddress || 'Unknown destination',\r\n      Loc_lat: docData?.Loc_lat || this.LatLng?.lat || 0,\r\n      Loc_lng: docData?.Loc_lng || this.LatLng?.lng || 0,\r\n      Des_lat: docData?.Des_lat || this.D_LatLng?.lat || 0,\r\n      Des_lng: docData?.Des_lng || this.D_LatLng?.lng || 0,\r\n      Rider_Location: docData?.Rider_Location || this.locationAddress || 'Unknown pickup',\r\n      Rider_Destination: docData?.Rider_Destination || this.destinationAddress || 'Unknown destination',\r\n      Driver_name: docData?.driverDetails?.Driver_name || this.driverInfo?.Driver_name || 'Unknown Driver',\r\n      Driver_car: docData?.driverDetails?.Driver_car || this.driverInfo?.Driver_car || '',\r\n      Driver_plate: docData?.driverDetails?.Driver_plate || this.driverInfo?.Driver_plate || '',\r\n      Driver_imgUrl: docData?.driverDetails?.Driver_imgUrl || this.driverInfo?.Driver_imgUrl || '',\r\n      Driver_rating: docData?.driverDetails?.Driver_rating || this.driverInfo?.Driver_rating || 0,\r\n      price: docData?.price || this.price || 0,\r\n      distance: docData?.distance || this.distance || 0,\r\n      duration: docData?.duration || this.duration || '',\r\n      rating: docData?.driverDetails?.Driver_rating || this.driverInfo?.Driver_rating || 0,\r\n      completed: true,\r\n      completedAt: new Date(),\r\n      timestamp: new Date()\r\n    };\r\n\r\n    // Process payment at the end of the ride (if not using cash)\r\n    if (!this.cash && this.selectedCard && this.selectedCard !== 'cash' && !this.paymentProcessed && !docData?.paymentProcessed) {\r\n      // Check if we're already processing payment for this exact ride\r\n      if (this.processingPaymentForRide === this.requestID) {\r\n        console.log('Payment already being processed for this ride, skipping...');\r\n      } else {\r\n        // Set the processing flag IMMEDIATELY before any async operations\r\n        this.processingPaymentForRide = this.requestID;\r\n        try {\r\n          await this.processRidePayment(docData);\r\n        } finally {\r\n          // Clear the processing flag after completion (success or failure)\r\n          this.processingPaymentForRide = null;\r\n        }\r\n      }\r\n    } else if (docData?.paymentProcessed) {\r\n      // Payment was already processed, just update the flag\r\n      console.log('Payment already processed for this ride');\r\n      this.paymentProcessed = true;\r\n    }\r\n\r\n    // Save to ride history BEFORE showing modal\r\n    try {\r\n      console.log('Saving ride history with data:', rideData);\r\n      await this.database.saveRideHistory(rideData);\r\n      console.log('Ride history saved successfully');\r\n    } catch (historyError) {\r\n      console.error('Failed to save ride history:', historyError);\r\n      // Don't block the modal from showing even if history save fails\r\n    }\r\n\r\n    // CRITICAL: Clear ride state from storage BEFORE showing modal\r\n    try {\r\n      await Preferences.remove({ key: this.RIDE_STATE_KEY });\r\n      console.log('Cleared ride state from storage');\r\n    } catch (e) {\r\n      console.warn('Error clearing storage:', e);\r\n    }\r\n\r\n    // Reset ride properties BEFORE showing modal\r\n    this.rideHasStarted = false;\r\n    this.driverLocation = null;\r\n    this.lastHandledState = null;\r\n    \r\n    console.log('Showing trip summary with data:', rideData);\r\n    \r\n    // Show the trip summary\r\n    const modal = await this.modalCtrl.create({\r\n      component: TripSummaryComponent,\r\n      componentProps: { rideData }\r\n    });\r\n    \r\n    await modal.present();\r\n    \r\n    // Clean up once modal is dismissed\r\n    modal.onDidDismiss().then(async () => {\r\n      console.log('Trip summary dismissed, resetting state');\r\n      this.isRideStopProcessed = false;\r\n      \r\n      // Comprehensive cleanup and return home\r\n      await this.clearRideState();\r\n      await this.ReturnHome();\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Error in handleRideStop:', error);\r\n    this.isRideStopProcessed = false;\r\n    this.ReturnHome();\r\n  }\r\n}\r\n\r\n// Add this method for more thorough ride state cleanup\r\nprivate async clearRideState() {\r\n  console.log('Clearing ride state completely');\r\n  \r\n  // First clear all subscriptions\r\n  this.clearSubscriptions();\r\n  \r\n  // Clear visual elements from map\r\n  await this.clearPrevMarkers().catch(e => console.error('Error clearing markers:', e));\r\n  await this.clearAllPolylines().catch(e => console.error('Error clearing polylines:', e));\r\n  \r\n  // Reset all ride-related properties\r\n  this.requestID = null;\r\n  this.driverInfo = null;\r\n  this.currentDriver = null;\r\n  this.driver_marker = null;\r\n  this.rider_marker = null;\r\n  this.destinationMarker = null;\r\n  this.marker1 = null;\r\n  this.marker2 = null;\r\n  this.routePolyline = null;\r\n  this.routePath = null;\r\n  this.newPoly = null;\r\n  this.animatedMarker = null;\r\n  this.driverLocation = null;\r\n  this.isRideStopProcessed = false;\r\n  this.paymentProcessed = false;\r\n  this.processingPaymentForRide = null;\r\n  \r\n  // Reset driver/ride info\r\n  this.carname = null;\r\n  this.driverImage = null;\r\n  this.driver_duration_apart = null;\r\n  this.driver_ID = null;\r\n  this.driver_number_of_seats = null;\r\n  this.DriverLatLng = null;\r\n  this.rideHasStarted = false;\r\n  this.duration = null;\r\n  this.distance = null;\r\n  \r\n  // Reset destination data\r\n  this.destinationAddress = 'Unknown location';\r\n  this.actualDestination = null;\r\n  this.D_LatLng = { lat: null, lng: null };\r\n  this.price = null;\r\n  \r\n  // Clear car markers array\r\n  if (this._carmarkers && this._carmarkers.length > 0) {\r\n    for (const { marker } of this._carmarkers) {\r\n      if (marker !== null && marker !== undefined && this.map?.newMap) {\r\n        await this.map.newMap.removeMarker(marker).catch(e => \r\n          console.error('Error removing car marker:', e)\r\n        );\r\n      }\r\n    }\r\n    this._carmarkers = [];\r\n  }\r\n  \r\n  // Reset drivers list\r\n  this.drivers_Requested = [];\r\n  this.NoDrivers = false;\r\n  \r\n  // Reset stage-related properties\r\n  this.bookingStage = false;\r\n  this.confirmStage = false;\r\n  this.trackingStage = false;\r\n  this.searchingStage = false;\r\n  this.noDriverStage = false;\r\n  this.drivingToDestinationStage = false;\r\n  this.mapPinStage = false;\r\n  \r\n  // Set default stage\r\n  this.EnterBookingStage();\r\n  \r\n  // Reset polling state\r\n  this.stopPolling = false;\r\n  \r\n  // Reset current request number\r\n  this.current_Request_Number = 0;\r\n  \r\n  // Re-enable map interactions if needed\r\n  if (this.map && this.map.newMap) {\r\n    try {\r\n      await this.map.newMap.enableCurrentLocation(true);\r\n      this.map.newMap.enableTouch();\r\n    } catch (e) {\r\n      console.error('Error enabling map features:', e);\r\n    }\r\n  }\r\n  \r\n  console.log('Ride state cleared completely');\r\n}\r\n\r\n\r\n\r\nasync handleRideConfirmation(docOrData) {\r\n  try {\r\n    console.log('Starting ride confirmation handling...', docOrData);\r\n    this.stopCountdown();\r\n\r\n    // Clear existing markers and polylines\r\n    await Promise.all([\r\n      this.clearPrevMarkers(),\r\n      this.clearPolyline(this.newPoly)\r\n    ]);\r\n\r\n    // Get the ride data\r\n    let rideData;\r\n    let docId;\r\n    \r\n    if (!docOrData) {\r\n      throw new Error('Invalid input: null or undefined');\r\n    }\r\n    \r\n    // Handle different input types\r\n    if (typeof docOrData.data === 'function') {\r\n      // It's a Firebase DocumentSnapshot\r\n      rideData = docOrData.data();\r\n      docId = docOrData.id;\r\n    } else {\r\n      // It's already a data object from currentRide.data()\r\n      rideData = docOrData;\r\n      docId = this.requestID; // Use the current requestID if available\r\n    }\r\n    \r\n    if (!rideData) {\r\n      throw new Error('No ride data found');\r\n    }\r\n\r\n    // Update ride information\r\n    this.requestID = docId || rideData.requestId;\r\n    this.driverInfo = rideData.driverDetails;\r\n    \r\n    // Note: Payment processing moved to handleRideStop (end of ride)\r\n    // Check if payment was already processed\r\n    if (rideData.paymentProcessed) {\r\n      console.log('Payment already processed in previous session');\r\n      this.paymentProcessed = true;\r\n    }\r\n    \r\n    // Set driver information for UI display to avoid template errors\r\n    if (this.driverInfo) {\r\n      this.carname = this.driverInfo.Driver_car || 'Unknown Car';\r\n      this.driverImage = this.driverInfo.Driver_imgUrl || 'assets/icon/profile.png';\r\n      this.driver_ID = this.driverInfo.Driver_id;\r\n      this.driver_number_of_seats = this.driverInfo.seats || 4;\r\n      this.driver_duration_apart = this.driverInfo.duration ? \r\n        Math.ceil(this.driverInfo.duration / 60000) : 0;\r\n    }\r\n    \r\n    // Set locations\r\n    this.LatLng = {\r\n      lat: rideData.Loc_lat,\r\n      lng: rideData.Loc_lng\r\n    };\r\n    \r\n    this.D_LatLng = {\r\n      lat: rideData.Des_lat,\r\n      lng: rideData.Des_lng\r\n    };\r\n\r\n    // Initialize map if not already initialized\r\n    if (!this.map.newMap) {\r\n      await this.initializeMap();\r\n    }\r\n\r\n    // Get and wait for driver location\r\n    if (!this.driverInfo?.Driver_id) {\r\n      console.warn('Driver ID not found in driver details, using fallback location');\r\n      // Use fallback location from driver details\r\n      this.driverLocation = {\r\n        lat: this.driverInfo?.Driver_lat || this.driverInfo?.driver_lat,\r\n        lng: this.driverInfo?.Driver_lng || this.driverInfo?.driver_lng\r\n      };\r\n    } else {\r\n      try {\r\n        await this.getDriverLocation(this.driverInfo.Driver_id);\r\n      } catch (locationError) {\r\n        console.warn('Error getting real-time driver location, using fallback:', locationError);\r\n        // Use fallback location from driver details\r\n        this.driverLocation = {\r\n          lat: this.driverInfo?.Driver_lat || this.driverInfo?.driver_lat,\r\n          lng: this.driverInfo?.Driver_lng || this.driverInfo?.driver_lng\r\n        };\r\n      }\r\n    }\r\n\r\n    if (!this.driverLocation?.lat || !this.driverLocation?.lng) {\r\n      throw new Error('Unable to determine driver location');\r\n    }\r\n\r\n    this.DriverLatLng = {\r\n      lat: this.driverLocation.lat,\r\n      lng: this.driverLocation.lng\r\n    };\r\n\r\n    console.log('Driver location set:', this.DriverLatLng);\r\n\r\n    // Set map height and add event listener\r\n    this.setMapHeightHandleDrivertoRider();\r\n    // window.addEventListener('resize', this.setMapHeightHandleDrivertoRider.bind(this));\r\n\r\n    // Initialize the map view with driver and rider markers\r\n    await this.handleDriverToRider(this.DriverLatLng, this.LatLng);\r\n\r\n    // Update UI state\r\n    this.EnterTrackingStage();\r\n    \r\n    // Save ride state to local storage\r\n    await this.saveRideStateToStorage();\r\n\r\n    console.log('Ride confirmation handled successfully');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error handling ride confirmation:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Add this method to save ride state to storage\r\nprivate async saveRideStateToStorage() {\r\n  try {\r\n    const rideState = {\r\n      requestID: this.requestID,\r\n      driverInfo: this.driverInfo,\r\n      LatLng: this.LatLng,\r\n      D_LatLng: this.D_LatLng,\r\n      DriverLatLng: this.DriverLatLng,\r\n      stage: this.getCurrentStage()\r\n    };\r\n    \r\n    await Preferences.set({\r\n      key: 'RIDE_STATE',\r\n      value: JSON.stringify(rideState)\r\n    });\r\n    \r\n    console.log('Ride state saved successfully');\r\n  } catch (error) {\r\n    console.error('Error saving ride state:', error);\r\n    // Don't throw the error as this is not critical\r\n  }\r\n}\r\n\r\n\r\n// Update getDriverLocation to return a Promise<void> and handle errors better\r\ngetDriverLocation(driverId: string): Promise<void> {\r\n  if (!driverId) {\r\n    return Promise.reject(new Error('No driver ID provided'));\r\n  }\r\n\r\n  console.log('Getting driver location for:', driverId);\r\n  return this.database.getDriverLocation(driverId)\r\n    .then(location => {\r\n      if (!location || !location.lat || !location.lng) {\r\n        throw new Error('Invalid location data received');\r\n      }\r\n      console.log('Driver location received:', location);\r\n      this.driverLocation = location;\r\n    })\r\n    .catch(error => {\r\n      console.error('Error getting driver location:', error);\r\n      throw error;\r\n    });\r\n}\r\n\r\n\r\n\r\nasync EnterChat(): Promise<void> {\r\nconst options: ModalOptions = {\r\n    component: EnrouteChatComponent,\r\n    componentProps: {\r\n        chatData: {\r\n            userId: this.requestID,\r\n            message: \"\"\r\n        }\r\n    },\r\n   \r\n};\r\n\r\nconst modal = await this.modalCtrl.create(options);\r\nreturn await modal.present();\r\n}\r\n\r\nasync startCountdown(initialTime, requestId) {\r\n  this.countdownActive = true;\r\n  let timeRemaining = initialTime;\r\n\r\n  const updateCountdown = async () => {\r\n    if (!this.countdownActive) {\r\n      console.log('Countdown stopped');\r\n      return;\r\n    }\r\n\r\n    if (timeRemaining > 0) {\r\n      try {\r\n        await this.database.UpdateCountDown(timeRemaining, requestId);\r\n        timeRemaining--;\r\n        setTimeout(updateCountdown, 1000);\r\n      } catch (error) {\r\n        console.error('Error updating countdown:', error);\r\n        // Retry after a short delay\r\n        setTimeout(updateCountdown, 2000);\r\n      }\r\n    } else {\r\n      await this.handleCountdownEnd(requestId);\r\n      console.log('Countdown ended');\r\n    }\r\n  };\r\n\r\n  updateCountdown();\r\n}\r\n\r\nasync handleCountdownEnd(requestId) {\r\n  try {\r\n    // Implement a grace period to account for any delays\r\n    setTimeout(async () => {\r\n      await this.clearPrevMarkers();\r\n      await this.requestNextDriver();\r\n    }, 5000); // 5-second grace period\r\n  } catch (error) {\r\n    console.error('Error handling countdown end:', error);\r\n    // Optionally, retry the operation or notify the user\r\n  }\r\n}\r\n\r\n\r\nstopCountdown() {\r\n  this.countdownActive = false;\r\n}\r\n\r\nasync goBackToAutoComplete() {\r\n  try {\r\n    this.stopPolling = false;\r\n    // Enable current location and set the camera to the initial position\r\n    await this.map.newMap.enableCurrentLocation(true);\r\n \r\n\r\n    await this.ResetState();\r\n\r\n    await this.showAutocompleteModal();\r\n    \r\n\r\n    console.log('Game state reset successfully');\r\n  } catch (error) {\r\n    console.error('Error resetting game state:', error);\r\n  }\r\n}\r\n\r\nprivate async clearPrevMarkers() {\r\n  try {\r\n    // Check if map is initialized\r\n    if (!this.map || !this.map.newMap) {\r\n      console.warn('Map not initialized when clearing markers');\r\n      return; // Exit early if map is not available\r\n    }\r\n    \r\n    console.log('Clearing all markers...');\r\n    \r\n    // Clear individual markers with proper error handling\r\n    const markers = [\r\n      { ref: this.rider_marker, name: 'rider_marker' },\r\n      { ref: this.driver_marker, name: 'driver_marker' },\r\n      { ref: this.destinationMarker, name: 'destinationMarker' },\r\n      { ref: this.marker1, name: 'marker1' },\r\n      { ref: this.marker2, name: 'marker2' },\r\n      { ref: this.animatedMarker, name: 'animatedMarker' }\r\n    ];\r\n\r\n    // Add car markers to the list\r\n    if (this._carmarkers && Array.isArray(this._carmarkers)) {\r\n      this._carmarkers.forEach(cm => {\r\n        if (cm.marker) {\r\n          markers.push({ ref: cm.marker, name: 'car_marker' });\r\n        }\r\n      });\r\n      this._carmarkers = [];\r\n    }\r\n    \r\n    const clearPromises = markers\r\n      .filter(m => m.ref !== null && m.ref !== undefined && m.ref !== '')\r\n      .map(m => this.clearMarker(m.ref).catch(e => {\r\n        console.error(`Error clearing ${m.name}:`, e);\r\n        // Continue despite error\r\n        return null;\r\n      }));\r\n    \r\n    await Promise.all(clearPromises);\r\n    \r\n    // Reset all marker references\r\n    this.rider_marker = null;\r\n    this.driver_marker = null;\r\n    this.destinationMarker = null;\r\n    this.marker1 = null;\r\n    this.marker2 = null;\r\n    this.animatedMarker = null;\r\n    \r\n    console.log('All markers cleared successfully');\r\n  } catch (e) {\r\n    console.error('Error in clearPrevMarkers:', e);\r\n    // Just log the error but don't throw, allowing the process to continue\r\n  }\r\n}\r\n\r\n// Add this helper method for individual marker clearing\r\nprivate async clearMarker(marker) {\r\n  if (!marker || !this.map?.newMap) return Promise.resolve();\r\n  \r\n  try {\r\n    console.log('Clearing marker:', marker);\r\n    await this.map.newMap.removeMarker(marker);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error clearing marker:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Helper method to update marker position without duplication\r\nprivate async updateMarkerPosition(marker: any, coordinate: { lat: number, lng: number }, iconUrl: string, title: string) {\r\n  if (!this.map?.newMap) return null;\r\n  \r\n  const markerSize = { width: 40, height: 40 };\r\n  const iconAnchor = { x: 20, y: 40 };\r\n  \r\n  try {\r\n    // Remove old marker if it exists\r\n    if (marker !== null && marker !== undefined) {\r\n      await this.map.newMap.removeMarker(marker).catch(e => \r\n        console.log('Marker already removed or invalid:', e)\r\n      );\r\n    }\r\n    \r\n    // Create new marker at updated position\r\n    const newMarker = await this.map.newMap.addMarker({\r\n      coordinate: coordinate,\r\n      iconUrl: iconUrl,\r\n      title: title,\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 0, y: 0 },\r\n      zIndex: title === 'Driver' ? 100 : 101\r\n    });\r\n    \r\n    return newMarker;\r\n  } catch (error) {\r\n    console.error('Error updating marker position:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// Modify clearAllPolylines for safer handling\r\nasync clearAllPolylines() {\r\n  try {\r\n    if (!this.map || !this.map.newMap) {\r\n      console.warn('Map not initialized when clearing polylines');\r\n      return;\r\n    }\r\n    \r\n    console.log('Clearing all polylines...');\r\n    \r\n    // Try to clear specific polyline first\r\n    if (this.newPoly) {\r\n      try {\r\n        await this.map.newMap.removePolylines(this.newPoly);\r\n        console.log('Specific polyline cleared');\r\n      } catch (error) {\r\n        console.error('Error clearing specific polyline:', error);\r\n      }\r\n    }\r\n    \r\n    // Reset reference\r\n    this.newPoly = null;\r\n      } catch (error) {\r\n    console.error('Error in clearAllPolylines:', error);\r\n    // Just log the error but don't throw\r\n  }\r\n}\r\n\r\n\r\nasync ResetState(){\r\n  try{\r\n    console.log('Resetting state to initial booking view');\r\n    \r\n    // Clear all subscriptions first\r\n    this.clearSubscriptions();\r\n    \r\n    // Clear previous markers and polylines\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n\r\n    // Reset map camera to user location\r\n    if (this.map && this.map.newMap && this.LatLng) {\r\n      await this.map.newMap.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom: 15,\r\n        coordinate: this.LatLng\r\n      });\r\n    }\r\n\r\n    this.ResetMapHeight();\r\n    // window.addEventListener('resize', this.ResetMapHeight.bind(this));\r\n  \r\n    if (this.map && this.map.newMap) {\r\n      this.map.newMap.enableTouch();\r\n      await this.map.newMap.enableCurrentLocation(true);\r\n    }\r\n    \r\n    // Reset all ride-related data\r\n    this.current_Request_Number = 0;\r\n    this.price = null;\r\n    this.actualDestination = null;\r\n    this.D_LatLng = { lat: null, lng: null };\r\n    this.destinationAddress = 'Unknown location';\r\n    this.driverInfo = null;\r\n    this.currentDriver = null;\r\n    this.driverLocation = null;\r\n    this.duration = null;\r\n    this.distance = null;\r\n    \r\n    // Reset polling state\r\n    this.stopPolling = false;\r\n    \r\n  }catch(e){\r\n    throw new Error(e);\r\n    \r\n  }\r\n}\r\n\r\nasync showAutocompleteModal(): Promise<void> {\r\n  const options: ModalOptions = {\r\n      component: AutocompleteComponent,\r\n      componentProps: {\r\n          LatLng: this.LatLng,\r\n          locationAddress: this.locationAddress,\r\n      },\r\n\r\n  };\r\n\r\n  const modal = await this.modalCtrl.create(options);\r\n  await modal.present();\r\n\r\n  const { data } = await modal.onWillDismiss();\r\n  console.log('Modal dismissed with data:', data);\r\n\r\n  this.data = data;\r\n\r\n  if (data.pinOnMap) {\r\n      this.EnterMapPinStage();\r\n      this.mapPinDrag = true;\r\n      this.stopPolling = true;\r\n\r\n  }\r\n\r\n  if (data.home) {\r\n      console.log(\"Entering Booking Stage...\");\r\n      this.EnterBookingStage();\r\n      this.stopPolling = false;\r\n      this.ResetState();\r\n  }\r\n\r\n  if (data.searching) {\r\n      this.database.AddKnownPlace(data);\r\n      this.destinationAddress = data.full;\r\n      this.actualDestination = data.whole.full;\r\n\r\n      try {\r\n          const latLng = await this.geocode.getLatLng(data.whole.description).toPromise();\r\n          this.D_LatLng = {\r\n              lat: latLng.results[0].geometry.location.lat,\r\n              lng: latLng.results[0].geometry.location.lng,\r\n          };\r\n          console.log(\"Destination LatLng:\", this.D_LatLng);\r\n\r\n          await this.getDistanceAndDirections();\r\n    } catch (error) {\r\n          console.error(\"Error in geocoding:\", error);\r\n          this.overlay.showAlert('Error in geocoding:', error.message);\r\n      }\r\n  }\r\n}\r\n\r\n\r\nasync RequestRide(dat) {\r\n  if (this.LatLng) {\r\n    await this.fetchAndDisplayDrivers([this.LatLng.lat, this.LatLng.lng], 8000);\r\n  }\r\n\r\n  if (!this.NoDrivers) {\r\n    this.destinationAddress = dat.place.full;\r\n    this.actualDestination = dat.place.whole.full;\r\n\r\n    try {\r\n      const latLng = await this.geocode.getLatLng(dat.place.whole.description).toPromise();\r\n      this.D_LatLng = {\r\n        lat: latLng.results[0].geometry.location.lat,\r\n        lng: latLng.results[0].geometry.location.lng,\r\n      };\r\n\r\n      await this.getDistanceAndDirections();\r\n  } catch (error) {\r\n      console.error(\"Error in geocoding:\", error);\r\n      this.overlay.showAlert('Check Your Network', error.message);\r\n    }\r\n  } else {\r\n    this.EnterNoDriverStage();\r\n    console.log(\"No drivers available\");\r\n  }\r\n}\r\n\r\nasync getDistanceAndDirections() {\r\n  console.log(\"getDistanceAndDirections called\");\r\n  this.duration = null;\r\n  await this.clearMarkers();\r\n  this.cleanupListeners();\r\n  this.stopPolling = true;\r\n\r\n  if (this.D_LatLng && this.D_LatLng.lat) {\r\n    console.log(\"D_LatLng is set:\", this.D_LatLng);\r\n\r\n    if (this.LatLng) {\r\n      await this.fetchAndDisplayDrivers([this.LatLng.lat, this.LatLng.lng], 8000);\r\n    }\r\n\r\n    if (!this.NoDrivers) {\r\n      this.EnterConfirmStage();\r\n    } else {\r\n      this.EnterNoDriverStage();\r\n      console.log(\"No drivers available\");\r\n      return;\r\n    }\r\n\r\n    const origin1 = new google.maps.LatLng(this.LatLng.lat, this.LatLng.lng);\r\n    const origin2 = new google.maps.LatLng(this.D_LatLng.lat, this.D_LatLng.lng);\r\n\r\n    const request = {\r\n      origin: origin1,\r\n      destination: origin2,\r\n      travelMode: google.maps.TravelMode.DRIVING,\r\n    };\r\n\r\n    this.geocode.directions.route(request, async (response, status) => {\r\n      if (status === 'OK') {\r\n        this.direction = response;\r\n        this.distance = response.routes[0].legs[0].distance.value;\r\n        this.bounds = response.routes[0].bounds;\r\n        this.price = await this.database.getPriceEstimate(this.distance);\r\n        this.duration = response.routes[0].legs[0].duration.text;\r\n\r\n        await this.createAndAddMarkers(this.LatLng, this.D_LatLng);\r\n\r\n        // Call getDistanceAndDirectionsDriver after this part is successful\r\n        await this.getDistanceAndDirectionsDriver();\r\n      } else {\r\n        console.error('Direction ERROR:', response);\r\n        this.overlay.showAlert('Check Your Network', JSON.stringify(response));\r\n      }\r\n    });\r\n  } else {\r\n    this.overlay.showAlert('Drag Map', 'Drag the map and stop on your required destination');\r\n    console.error('D_LatLng or D_LatLng.lat is undefined');\r\n  }\r\n\r\n}\r\n\r\nasync getDistanceAndDirectionsDriver() {\r\n  console.log(\"getDistanceAndDirectionsDriver called\");\r\n\r\n  if (!this.NoDrivers) {\r\n    console.log(\"Driver LatLng:\", this.DriverLatLng);\r\n\r\n    if (this.DriverLatLng) {\r\n      const origin1 = new google.maps.LatLng(this.LatLng.lat, this.LatLng.lng);\r\n      const origin2 = new google.maps.LatLng(this.DriverLatLng.lat, this.DriverLatLng.lng);\r\n\r\n      const request = {\r\n        origin: origin1,\r\n        destination: origin2,\r\n        travelMode: google.maps.TravelMode.DRIVING,\r\n      };\r\n\r\n      this.geocode.directions.route(request, (response, status) => {\r\n        if (status === 'OK') {\r\n          this.D_duration = response.routes[0].legs[0].duration.text;\r\n          console.log(\"Driver duration:\", this.D_duration);\r\n        } else {\r\n          console.error('Direction ERROR:', response);\r\n          this.overlay.showAlert('Direction ERROR:', JSON.stringify(response));\r\n        }\r\n      });\r\n    } else {\r\n      console.log(\"DriverLatLng is undefined\");\r\n    }\r\n  } else {\r\n    console.log(\"No drivers available\");\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\nasync resetLocation(): Promise<void> {\r\nconsole.log(this.LatLng);\r\nawait this.map.newMap.setCamera({\r\n    animate: true,\r\n    animationDuration: 500,\r\n    zoom: 15,\r\n    coordinate: this.LatLng\r\n});\r\nthis.showResetLocationButton = false;\r\n}\r\n\r\n\r\n\r\nprocessAddressResponse(addressResponse) {\r\n  console.log(\"processAddressResponse : \" + addressResponse);\r\n  if (addressResponse) {\r\n      console.log(addressResponse);\r\n      this.actualDestination = this.map.actualLocation;\r\n      const results = addressResponse.results;\r\n\r\n      if (results && results.length > 1 && results[1].geometry && results[1].geometry.location) {\r\n          this.D_LatLng = {\r\n              lat: results[1].geometry.location.lat,\r\n              lng: results[1].geometry.location.lng\r\n          };\r\n\r\n          const addressComponents = results[1].address_components;\r\n          if (addressComponents && addressComponents.length > 1) {\r\n              this.destinationAddress = `${addressComponents[0].long_name} ${addressComponents[1].long_name}`;\r\n              console.log(\"this is it \" + this.destinationAddress);\r\n          } else {\r\n              console.log('Address components are missing or incomplete.');\r\n              this.destinationAddress = 'Unknown address';\r\n          }\r\n      } else {\r\n          console.log('Results are missing or incomplete.');\r\n          this.D_LatLng = { lat: null, lng: null };\r\n          this.destinationAddress = 'Unknown location';\r\n      }\r\n  } else {\r\n      console.log('Failed to fetch address.');\r\n      this.D_LatLng = { lat: null, lng: null };\r\n      this.destinationAddress = 'Failed to fetch address';\r\n  }\r\n}\r\n\r\n\r\nasync UpdateCarMarker(elements: Drivers[]) {\r\n  console.log('Elements to update car markers:', elements);\r\n\r\n  // Validate map is initialized\r\n  if (!this.map || !this.map.newMap) {\r\n    console.warn('Map not initialized when updating car markers');\r\n    return;\r\n  }\r\n\r\n  const bounds = new google.maps.LatLngBounds();\r\n  let hasValidBounds = false;\r\n\r\n  // Create a map of driver IDs to driver elements for quick lookup\r\n  const driverMap = new Map(elements.map(element => [element.Driver_id, element]));\r\n\r\n  // Track markers to keep and update\r\n  const updatedMarkers: { id: string, marker: any }[] = [];\r\n\r\n  // Remove markers that are not needed and update positions\r\n  for (const { id, marker } of this._carmarkers) {\r\n    const driver = driverMap.get(id);\r\n    if (!driver || !driver.onlineState) {\r\n      console.log(`Removing marker for driver ID: ${id}`);\r\n      if (marker !== null && marker !== undefined) {\r\n        await this.map.newMap.removeMarker(marker).catch(e => \r\n          console.error(`Error removing marker ${id}:`, e)\r\n        );\r\n      }\r\n    } else if (driver.Driver_lat !== undefined && driver.Driver_lng !== undefined) {\r\n      const latlng = { lat: driver.Driver_lat, lng: driver.Driver_lng };\r\n      // Remove old marker\r\n      if (marker !== null && marker !== undefined) {\r\n        await this.map.newMap.removeMarker(marker).catch(e => \r\n          console.error(`Error removing marker ${id}:`, e)\r\n        );\r\n      }\r\n      bounds.extend(latlng);\r\n      hasValidBounds = true;\r\n      console.log(`Updated marker for driver ID: ${id}`);\r\n    } else {\r\n      console.error('Invalid driver coordinates:', driver);\r\n    }\r\n  }\r\n\r\n  // Add new markers for drivers that are online and not in the existing markers\r\n  for (const element of elements) {\r\n    if (element.onlineState) {\r\n      const existingMarkerIndex = updatedMarkers.findIndex(({ id }) => id === element.Driver_id);\r\n      if (existingMarkerIndex === -1 && element.Driver_lat !== undefined && element.Driver_lng !== undefined) {\r\n        const latlng = { lat: element.Driver_lat, lng: element.Driver_lng };\r\n        console.log(`Adding new marker for driver ID: ${element.Driver_id} at`, latlng);\r\n        try {\r\n          const marker = await this.map.newMap.addMarker({\r\n            coordinate: latlng,\r\n            iconUrl: 'https://i.ibb.co/KDy365b/hatchback.png',\r\n            title: 'Driver',\r\n            iconSize: { width: 40, height: 40 },\r\n            iconAnchor: { x: 20, y: 40 },\r\n            zIndex: 100\r\n          });\r\n\r\n          if (marker) {\r\n            updatedMarkers.push({ id: element.Driver_id, marker });\r\n            bounds.extend(latlng);\r\n            hasValidBounds = true;\r\n          }\r\n        } catch (error) {\r\n          console.error('Error adding marker:', error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Update the _carmarkers array with the updated markers\r\n  this._carmarkers = updatedMarkers;\r\n\r\n  // Center the map around the car markers if there are any markers\r\n  if (updatedMarkers.length > 0 && hasValidBounds) {\r\n    try {\r\n      const mapDim = {\r\n        height: this.mapRef.nativeElement.offsetHeight || 600,\r\n        width: this.mapRef.nativeElement.offsetWidth || 400\r\n      };\r\n\r\n      const minZoom = 10; // Closer minimum zoom\r\n      const maxZoom = 17; // Reasonable maximum zoom\r\n      \r\n      let zoomLevel = await this.map.getBoundsZoomLevel(bounds, mapDim);\r\n      \r\n      // Constrain the zoom level within the min and max range\r\n      zoomLevel = Math.max(minZoom, Math.min(maxZoom, zoomLevel));\r\n      \r\n      console.log('Setting camera with zoom level:', zoomLevel);\r\n      \r\n      const center = bounds.getCenter();\r\n    \r\n    } catch (error) {\r\n      console.error('Error setting camera:', error);\r\n    }\r\n  } else {\r\n    console.log('No markers to display on the map.');\r\n  }\r\n}\r\n\r\n\r\n\r\nasync GoHome() {\r\n  console.log('Going home...');\r\n  await this.ReturnHome();\r\n}\r\n\r\nasync GotoSupport() {\r\n  await this.nav.navigateForward('support');\r\n}\r\n\r\n\r\nasync ReturnHome() {\r\n  console.log('Returning home - resetting to booking stage');\r\n  \r\n  try {\r\n    // Clear all ride state first\r\n    await this.clearRideState();\r\n    \r\n    // Reset map state\r\n    await this.ResetState();\r\n    \r\n    // Ensure we're in booking stage\r\n    this.EnterBookingStage();\r\n    \r\n    // Reset map camera\r\n    if (this.map && this.map.newMap && this.LatLng) {\r\n      await this.map.newMap.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom: 15,\r\n        coordinate: this.LatLng\r\n      });\r\n    }\r\n    \r\n    console.log('Successfully returned to booking view');\r\n  } catch (error) {\r\n    console.error('Error returning home:', error);\r\n    // Ensure we at least enter booking stage\r\n    this.EnterBookingStage();\r\n  }\r\n}\r\n\r\nasync CancelRide() {\r\n  try {\r\n    console.log('Cancelling ride...');\r\n    this.overlay.showLoader('Cancelling your ride...');\r\n    \r\n    // Cancel ride in database\r\n    if (this.requestID) {\r\n      await this.database.cancelRide(this.requestID);\r\n    }\r\n    \r\n    // Clear subscriptions\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    if (this.numCalls) {\r\n      this.numCalls.unsubscribe();\r\n    }\r\n    \r\n    this.riderCleared = true;\r\n    \r\n    // Comprehensive cleanup\r\n    await this.clearRideState();\r\n    \r\n    // Reset to booking view\r\n    await this.ReturnHome();\r\n    \r\n    this.overlay.hideLoader();\r\n    console.log('Ride cancelled successfully');\r\n  } catch (error) {\r\n    this.overlay.hideLoader();\r\n    console.error('Error cancelling ride:', error);\r\n    this.overlay.showAlert('Error', 'Failed to cancel ride. Please try again.');\r\n    \r\n    // Try to return home anyway\r\n    try {\r\n      await this.ReturnHome();\r\n    } catch (e) {\r\n      console.error('Error returning home after cancel error:', e);\r\n    }\r\n  }\r\n}\r\n\r\nasync ClearRide() {\r\n  try {\r\n    const user = this.auth.currentUser;\r\n    if (user) {\r\n      const riderDocRef = doc(this.firestore, 'Riders', user.uid);\r\n      await updateDoc(riderDocRef, {\r\n        currentRequestId: null\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error clearing ride state:', error);\r\n  }\r\n\r\n  this.EnterBookingStage();\r\n  await this.clearPrevMarkers();\r\n  await this.clearPolyline(this.newPoly);\r\n  this.newPoly = null;\r\n\r\n  await this.map.newMap.enableCurrentLocation(true);\r\n  this.current_Request_Number = 0;\r\n  this.price = null;\r\n  await this.map.newMap.setCamera({\r\n    animate: true,\r\n    animationDuration: 500,\r\n    zoom: 15,\r\n    coordinate: this.LatLng,\r\n    bearing: 0\r\n  });\r\n}\r\n\r\nasync CallDriver() {\r\n  const phone = this.driverInfo?.Driver_phone?.replace(/[^\\d]/g, '');\r\n  if (phone) {\r\n    const message = encodeURIComponent('Hi, I am your rider.');\r\n    window.open(`https://wa.me/${phone}?text=${message}`, '_system');\r\n    return;\r\n  }\r\n  const toast = await this.toastController.create({\r\n    message: 'Driver WhatsApp number not available',\r\n    duration: 2000\r\n  });\r\n  await toast.present();\r\n}\r\n\r\n\r\nasync handleDriverToRider(driverLatLng, riderLatLng) {\r\n  const markerSize = { width: 40, height: 40 }; // Increased size for better visibility\r\n  const iconAnchor = { x: 20, y: 40 }; // Center bottom of the icon\r\n\r\n  try {\r\n    // Cancel any existing route update subscription first\r\n    if (this.routeUpdateSubscription) {\r\n      this.routeUpdateSubscription.unsubscribe();\r\n      this.routeUpdateSubscription = null;\r\n    }\r\n    \r\n    // Check if map is initialized, if not initialize it\r\n    if (!this.map.newMap) {\r\n      console.log('Map not initialized, initializing now...');\r\n      await this.initializeMap();\r\n    }\r\n    \r\n    // Thoroughly clean up previous visual elements\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n    \r\n    // Use the unified height method and ensure proper positioning\r\n    this.setMapHeightHandleDrivertoRider();\r\n    \r\n    // Add driver marker at the starting position with adjusted z-index\r\n    const driverMarker = await this.map.newMap.addMarker({\r\n      coordinate: driverLatLng,\r\n      iconUrl: 'assets/icon/car.png',\r\n      title: 'Driver',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      zIndex: 100 // Ensure marker appears above polylines\r\n    });\r\n    this.driver_marker = driverMarker;\r\n\r\n    // Add rider marker with higher z-index\r\n    const riderMarker = await this.map.newMap.addMarker({\r\n      coordinate: riderLatLng,\r\n      iconUrl: this.database.user?.photoURL || 'assets/icon/person.png',\r\n      title: 'Rider',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      zIndex: 101 // Higher than driver marker\r\n    });\r\n    this.rider_marker = riderMarker;\r\n\r\n    // Function to update route, duration, and distance\r\n    const updateRoute = async () => {\r\n        // Fetch updated driver location\r\n        let updatedDriverLatLng = driverLatLng;\r\n        if (this.currentDriver?.Driver_id) {\r\n          try {\r\n            const driverLocation = await this.database.getDriverLocation(this.currentDriver.Driver_id);\r\n            if (driverLocation && driverLocation.lat && driverLocation.lng) {\r\n              updatedDriverLatLng = { lat: driverLocation.lat, lng: driverLocation.lng };\r\n              this.DriverLatLng = updatedDriverLatLng;\r\n            }\r\n          } catch (error) {\r\n            console.warn('Failed to fetch updated driver location:', error);\r\n          }\r\n        }\r\n\r\n        const request = {\r\n          origin: updatedDriverLatLng,\r\n          destination: riderLatLng,\r\n          travelMode: google.maps.TravelMode.DRIVING,\r\n        };\r\n\r\n        this.geocode.directions.route(request, async (response, status) => {\r\n          // Check if subscription is still active to prevent race conditions\r\n          if (!this.routeUpdateSubscription) {\r\n             console.log('Route update cancelled - subscription inactive');\r\n             return;\r\n          }\r\n\r\n          if (status === 'OK') {\r\n            const path = response.routes[0].overview_path.map(latlng => ({\r\n              lat: latlng.lat(),\r\n              lng: latlng.lng()\r\n            }));\r\n            this.duration = response.routes[0].legs[0].duration.text;\r\n            this.distance = response.routes[0].legs[0].distance.text;\r\n\r\n            console.log(`Duration: ${this.duration}, Distance: ${this.distance}`);\r\n\r\n            const locs = [\r\n              { geoCode: { latitude: updatedDriverLatLng.lat, longitude: updatedDriverLatLng.lng } },\r\n              { geoCode: { latitude: riderLatLng.lat, longitude: riderLatLng.lng } },\r\n            ];\r\n\r\n            const center = this.map.calculateCenter(locs);\r\n\r\n            const bounds = new google.maps.LatLngBounds();\r\n            bounds.extend(new google.maps.LatLng(updatedDriverLatLng.lat, updatedDriverLatLng.lng));\r\n            bounds.extend(new google.maps.LatLng(riderLatLng.lat, riderLatLng.lng));\r\n    \r\n            const availableHeight = this.mapRef.nativeElement.offsetHeight;\r\n    \r\n            // Prepare map dimensions for calculating zoom level\r\n            const mapDim = {\r\n              height: availableHeight,\r\n              width: this.mapRef.nativeElement.offsetWidth,\r\n            };\r\n    \r\n            // Calculate zoom level with better constraints\r\n            let zoomLevel = this.map.getBoundsZoomLevel(bounds, mapDim);\r\n            \r\n            // Apply reasonable constraints for driver-to-rider view\r\n            const minZoom = 12;\r\n            const maxZoom = 16;\r\n            zoomLevel = Math.max(minZoom, Math.min(maxZoom, zoomLevel));\r\n            \r\n            // Adjust zoom to ensure both markers are visible with padding\r\n            const adjustedZoomLevel = Math.max(zoomLevel - 1, minZoom);\r\n    \r\n            await this.map.setCameraToLocation({ lat: center.latitude, lng: center.longitude }, adjustedZoomLevel, this.map.calculateBearing(updatedDriverLatLng, riderLatLng));\r\n    \r\n            // Clear existing polyline before drawing a new one\r\n            await this.clearAllPolylines();\r\n            // Draw full route polyline (use overview_path)\r\n            await this.addPolyline(updatedDriverLatLng, riderLatLng, path);\r\n            \r\n            // Update driver marker position smoothly without duplication\r\n            this.driver_marker = await this.updateMarkerPosition(\r\n              this.driver_marker, \r\n              updatedDriverLatLng, \r\n              'assets/icon/car.png', \r\n              'Driver'\r\n            );\r\n          } else {\r\n            console.error('Direction ERROR:', response);\r\n            this.overlay.showAlert('Direction ERROR', JSON.stringify(response));\r\n          }\r\n        });\r\n    };\r\n\r\n    // Start updating the route periodically\r\n    const routeUpdate$ = interval(this.UPDATE_INTERVAL).pipe(\r\n      switchMap(() => updateRoute())\r\n    );\r\n\r\n    // Subscribe to the interval observable to start updating\r\n    this.routeUpdateSubscription = routeUpdate$.subscribe();\r\n\r\n  } catch (error) {\r\n    console.error('Error handling driver to rider:', error);\r\n  }\r\n}\r\n\r\n// Update clearPolyline to handle null map\r\nasync clearPolyline(polylineId) {\r\n  if (!polylineId || !this.map?.newMap) return;\r\n  \r\n  try {\r\n    await this.map.newMap.removePolylines(polylineId);\r\n  } catch (error) {\r\n    console.error('Error clearing polyline:', error);\r\n  }\r\n}\r\n\r\n\r\nasync handleRiderToDestination(driverLatLng, destinationLatLng) {\r\n  const markerSize = { width: 40, height: 40 }; // Increased size for better visibility\r\n  const iconAnchor = { x: 20, y: 40 }; // Center bottom of the icon\r\n\r\n  try {\r\n    // Cancel any existing route update subscription first\r\n    if (this.routeUpdateSubscription) {\r\n      this.routeUpdateSubscription.unsubscribe();\r\n      this.routeUpdateSubscription = null;\r\n    }\r\n    \r\n    // Check if map is initialized, if not initialize it\r\n    if (!this.map.newMap) {\r\n      console.log('Map not initialized, initializing now...');\r\n      await this.initializeMap();\r\n    }\r\n    \r\n    // Reset map position and apply proper height first\r\n    this.mapRef.nativeElement.style.top = '0';\r\n    this.setMapHeightHandleDrivertoDestination();\r\n    \r\n    // Thoroughly clean up previous visual elements\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n    \r\n    // Update driver marker to driver's current position\r\n    const driverMarker = await this.map.newMap.addMarker({\r\n      coordinate: driverLatLng,\r\n      iconUrl: 'assets/icon/car.png',\r\n      title: 'Driver',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 0, y: 0 },\r\n      zIndex: 100, // Higher z-index to appear above polyline\r\n    });\r\n    this.driver_marker = driverMarker;\r\n\r\n    // Add destination marker\r\n    const destinationMarker = await this.map.newMap.addMarker({\r\n      coordinate: destinationLatLng,\r\n      iconUrl: 'assets/icon/flag.png',\r\n      title: 'Destination',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 0, y: 0 },\r\n      zIndex: 101, // Higher z-index than driver marker\r\n    });\r\n    this.destinationMarker = destinationMarker;\r\n\r\n    // Function to update route, duration, and distance\r\n    const updateRoute = async () => {\r\n        // Fetch updated driver location\r\n        let updatedDriverLatLng = driverLatLng;\r\n        if (this.currentDriver?.Driver_id) {\r\n          try {\r\n            const driverLocation = await this.database.getDriverLocation(this.currentDriver.Driver_id);\r\n            if (driverLocation && driverLocation.lat && driverLocation.lng) {\r\n              updatedDriverLatLng = { lat: driverLocation.lat, lng: driverLocation.lng };\r\n              this.DriverLatLng = updatedDriverLatLng;\r\n            }\r\n          } catch (error) {\r\n            console.warn('Failed to fetch updated driver location:', error);\r\n          }\r\n        }\r\n\r\n        const request = {\r\n          origin: updatedDriverLatLng,\r\n          destination: destinationLatLng,\r\n          travelMode: google.maps.TravelMode.DRIVING,\r\n        };\r\n\r\n        this.geocode.directions.route(request, async (response, status) => {\r\n          // Check if subscription is still active to prevent race conditions\r\n          if (!this.routeUpdateSubscription) {\r\n             console.log('Route update cancelled - subscription inactive');\r\n             return;\r\n          }\r\n\r\n          if (status === 'OK') {\r\n            const path = response.routes[0].overview_path.map(latlng => ({\r\n              lat: latlng.lat(),\r\n              lng: latlng.lng()\r\n            }));\r\n            this.duration = response.routes[0].legs[0].duration.text;\r\n            this.distance = response.routes[0].legs[0].distance.text;\r\n\r\n            console.log(`Duration: ${this.duration}, Distance: ${this.distance}`);\r\n\r\n            const locs = [\r\n              { geoCode: { latitude: updatedDriverLatLng.lat, longitude: updatedDriverLatLng.lng } },\r\n              { geoCode: { latitude: destinationLatLng.lat, longitude: destinationLatLng.lng } },\r\n            ];\r\n\r\n            const center = this.map.calculateCenter(locs);\r\n\r\n            const bounds = new google.maps.LatLngBounds();\r\n            bounds.extend(new google.maps.LatLng(updatedDriverLatLng.lat, updatedDriverLatLng.lng));\r\n            bounds.extend(new google.maps.LatLng(destinationLatLng.lat, destinationLatLng.lng));\r\n    \r\n            const availableHeight = this.mapRef.nativeElement.offsetHeight;\r\n    \r\n            // Prepare map dimensions for calculating zoom level\r\n            const mapDim = {\r\n              height: availableHeight,\r\n              width: this.mapRef.nativeElement.offsetWidth,\r\n            };\r\n    \r\n            // Calculate zoom level with better constraints\r\n            let zoomLevel = this.map.getBoundsZoomLevel(bounds, mapDim);\r\n            \r\n            // Apply reasonable constraints for rider-to-destination view\r\n            const minZoom = 11;\r\n            const maxZoom = 16;\r\n            zoomLevel = Math.max(minZoom, Math.min(maxZoom, zoomLevel));\r\n            \r\n            // Adjust zoom to ensure both markers are visible with padding\r\n            const adjustedZoomLevel = Math.max(zoomLevel - 1, minZoom);\r\n    \r\n            // Set the camera to focus on the center point with appropriate zoom level\r\n            await this.map.setCameraToLocation({ lat: center.latitude, lng: center.longitude }, adjustedZoomLevel, this.map.calculateBearing(updatedDriverLatLng, destinationLatLng));\r\n    \r\n            // Clear existing polyline before drawing a new one\r\n            await this.clearAllPolylines();\r\n            // Draw full route polyline (use overview_path)\r\n            await this.addPolyline(updatedDriverLatLng, destinationLatLng, path);\r\n            \r\n            // Update driver marker position smoothly without duplication\r\n            this.driver_marker = await this.updateMarkerPosition(\r\n              this.driver_marker, \r\n              updatedDriverLatLng, \r\n              'assets/icon/car.png', \r\n              'Driver'\r\n            );\r\n          } else {\r\n            console.error('Direction ERROR:', response);\r\n            this.overlay.showAlert('Direction ERROR', JSON.stringify(response));\r\n          }\r\n        });\r\n    };\r\n\r\n    // Start updating the route periodically\r\n    const routeUpdate$ = interval(this.UPDATE_INTERVAL).pipe(\r\n      switchMap(() => updateRoute())\r\n    );\r\n\r\n    // Subscribe to the interval observable to start updating\r\n    this.routeUpdateSubscription = routeUpdate$.subscribe();\r\n\r\n  } catch (error) {\r\n    console.error('Error handling rider to destination:', error);\r\n  }\r\n}\r\n\r\n// Add polyline using either a full route path or fallback to start/end\r\nasync addPolyline(loc: { lat: number, lng: number }, des: { lat: number, lng: number }, routePath?: { lat: number, lng: number }[]) {\r\n  try {\r\n    const polylineColor = \"#007bff\";\r\n    const pathPoints = Array.isArray(routePath) && routePath.length > 0 ? routePath : [\r\n      { lat: loc.lat, lng: loc.lng },\r\n      { lat: des.lat, lng: des.lng }\r\n    ];\r\n\r\n    const polylines: Polyline[] = [\r\n      {\r\n        path: pathPoints,\r\n        strokeColor: polylineColor,\r\n        strokeWeight: 8,\r\n        geodesic: true\r\n      }\r\n    ];\r\n\r\n    const addedPolylines = await this.map.newMap.addPolylines(polylines);\r\n    if (Array.isArray(addedPolylines) && addedPolylines.length > 0) {\r\n      this.newPoly = addedPolylines; // assign the returned ids\r\n      console.log('Polylines added:', this.newPoly);\r\n      return this.newPoly;\r\n    } else {\r\n      throw new Error('Failed to add polyline: Unexpected response format');\r\n    }\r\n  } catch (e) {\r\n    console.error('Error Adding Polyline: ', e);\r\n    throw e;\r\n  }\r\n}\r\n\r\nasync createAndAddMarkers(loc, des) {\r\n  const markerSize = { width: 30, height: 30 };\r\n  const iconAnchor = { x: 10, y: 0 }; // Center bottom of the icon\r\n\r\n  try {\r\n    this.map.newMap.disableTouch();\r\n\r\n    // Add start marker\r\n    this.marker1 = await this.map.newMap.addMarker({\r\n      coordinate: loc,\r\n      iconUrl: 'assets/icon/point.png',\r\n      title: 'Start',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 1, y: 0 },\r\n    });\r\n\r\n    // Add destination marker\r\n    this.marker2 = await this.map.newMap.addMarker({\r\n      coordinate: des,\r\n      iconUrl: 'assets/icon/flag.png',\r\n      title: 'Destination',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 1, y: 0 },\r\n    });\r\n\r\n    // Calculate the center point between the start and destination\r\n    const locs = [\r\n      { geoCode: { latitude: loc.lat, longitude: loc.lng } },\r\n      { geoCode: { latitude: des.lat, longitude: des.lng } },\r\n    ];\r\n\r\n    const center = this.map.calculateCenter(locs);\r\n\r\n    // Calculate the bounds\r\n    const bounds = new google.maps.LatLngBounds();\r\n    bounds.extend(new google.maps.LatLng(loc.lat, loc.lng));\r\n    bounds.extend(new google.maps.LatLng(des.lat, des.lng));\r\n\r\n    // Set map height before calculating zoom level\r\n    this.setMapHeight();\r\n    const availableHeight = this.mapRef.nativeElement.offsetHeight;\r\n\r\n    // Prepare map dimensions for calculating zoom level\r\n    const mapDim = {\r\n      height: availableHeight,\r\n      width: this.mapRef.nativeElement.offsetWidth,\r\n    };\r\n\r\n    // Calculate zoom level\r\n    const zoomLevel = this.map.getBoundsZoomLevel(bounds, mapDim);\r\n\r\n    // Manually set zoom level if needed\r\n    const adjustedZoomLevel = zoomLevel - 1; // Adjust as necessary\r\n\r\n    // Set the camera to focus on the center point with appropriate zoom level\r\n    await this.map.setCameraToLocation({ lat: center.latitude, lng: center.longitude }, adjustedZoomLevel, this.map.calculateBearing(loc, des));\r\n\r\n    // Add polyline for the route\r\n    const polylineColor = \"#007bff\";\r\n    const polylines: Polyline[] = [\r\n      {\r\n        path: [\r\n          { lat: loc.lat, lng: loc.lng },\r\n          { lat: des.lat, lng: des.lng }\r\n        ],\r\n        strokeColor: polylineColor,\r\n        strokeWeight: 8,\r\n        geodesic: true\r\n      }\r\n    ];\r\n\r\n    // Add polyline to the map\r\n    this.newPoly = await this.map.newMap.addPolylines(polylines);\r\n  } catch (error) {\r\n    console.error('Error creating and adding markers:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n// Update the animateMarker method to properly handle cleanup\r\nasync animateMarker(marker, path, iconUrl) {\r\n  if (!this.map || !this.map.newMap) {\r\n    console.warn('Map not initialized for marker animation');\r\n    return;\r\n  }\r\n\r\n  const markerSize = { width: 50, height: 50 };\r\n  const iconAnchor = { x: 25, y: 50 }; // Center bottom of the icon\r\n  \r\n  try {\r\n    // Remove any existing animated marker\r\n    if (this.animatedMarker !== null && this.animatedMarker !== undefined) {\r\n      await this.map.newMap.removeMarker(this.animatedMarker).catch(e => \r\n        console.error('Error removing existing animated marker:', e)\r\n      );\r\n      this.animatedMarker = null;\r\n    }\r\n\r\n    let lastMarker = null;\r\n    \r\n    for (let i = 0; i < path.length; i++) {\r\n      // Remove previous animation step marker if it exists\r\n      if (lastMarker !== null && lastMarker !== undefined) {\r\n        await this.map.newMap.removeMarker(lastMarker).catch(e => \r\n          console.error('Error removing animation step marker:', e)\r\n        );\r\n      }\r\n      \r\n      // Remove the original marker for the first frame of animation\r\n      if (i === 0 && marker !== null && marker !== undefined) {\r\n        await this.map.newMap.removeMarker(marker).catch(e => \r\n          console.error('Error removing original marker:', e)\r\n        );\r\n      }\r\n      \r\n      const coordinate = path[i] instanceof google.maps.LatLng ? \r\n                       { lat: path[i].lat(), lng: path[i].lng() } : \r\n                       { lat: path[i].lat, lng: path[i].lng };\r\n                       \r\n      lastMarker = await this.map.newMap.addMarker({\r\n        coordinate: coordinate,\r\n        iconUrl: iconUrl,\r\n        title: 'Moving Marker',\r\n        iconSize: markerSize,\r\n        iconAnchor: iconAnchor,\r\n        iconOrigin: { x: 0, y: 0 },\r\n        zIndex: 20, // Higher than other markers\r\n      });\r\n      \r\n      await new Promise(resolve => setTimeout(resolve, 100)); // Adjust the interval as needed\r\n    }\r\n\r\n    // Store the last position of the animated marker\r\n    this.animatedMarker = lastMarker;\r\n  } catch (error) {\r\n    console.error('Error in animateMarker:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nasync ShowDriverInfoPop() {\r\n  const alert = await this.alert.create({\r\n    header: 'Driver Information',\r\n    message: `\r\n      <div style=\"text-align: center;\">\r\n        <h2 style=\"font-size: 1.2em; margin-bottom: 0.5em;\">Car Name: ${this.carname}</h2>\r\n        <div style=\"margin: 10px 0;\">\r\n          <img src=\"${this.driverImage}\" alt=\"Driver Image\" style=\"width: 60px; height: 60px; border-radius: 50%;\">\r\n        </div>\r\n        <p><strong>Duration Apart:</strong> ${this.driver_duration_apart} minutes</p>\r\n        <p><strong>Driver ID:</strong> ${this.driver_ID}</p>\r\n        <p><strong>Number of Seats:</strong> ${this.driver_number_of_seats}</p>\r\n        <p><strong>Driver Location:</strong> (${this.DriverLatLng.lat}, ${this.DriverLatLng.lng})</p>\r\n      </div>\r\n    `,\r\n    buttons: ['OK']\r\n  });\r\n\r\n  await alert.present();\r\n}\r\n\r\n\r\n// State management methods\r\nEnterBookingStage() {\r\n  console.log('Entering booking stage');\r\n  this.setStage(this.STAGES.BOOKING);\r\n  \r\n  // Ensure polling is active to fetch nearby drivers\r\n  if (!this.pollingInterval && this.LatLng) {\r\n    console.log('Restarting driver polling in booking stage');\r\n    this.stopPolling = false;\r\n  }\r\n  \r\n  // Ensure map is in proper state\r\n  if (this.map && this.map.newMap) {\r\n    try {\r\n      this.map.newMap.enableTouch();\r\n      this.map.newMap.enableCurrentLocation(true);\r\n    } catch (e) {\r\n      console.error('Error enabling map features in booking stage:', e);\r\n    }\r\n  }\r\n}\r\n\r\nEnterMapPinStage() {\r\n  this.setStage(this.STAGES.MAP_PIN);\r\n}\r\n\r\nEnterConfirmStage() {\r\n  this.setStage(this.STAGES.CONFIRM);\r\n}\r\n\r\nEnterSearchingStage() {\r\n  this.setStage(this.STAGES.SEARCHING);\r\n}\r\n\r\nEnterNoDriverStage() {\r\n  this.setStage(this.STAGES.NO_DRIVER);\r\n}\r\n\r\nEnterTrackingStage() {\r\n  this.setStage(this.STAGES.TRACKING);\r\n}\r\n\r\nEnterDrivingToDestinationStage() {\r\n  this.setStage(this.STAGES.DRIVING);\r\n}\r\n\r\nprivate setStage(stage: string) {\r\n  // Reset all stages first\r\n  this.bookingStage = false;\r\n  this.confirmStage = false;\r\n  this.trackingStage = false;\r\n  this.searchingStage = false;\r\n  this.drivingToDestinationStage = false;\r\n  this.noDriverStage = false;\r\n  this.mapPinStage = false;\r\n\r\n  // Set the appropriate stage without calling Enter methods\r\n  switch (stage) {\r\n    case this.STAGES.BOOKING:\r\n      this.bookingStage = true;\r\n      break;\r\n    case this.STAGES.CONFIRM:\r\n      this.confirmStage = true;\r\n      break;\r\n    case this.STAGES.TRACKING:\r\n      this.trackingStage = true;\r\n      break;\r\n    case this.STAGES.SEARCHING:\r\n      this.searchingStage = true;\r\n      break;\r\n    case this.STAGES.DRIVING:\r\n      this.drivingToDestinationStage = true;\r\n      break;\r\n    case this.STAGES.NO_DRIVER:\r\n      this.noDriverStage = true;\r\n      break;\r\n    case this.STAGES.MAP_PIN:\r\n      this.mapPinStage = true;\r\n      break;\r\n  }\r\n}\r\n\r\nprivate getCurrentStage(): string {\r\n  if (this.bookingStage) return this.STAGES.BOOKING;\r\n  if (this.confirmStage) return this.STAGES.CONFIRM;\r\n  if (this.trackingStage) return this.STAGES.TRACKING;\r\n  if (this.searchingStage) return this.STAGES.SEARCHING;\r\n  if (this.drivingToDestinationStage) return this.STAGES.DRIVING;\r\n  if (this.noDriverStage) return this.STAGES.NO_DRIVER;\r\n  if (this.mapPinStage) return this.STAGES.MAP_PIN;\r\n  return this.STAGES.BOOKING; // default\r\n}\r\n\r\nngOnInit() {\r\n  // ... existing code ...\r\n  \r\n  // Check for \"book again\" navigation state\r\n  const navigation = this.router.getCurrentNavigation();\r\n  if (navigation?.extras.state) {\r\n    const state = navigation.extras.state;\r\n    console.log('Navigation state received:', state);\r\n    \r\n    if (state['bookAgain']) {\r\n      // Wait for the map to be ready\r\n      this.mapLoadedSubscription = this.mapLoadedSubject.subscribe(loaded => {\r\n        if (loaded) {\r\n          setTimeout(() => {\r\n            console.log('Processing book again data:', state);\r\n            this.processBookAgainData(state);\r\n          }, 1000); // Small delay to ensure map is fully ready\r\n        }\r\n      });\r\n    }\r\n  }\r\n  \r\n  // ... existing code ...\r\n}\r\n\r\nasync processBookAgainData(state) {\r\n  try {\r\n    console.log('Setting up rebooking with data:', state);\r\n    \r\n    // Set pickup location\r\n    if (state.pickup && state.pickup.address) {\r\n      this.locationAddress = state.pickup.address;\r\n      \r\n      if (state.pickup.lat && state.pickup.lng) {\r\n        this.LatLng = {\r\n          lat: state.pickup.lat,\r\n          lng: state.pickup.lng\r\n        };\r\n        \r\n        // Add location marker\r\n        await this.addLocationMarker(this.LatLng);\r\n      } else {\r\n        // If no coordinates, geocode the address\r\n        const coords = await this.geocodeService.geocodeAddress(state.pickup.address);\r\n        if (coords) {\r\n          this.LatLng = coords;\r\n          await this.addLocationMarker(coords);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Set destination\r\n    if (state.destination && state.destination.address) {\r\n      this.destinationAddress = state.destination.address;\r\n      \r\n      if (state.destination.lat && state.destination.lng) {\r\n        this.D_LatLng = {\r\n          lat: state.destination.lat,\r\n          lng: state.destination.lng\r\n        };\r\n        \r\n        // Add destination marker\r\n        await this.addDestinationMarker(this.D_LatLng);\r\n      } else {\r\n        // If no coordinates, geocode the address\r\n        const coords = await this.geocodeService.geocodeAddress(state.destination.address);\r\n        if (coords) {\r\n          this.D_LatLng = coords;\r\n          await this.addDestinationMarker(coords);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // If both locations are set, calculate route\r\n    if (this.LatLng && this.D_LatLng) {\r\n      await this.drawRoute();\r\n      await this.calculatePrice();\r\n      this.EnterConfirmStage();\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('Error processing book again data:', error);\r\n    // Show error toast\r\n    const toast = await this.toastCtrl.create({\r\n      message: 'Could not load previous ride data. Please try again.',\r\n      duration: 3000,\r\n      position: 'bottom',\r\n      color: 'danger'\r\n    });\r\n    toast.present();\r\n  }\r\n}\r\n\r\n}","<ion-header class=\"ion-no-border\" [translucent]=\"true\" style=\"position: relative; z-index: 1000;\">\r\n  <!--destination bar-->\r\n  <ion-toolbar class=\"ion-padding\" *ngIf=\"confirmStage\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-button shape=\"round\" (click)=\"goBackToAutoComplete()\">\r\n        <ion-icon slot=\"icon-only\" name=\"arrow-back\" color=\"tertiary\"></ion-icon> \r\n      </ion-button>\r\n    </ion-buttons>\r\n    <ion-title> Cancel </ion-title>\r\n    <ion-buttons slot=\"end\">\r\n      <ion-item fill=\"outline\" class=\"duration\" color=\"primary\" lines=\"none\">\r\n        <ion-icon slot=\"icon-only\" name=\"flag\" color=\"primary\"></ion-icon>\r\n        <ion-label *ngIf=\"duration\" color=\"primary\"><h1>{{duration}}</h1></ion-label>\r\n      </ion-item>\r\n    </ion-buttons>\r\n  </ion-toolbar>\r\n\r\n  \r\n  <ion-item lines=\"none\" color='light' class=\"main-buttons ion-no-padding\" class='top_bar'  (click)=\"goBackToAutoComplete()\" *ngIf=\"confirmStage\">\r\n      <ion-icon slot=\"start\" color='primary' name=\"pencil\"></ion-icon>\r\n      <ion-label color='primary' >{{destinationAddress}}</ion-label>\r\n  </ion-item>\r\n  \r\n\r\n  <!--menu button-->\r\n  <ion-fab *ngIf=\"bookingStage\" vertical=\"top\" horizontal=\"start\" style=\"top: 35px;\">\r\n    <ion-fab-button color=\"light\">\r\n      <ion-menu-button color=\"primary\"></ion-menu-button>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  <!--sos button-->\r\n  <ion-fab *ngIf=\"bookingStage\" vertical=\"top\" horizontal=\"end\" (click)=\"GotoSupport()\" style=\"top: 35px;\">\r\n    <ion-fab-button color=\"light\">\r\n      <ion-icon color=\"primary\" name=\"chatbubble-ellipses\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n   <!--back button if map Pin-->\r\n   <ion-fab *ngIf=\"mapPinStage\" vertical=\"top\" (click)=\"goBackToAutoComplete()\" horizontal=\"start\" style=\"top: 35px;\">\r\n    <ion-fab-button color=\"light\">\r\n      <ion-icon name=\"arrow-back\" color=\"primary\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  <!--Search Bar-->\r\n\r\n  <!-- Driver arrival time header -->\r\n  <ion-toolbar *ngIf=\"trackingStage\" class=\"ion-text-center\">\r\n    <ion-title>Driver Arrives in {{duration}}</ion-title>\r\n  </ion-toolbar>\r\n  \r\n  <!-- Destination arrival time header -->\r\n  <ion-toolbar *ngIf=\"drivingToDestinationStage\" class=\"ion-text-center\">\r\n    <ion-title>Arrival in {{duration}}</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n\r\n<!--Capacitor Google Map-->\r\n\r\n<ion-content scroll-y=\"false\">\r\n  \r\n  <capacitor-google-maps #map style=\"width: 100%; height: 100%;\">\r\n   \r\n  </capacitor-google-maps>\r\n\r\n\r\n  <ion-fab *ngIf=\"bookingStage && showResetLocationButton\" vertical=\"bottom\" horizontal=\"end\" style=\"bottom: 130px;\">\r\n    <ion-fab-button color=\"light\" (click)=\"resetLocation()\">\r\n      <ion-icon name=\"locate\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  \r\n</ion-content>\r\n\r\n\r\n\r\n<ion-fab class=\"centerPin\" *ngIf=\"mapPinStage\" vertical=\"center\" horizontal=\"center\" style=\"z-index: 1000;\">\r\n    <ion-avatar>\r\n      <ion-img src=\"../../assets/icon/pin.png\"></ion-img>\r\n    </ion-avatar>\r\n</ion-fab>\r\n\r\n  <ion-footer  [translucent]=\"true\" class=\"ion-no-border\" style=\"position: relative; z-index: 1000;\">\r\n    <div #bottomBar>\r\n    <ion-row>\r\n\r\n\r\n      <!--where to bar and button-->\r\n      <div class=\"bottomItems shadow-top\" *ngIf=\"bookingStage\">\r\n  \r\n        <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom \">\r\n          <ion-button \r\n          [disabled]=\"!locationAddress\" \r\n          shape=\"round\" \r\n          class=\"main-button\" \r\n          size=\"large\" \r\n          type=\"submit\" \r\n          (click)=\"showAutocompleteModal()\" \r\n          expand=\"block\">\r\n          <ion-icon slot=\"start\" name=\"search\" color=\"primary\"></ion-icon>\r\n          <ion-label>{{ locationAddress ? 'Where To?' : 'Waiting for address...' }}</ion-label>\r\n        </ion-button>\r\n        \r\n        </ion-item-group>\r\n\r\n      </div>\r\n\r\n      <!--Map Pin Choose Bar-->\r\n      <div class='bottomItems shadow-top' *ngIf=\"mapPinStage\">\r\n\r\n        <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom\">\r\n          <ion-button shape=\"round\" size=\"large\" type=\"submit\" (click)=\"getDistanceAndDirections()\" expand=\"block\">\r\n            <ion-icon slot=\"end\" name=\"arrow-forward\"></ion-icon>\r\n            <ion-label>{{destinationAddress}}</ion-label>\r\n          </ion-button>\r\n        </ion-item-group>\r\n\r\n      </div>\r\n\r\n      <!--No driver Found Bar-->\r\n      \r\n      <div class='bottomItems shadow-top' *ngIf=\"noDriverStage\">\r\n        <ion-list-header>\r\n          <ion-item lines=\"none\" style=\"margin: 2px;\">\r\n              <img src=\"../../assets/imgs/No connection-pana.svg\" style=\"height: 200px; width: 150px; margin: 0 auto;\">\r\n          </ion-item>\r\n            \r\n         </ion-list-header>\r\n       <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom\">\r\n        \r\n               <ion-button shape=\"round\"  class='main-button' size=\"large\" type=\"submit\" color=\"primary\" (click)=\"ReturnHome()\" expand=\"block\">\r\n                 <ion-icon slot=\"start\" name=\"arrow-back\"></ion-icon>\r\n                 <ion-label> No Drivers Here </ion-label>\r\n               </ion-button>\r\n            \r\n       </ion-item-group>\r\n\r\n     </div>\r\n\r\n      <!--Car type, payment, confirmation and Selection Bar-->\r\n      <div class='bottomItems shadow-top' *ngIf=\"confirmStage\">\r\n        <!-- Modern card layout -->\r\n        <div class=\"ride-confirmation-card\">\r\n          <!-- Vehicle info with price section -->\r\n          <div *ngIf=\"price\" class=\"ride-details\">\r\n            <div class=\"vehicle-info\" (click)=\"ShowDriverInfoPop()\">\r\n              <ion-avatar>\r\n                <ion-img src=\"../../assets/icon/pin.png\"></ion-img>\r\n              </ion-avatar>\r\n              <div class=\"vehicle-details\">\r\n                <h2>{{carname}} <ion-icon name=\"information-circle\" color=\"primary\"></ion-icon></h2>\r\n                <p class=\"vehicle-stats\">\r\n                  <span><ion-icon name=\"time\" color=\"primary\"></ion-icon> {{D_duration}}</span>\r\n                  <span><ion-icon name=\"person\" color=\"primary\"></ion-icon> {{driver_number_of_seats}} seats</span>\r\n                </p>\r\n              </div>\r\n              <div class=\"price-tag\">\r\n                <h2>${{price}}</h2>\r\n                <p class=\"original-price\"><del>${{price*2}}</del></p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- Loading skeleton for ride details -->\r\n          <div *ngIf=\"!price\" class=\"ride-details skeleton\">\r\n            <div class=\"vehicle-info\">\r\n              <ion-avatar>\r\n                <ion-skeleton-text [animated]=\"true\"></ion-skeleton-text>\r\n              </ion-avatar>\r\n              <div class=\"vehicle-details\">\r\n                <h2><ion-skeleton-text [animated]=\"true\" style=\"width: 130px\"></ion-skeleton-text></h2>\r\n                <p class=\"vehicle-stats\">\r\n                  <ion-skeleton-text [animated]=\"true\" style=\"width: 130px\"></ion-skeleton-text>\r\n                </p>\r\n              </div>\r\n              <div class=\"price-tag\">\r\n                <h2><ion-skeleton-text [animated]=\"true\" style=\"width: 60px\"></ion-skeleton-text></h2>\r\n                <p><ion-skeleton-text [animated]=\"true\" style=\"width: 60px\"></ion-skeleton-text></p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- Payment method selector -->\r\n          <div class=\"payment-selector\">\r\n            <ion-item lines=\"none\">\r\n              <ion-icon name=\"wallet-outline\" slot=\"start\" color=\"primary\"></ion-icon>\r\n              <ion-label>Payment Method</ion-label>\r\n              <ion-select [value]=\"selectedCard\" (ionChange)=\"chooseCard($event)\" interface=\"action-sheet\">\r\n                <ion-select-option value=\"cash\">\r\n                  Cash\r\n                </ion-select-option>\r\n                <ion-select-option *ngFor=\"let card of savedPaymentMethods\" [value]=\"card.cardId\">\r\n                  {{card.brand | titlecase}}  {{card.last4}}\r\n                </ion-select-option>\r\n                <ion-select-option value=\"add_card\">\r\n                  + Add New Card\r\n                </ion-select-option>\r\n              </ion-select>\r\n            </ion-item>\r\n            <ion-note *ngIf=\"!savedPaymentMethods || savedPaymentMethods.length === 0\" class=\"payment-hint\">\r\n              <ion-icon name=\"information-circle-outline\" color=\"primary\"></ion-icon>\r\n              You can pay with cash or add a card for faster checkout\r\n            </ion-note>\r\n          </div>\r\n          \r\n          <!-- Book ride button -->\r\n          <div class=\"book-button-container\">\r\n            <ion-button class=\"book-ride-btn\" shape=\"round\" color=\"primary\" size=\"large\" \r\n                      expand=\"block\" (click)=\"StartRide()\">\r\n              <ion-icon *ngIf='price' slot=\"start\" name=\"checkmark-sharp\"></ion-icon>\r\n              <ion-progress-bar color=\"light\" *ngIf='!price' type=\"indeterminate\"></ion-progress-bar>\r\n              <ion-label *ngIf='price'>Book Ride</ion-label>\r\n            </ion-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n\r\n<!-- Connecting to driver bar-->\r\n      <div class='bottomItems shadow-top' *ngIf=\"searchingStage\">\r\n         <ion-list-header>\r\n          <ion-item>\r\n            <ion-avatar slot=\"start\">\r\n              <ion-img [src]=\"currentDriver.Driver_imgUrl\"></ion-img>\r\n            </ion-avatar>\r\n            <ion-label>\r\n\r\n              <h1>{{currentDriver.Driver_name}}</h1>\r\n              <p>Arrives In {{duration}}</p>\r\n\r\n            </ion-label>\r\n          </ion-item>\r\n            \r\n         </ion-list-header>\r\n        <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom\">\r\n\r\n                <ion-button  fill=\"outline\" shape=\"round\" color=\"danger\"  class='main-button' size=\"small\" type=\"submit\" expand=\"block\" (click)=\"presentCancelRideActionSheet()\">\r\n                  <ion-label></ion-label>\r\n                  <ion-icon slot=\"start\" slot=\"icon-only\" name=\"close-sharp\" color=\"danger\"></ion-icon>\r\n                </ion-button>\r\n                 \r\n                <ion-progress-bar color=\"primary\" class=\"ion-padding\" type=\"indeterminate\"></ion-progress-bar>\r\n\r\n             \r\n        </ion-item-group>\r\n       \r\n      </div>\r\n\r\n\r\n\r\n       <!--Driver tracking to user bar (FIXED LAYOUT)-->\r\n       <div class='bottomItems shadow-top' *ngIf=\"trackingStage\">\r\n         <div class=\"card\">\r\n           <!-- Car information row -->\r\n           <ion-item lines=\"none\" class=\"driver-card-item\">\r\n             <ion-label>\r\n               <p>{{driverInfo.Driver_car}}.{{driverInfo.Driver_cartype}}</p>\r\n               <h1>{{driverInfo.Driver_plate}}</h1>\r\n             </ion-label>\r\n             \r\n             <!-- Driver avatar and rating on right side -->\r\n             <div slot=\"end\" class=\"driver-avatar-container\">\r\n               <ion-avatar>\r\n                 <ion-img [src]=\"driverInfo.Driver_imgUrl\"></ion-img>\r\n               </ion-avatar>\r\n               <div class=\"driver-rating\">\r\n                 <ion-icon color=\"warning\" name=\"star\"></ion-icon>\r\n                 <span>{{driverInfo.Driver_rating}}</span>\r\n               </div>\r\n             </div>\r\n           </ion-item>\r\n\r\n           <!-- Driver name row -->\r\n           <ion-item lines=\"none\" class=\"driver-card-item\">\r\n             <ion-label>\r\n               <ion-text color=\"primary\">{{driverInfo.Driver_name}}</ion-text>\r\n               <p>1,832 rides</p>\r\n             </ion-label>\r\n           </ion-item>\r\n\r\n           <!-- Payment row -->\r\n           <ion-item lines=\"none\" class=\"driver-card-item\">\r\n             <ion-label *ngIf=\"cash\">\r\n               <h2><ion-icon color='primary' name=\"cash\"></ion-icon> Cash</h2>\r\n             </ion-label>\r\n             <ion-label *ngIf=\"!cash\">\r\n               <h2><ion-icon color='primary' name=\"card\"></ion-icon> Card</h2>\r\n             </ion-label>\r\n             \r\n             <div slot=\"end\" class=\"price-container\">\r\n               <h1>${{price}}</h1>\r\n             </div>\r\n           </ion-item>\r\n\r\n           <!-- More options accordion (made more visible) -->\r\n           <ion-accordion-group class=\"driver-actions-accordion\">\r\n             <ion-accordion value=\"first\">\r\n               <ion-item slot=\"header\" class=\"accordion-header\">\r\n                 <ion-label><h2>More Options</h2></ion-label>\r\n               </ion-item>\r\n               <div slot=\"content\" class=\"accordion-content\">\r\n                 <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"CallDriver()\">\r\n                   <ion-icon color='primary' slot=\"start\" name=\"person\"></ion-icon>\r\n                   <ion-label>Contact</ion-label>\r\n                 </ion-button>\r\n                 \r\n                 <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"EnterChat()\">\r\n                   <ion-icon color='primary' slot=\"start\" name=\"chatbubbles\"></ion-icon>\r\n                   <ion-label>Chat</ion-label>\r\n                 </ion-button>\r\n                 \r\n                 <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"presentCancelRideActionSheet()\">\r\n                   <ion-icon color='primary' slot=\"start\" name=\"close\"></ion-icon>\r\n                   <ion-label>Cancel ride</ion-label>\r\n                 </ion-button>\r\n               </div>\r\n             </ion-accordion>\r\n           </ion-accordion-group>\r\n         </div>\r\n       </div>\r\n\r\n\r\n\r\n    \r\n   <!--Rider Picked Up now tracking to destination bar (FIXED LAYOUT)-->\r\n      <div class='bottomItems shadow-top' *ngIf=\"drivingToDestinationStage\">\r\n        <div class=\"card\">\r\n          <!-- Car information row -->\r\n          <ion-item lines=\"none\" class=\"driver-card-item\">\r\n            <ion-label>\r\n              <p>{{driverInfo.Driver_car}}.{{driverInfo.Driver_cartype}}</p>\r\n              <h1>{{driverInfo.Driver_plate}}</h1>\r\n            </ion-label>\r\n            \r\n            <!-- Driver avatar and rating on right side -->\r\n            <div slot=\"end\" class=\"driver-avatar-container\">\r\n              <ion-avatar>\r\n                <ion-img [src]=\"driverInfo.Driver_imgUrl\"></ion-img>\r\n              </ion-avatar>\r\n              <div class=\"driver-rating\">\r\n                <ion-icon color=\"secondary\" name=\"star\"></ion-icon>\r\n                <span>{{driverInfo.Driver_rating || 5}}</span>\r\n              </div>\r\n            </div>\r\n          </ion-item>\r\n\r\n          <!-- Driver name row -->\r\n          <ion-item lines=\"none\" class=\"driver-card-item\">\r\n            <ion-label>\r\n              <ion-text color=\"primary\">{{driverInfo.Driver_name}}</ion-text>\r\n              <p>1,832 rides</p>\r\n            </ion-label>\r\n          </ion-item>\r\n\r\n          <!-- Payment row -->\r\n          <ion-item lines=\"none\" class=\"driver-card-item\">\r\n            <ion-label *ngIf=\"cash\">\r\n              <h2><ion-icon color='primary' name=\"cash\"></ion-icon> Cash</h2>\r\n            </ion-label>\r\n            <ion-label *ngIf=\"!cash\">\r\n              <h2><ion-icon color='primary' name=\"card\"></ion-icon> Card</h2>\r\n            </ion-label>\r\n            \r\n            <div slot=\"end\" class=\"price-container\">\r\n              <h1>${{price}}</h1>\r\n            </div>\r\n          </ion-item>\r\n\r\n          <!-- Added accordion here too for consistency -->\r\n          <ion-accordion-group class=\"driver-actions-accordion\">\r\n            <ion-accordion value=\"first\">\r\n              <ion-item slot=\"header\" class=\"accordion-header\">\r\n                <ion-label><h2>More Options</h2></ion-label>\r\n              </ion-item>\r\n              <div slot=\"content\" class=\"accordion-content\">\r\n                <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"CallDriver()\">\r\n                  <ion-icon color='primary' slot=\"start\" name=\"person\"></ion-icon>\r\n                  <ion-label>Contact</ion-label>\r\n                </ion-button>\r\n                \r\n                <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"EnterChat()\">\r\n                  <ion-icon color='primary' slot=\"start\" name=\"chatbubbles\"></ion-icon>\r\n                  <ion-label>Chat</ion-label>\r\n                </ion-button>\r\n              </div>\r\n            </ion-accordion>\r\n          </ion-accordion-group>\r\n        </div>\r\n      </div>\r\n      \r\n\r\n\r\n    </ion-row>\r\n    </div>\r\n  </ion-footer>","import { Injectable } from '@angular/core';\r\nimport { Client } from '@googlemaps/google-maps-services-js';\r\nimport { environment } from 'src/environments/environment';\r\nimport { OverlayService } from './overlay.service';\r\nimport { Observable, of } from 'rxjs';\r\nimport { HttpParams, HttpClient } from '@angular/common/http';\r\nimport { catchError, map } from 'rxjs/operators';\r\n\r\ndeclare let google;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeocodeService {\r\n  service = new google.maps.DistanceMatrixService();\r\n  directions = new google.maps.DirectionsService();\r\n  private readonly apiUrl = 'https://maps.googleapis.com/maps/api';\r\n\r\n  constructor(private client: Client, private overlay: OverlayService, private http: HttpClient) { }\r\n\r\n  getAddress(lat: number, lng: number): Observable<any> {\r\n    const url = `${this.apiUrl}/geocode/json`;\r\n    const params = new HttpParams()\r\n      .set('latlng', `${lat},${lng}`)\r\n      .set('key', environment.apiKey);\r\n  \r\n    return this.http.get(url, { params }).pipe(\r\n      map((response: any) => response),\r\n      catchError((error) => {\r\n        console.error('Error in reverse geocoding:', error);\r\n        this.overlay.showAlert('GeoError', error.message);\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Convert the address to lat and lng\r\n  getLatLng(address: string): Observable<any> {\r\n    const url = `${this.apiUrl}/geocode/json`;\r\n    const params = new HttpParams()\r\n      .set('address', address)\r\n      .set('key', environment.apiKey);\r\n\r\n    return this.http.get(url, { params }).pipe(\r\n      map((response: any) => response),\r\n      catchError((error) => {\r\n        console.error('Error in geocoding:', error);\r\n        this.overlay.showAlert('GeoError', error.message);\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n\r\n  \r\n\r\n  // Get the distance between the origin and destination\r\n  async getDirections(from: string, to: string): Promise<any> {\r\n    try {\r\n      // You can implement the directions request here using google.maps.DirectionsService\r\n    } catch (e) {\r\n      this.overlay.showAlert('GeoError', e);\r\n      console.log(e);\r\n    }\r\n  }\r\n\r\n  getDistanceMatrix(origin: any, destination: any): Observable<any> {\r\n    const distanceMatrixService = new google.maps.DistanceMatrixService();\r\n    \r\n    return new Observable(observer => {\r\n      distanceMatrixService.getDistanceMatrix({\r\n        origins: [new google.maps.LatLng(origin.lat, origin.lng)],\r\n        destinations: [new google.maps.LatLng(destination.lat, destination.lng)],\r\n        travelMode: google.maps.TravelMode.DRIVING,\r\n      }, (response, status) => {\r\n        if (status === 'OK') {\r\n          observer.next(response);\r\n        } else {\r\n          observer.error(status);\r\n        }\r\n        observer.complete();\r\n      });\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { GoogleMap, Marker } from '@capacitor/google-maps';\r\nimport { environment } from 'src/environments/environment';\r\nimport { GeocodeService } from './geocode.service';\r\nimport { OverlayService } from './overlay.service';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapService {\r\n  private _map: GoogleMap | null = null;\r\n  \r\n  get newMap(): GoogleMap {\r\n    if (!this._map) {\r\n      throw new Error('Map not initialized');\r\n    }\r\n    return this._map;\r\n  }\r\n\r\n  set newMap(map: GoogleMap) {\r\n    this._map = map;\r\n  }\r\n\r\n  LatLng: { lat: any; lng: any; };\r\n  locationAddress: string = 'Loading..';\r\n  showResetLocationButton: boolean;\r\n  mapPinStage: any;\r\n  D_LatLng: { lat: any; lng: any; };\r\n  actualLocation: any;\r\n  exampleMapId: any;\r\n\r\n  constructor(private overlay: OverlayService, private geocode: GeocodeService, private http: HttpClient) {}\r\n\r\n  async createMap(ref: HTMLElement, coords: { coords: { latitude: number; longitude: number } }) {\r\n    try {\r\n      // Validate coords before using\r\n      const lat = coords?.coords?.latitude || 3.1390; // Default to Kuala Lumpur, Malaysia\r\n      const lng = coords?.coords?.longitude || 101.6869;\r\n      \r\n      // Destroy existing map if it exists\r\n      this._map = await GoogleMap.create({\r\n        id: 'my-cool-map',\r\n        element: ref,\r\n        apiKey: environment.apiKey,\r\n        config: {\r\n          center: {\r\n            lat: lat,\r\n            lng: lng\r\n          },\r\n          zoom: 15,\r\n          styles: [],\r\n          scaleControl: false,\r\n          streetViewControl: false,\r\n          rotateControl: false,\r\n          fullscreenControl: false,\r\n        },\r\n      });\r\n\r\n      this.LatLng = {\r\n        lat: lat,\r\n        lng: lng\r\n      };\r\n\r\n      await Promise.all([\r\n        this._map.enableTrafficLayer(true),\r\n        this._map.enableCurrentLocation(true),\r\n        this._map.setCamera({\r\n          animate: true,\r\n          animationDuration: 500,\r\n          zoom: 15,\r\n          coordinate: this.LatLng\r\n        })\r\n      ]);\r\n\r\n      const address = await this.getAddress(this.LatLng.lat, this.LatLng.lng);\r\n      this.processAddressResponse(address);\r\n\r\n    } catch (error) {\r\n      console.error('Error creating map:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async destroyMap() {\r\n    if (this._map) {\r\n      try {\r\n        await this._map.destroy();\r\n        this._map = null;\r\n      } catch (error) {\r\n        console.error('Error destroying map:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  private processAddressResponse(address: any) {\r\n    if (address?.results?.length > 0) {\r\n      this.actualLocation = address.results[0].formatted_address;\r\n      \r\n      if (address.results.length > 1) {\r\n        const components = address.results[1].address_components;\r\n        if (components?.length >= 2) {\r\n          this.locationAddress = `${components[0].long_name} ${components[1].long_name}`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  calculateCenter(points) {\r\n    const latitudes = points.map(p => p.geoCode.latitude);\r\n    const longitudes = points.map(p => p.geoCode.longitude);\r\n  \r\n    const avgLat = latitudes.reduce((a, b) => a + b, 0) / latitudes.length;\r\n    const avgLng = longitudes.reduce((a, b) => a + b, 0) / longitudes.length;\r\n  \r\n    return { latitude: avgLat, longitude: avgLng };\r\n  }\r\n\r\n  async setCameraToLocation(coordinate: { lat: number; lng: number }, zoom: number, bearing: number) {\r\n    if (!this._map) {\r\n      console.error('Map not initialized');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this._map.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom,\r\n        coordinate,\r\n        bearing\r\n      });\r\n    } catch (error) {\r\n      console.error('Error setting camera:', error);\r\n    }\r\n  }\r\n  \r\n  // Add other necessary methods like getAddress here\r\n\r\n  \r\n  \r\n   getBoundsZoomLevel(bounds, mapDim) {\r\n    const WORLD_DIM = { height: 256, width: 256 };\r\n      const ZOOM_MAX = 21;\r\n\r\n      const latRad = lat => {\r\n        const sin = Math.sin((lat * Math.PI) / 180);\r\n        const radX2 = Math.log((1 + sin) / (1 - sin)) / 2;\r\n        return Math.max(Math.min(radX2, Math.PI), -Math.PI) / 2;\r\n      };\r\n\r\n      const zoom = (mapPx, worldPx, fraction) =>\r\n        Math.floor(Math.log(mapPx / worldPx / fraction) / Math.LN2);\r\n\r\n      const ne = bounds.getNorthEast();\r\n      const sw = bounds.getSouthWest();\r\n\r\n      const latFraction = (latRad(ne.lat()) - latRad(sw.lat())) / Math.PI;\r\n\r\n      const lngDiff = ne.lng() - sw.lng();\r\n      const lngFraction = (lngDiff < 0 ? lngDiff + 360 : lngDiff) / 360;\r\n\r\n      const latZoom = zoom(mapDim.height, WORLD_DIM.height, latFraction);\r\n      const lngZoom = zoom(mapDim.width, WORLD_DIM.width, lngFraction);\r\n\r\n      return Math.min(latZoom, lngZoom, ZOOM_MAX);\r\n  }\r\n  \r\n  calculateBearing(start, end) {\r\n    const startLat = start.lat * (Math.PI / 180);\r\n    const startLng = start.lng * (Math.PI / 180);\r\n    const endLat = end.lat * (Math.PI / 180);\r\n    const endLng = end.lng * (Math.PI / 180);\r\n  \r\n    const dLng = endLng - startLng;\r\n    const y = Math.sin(dLng) * Math.cos(endLat);\r\n    const x = Math.cos(startLat) * Math.sin(endLat) - Math.sin(startLat) * Math.cos(endLat) * Math.cos(dLng);\r\n    const bearing = Math.atan2(y, x) * (180 / Math.PI);\r\n  \r\n    return (bearing + 360) % 360;\r\n  }\r\n  async getDirections(from: string, to: string): Promise<any> {\r\n    try {\r\n      const url = `https://maps.googleapis.com/maps/api/directions/json?origin=${from}&destination=${to}&key=${environment.apiKey}`;\r\n      const response = await this.http.get(url).toPromise();\r\n      return response;\r\n    } catch (error) {\r\n      console.error('Error in getting directions:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n getAddress(lat: number, lng: number): Promise<any> {\r\n    const url = `https://maps.googleapis.com/maps/api/geocode/json`;\r\n    const params = new HttpParams()\r\n      .set('latlng', `${lat},${lng}`)\r\n      .set('key', environment.apiKey);\r\n\r\n    return this.http.get(url, { params }).toPromise();\r\n  }\r\n\r\n  // Add the addMarker method to the MapService class\r\n  async addMarker(lat: number, lng: number, title: string): Promise<Marker> {\r\n    try {\r\n      const marker: Marker = {\r\n        coordinate: { lat, lng },\r\n        title,\r\n      };\r\n      await this._map.addMarker(marker);\r\n      return marker;\r\n    } catch (error) {\r\n      console.error('Error adding marker:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","// src/app/services/network.service.ts\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { Network } from '@capacitor/network';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NetworkService {\r\n  private networkStatus = new BehaviorSubject<boolean>(true);\r\n  networkStatus$ = this.networkStatus.asObservable();\r\n\r\n  constructor() {\r\n    this.initializeNetworkListener();\r\n  }\r\n\r\n  private initializeNetworkListener() {\r\n    try {\r\n      Network.addListener('networkStatusChange', status => {\r\n        console.log('Network status changed', status);\r\n        this.networkStatus.next(status.connected);\r\n\r\n        if (status.connected) {\r\n          this.handleReconnect();\r\n        } else {\r\n          this.handleDisconnect();\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.warn('Failed to add network listener:', error);\r\n    }\r\n\r\n    this.checkInitialNetworkStatus();\r\n  }\r\n\r\n  private async checkInitialNetworkStatus() {\r\n    try {\r\n      const status = await Network.getStatus();\r\n      console.log('Initial network status:', status);\r\n      this.networkStatus.next(status.connected);\r\n      if (!status.connected) {\r\n        this.handleDisconnect();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Network status check failed, performing fallback check:', error);\r\n      // Fallback: try to make a simple network request with timeout\r\n      try {\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout\r\n        \r\n        await fetch('https://www.google.com/favicon.ico', { \r\n          method: 'HEAD',\r\n          mode: 'no-cors',\r\n          cache: 'no-cache',\r\n          signal: controller.signal\r\n        });\r\n        \r\n        clearTimeout(timeoutId);\r\n        this.networkStatus.next(true);\r\n        console.log('Fallback network check: connected');\r\n      } catch (fetchError) {\r\n        console.warn('Fallback network check failed:', fetchError);\r\n        // Be more conservative - assume connected if we can't determine\r\n        this.networkStatus.next(true);\r\n        console.log('Network status uncertain, assuming connected');\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleDisconnect() {\r\n    console.log('Disconnected from network');\r\n    // Handle the UI or logic when the network is disconnected\r\n  }\r\n\r\n  private handleReconnect() {\r\n    console.log('Reconnected to network');\r\n    // Handle the UI or logic when the network is reconnected\r\n  }\r\n\r\n  isConnected(): boolean {\r\n    return this.networkStatus.value;\r\n  }\r\n}\r\n","/// <reference types=\"@capacitor/cli\" />\nexport {};\n","import { registerPlugin } from '@capacitor/core';\nconst App = registerPlugin('App', {\n    web: () => import('./web').then(m => new m.AppWeb()),\n});\nexport * from './definitions';\nexport { App };\n","import { registerPlugin } from '@capacitor/core';\nimport { exposeSynapse } from '@capacitor/synapse';\nconst Geolocation = registerPlugin('Geolocation', {\n    web: () => import('./web').then((m) => new m.GeolocationWeb()),\n});\nexposeSynapse();\nexport * from './definitions';\nexport { Geolocation };\n","import { CapacitorGoogleMaps } from './implementation';\nexport class LatLngBounds {\n    constructor(bounds) {\n        this.southwest = bounds.southwest;\n        this.center = bounds.center;\n        this.northeast = bounds.northeast;\n    }\n    async contains(point) {\n        const result = await CapacitorGoogleMaps.mapBoundsContains({\n            bounds: this,\n            point,\n        });\n        return result['contains'];\n    }\n    async extend(point) {\n        const result = await CapacitorGoogleMaps.mapBoundsExtend({\n            bounds: this,\n            point,\n        });\n        this.southwest = result['bounds']['southwest'];\n        this.center = result['bounds']['center'];\n        this.northeast = result['bounds']['northeast'];\n        return this;\n    }\n}\nexport var MapType;\n(function (MapType) {\n    /**\n     * Basic map.\n     */\n    MapType[\"Normal\"] = \"Normal\";\n    /**\n     * Satellite imagery with roads and labels.\n     */\n    MapType[\"Hybrid\"] = \"Hybrid\";\n    /**\n     * Satellite imagery with no labels.\n     */\n    MapType[\"Satellite\"] = \"Satellite\";\n    /**\n     * Topographic data.\n     */\n    MapType[\"Terrain\"] = \"Terrain\";\n    /**\n     * No base map tiles.\n     */\n    MapType[\"None\"] = \"None\";\n})(MapType || (MapType = {}));\n","import { registerPlugin } from '@capacitor/core';\nconst CapacitorGoogleMaps = registerPlugin('CapacitorGoogleMaps', {\n    web: () => import('./web').then((m) => new m.CapacitorGoogleMapsWeb()),\n});\nCapacitorGoogleMaps.addListener('isMapInFocus', (data) => {\n    var _a;\n    const x = data.x;\n    const y = data.y;\n    const elem = document.elementFromPoint(x, y);\n    const internalId = (_a = elem === null || elem === void 0 ? void 0 : elem.dataset) === null || _a === void 0 ? void 0 : _a.internalId;\n    const mapInFocus = internalId === data.mapId;\n    CapacitorGoogleMaps.dispatchMapEvent({ id: data.mapId, focus: mapInFocus });\n});\nexport { CapacitorGoogleMaps };\n","/* eslint-disable @typescript-eslint/no-namespace */\nimport { LatLngBounds, MapType } from './definitions';\nimport { GoogleMap } from './map';\nexport { GoogleMap, LatLngBounds, MapType };\n","import { Capacitor } from '@capacitor/core';\nimport { LatLngBounds, MapType } from './definitions';\nimport { CapacitorGoogleMaps } from './implementation';\nclass MapCustomElement extends HTMLElement {\n    constructor() {\n        super();\n    }\n    connectedCallback() {\n        this.innerHTML = '';\n        if (Capacitor.getPlatform() == 'ios') {\n            this.style.overflow = 'scroll';\n            this.style['-webkit-overflow-scrolling'] = 'touch';\n            const overflowDiv = document.createElement('div');\n            overflowDiv.style.height = '200%';\n            this.appendChild(overflowDiv);\n        }\n    }\n}\ncustomElements.define('capacitor-google-map', MapCustomElement);\nexport class GoogleMap {\n    constructor(id) {\n        this.element = null;\n        this.resizeObserver = null;\n        this.handleScrollEvent = () => this.updateMapBounds();\n        this.id = id;\n    }\n    /**\n     * Creates a new instance of a Google Map\n     * @param options\n     * @param callback\n     * @returns GoogleMap\n     */\n    static async create(options, callback) {\n        const newMap = new GoogleMap(options.id);\n        if (!options.element) {\n            throw new Error('container element is required');\n        }\n        if (options.config.androidLiteMode === undefined) {\n            options.config.androidLiteMode = false;\n        }\n        newMap.element = options.element;\n        newMap.element.dataset.internalId = options.id;\n        const elementBounds = await GoogleMap.getElementBounds(options.element);\n        options.config.width = elementBounds.width;\n        options.config.height = elementBounds.height;\n        options.config.x = elementBounds.x;\n        options.config.y = elementBounds.y;\n        options.config.devicePixelRatio = window.devicePixelRatio;\n        if (Capacitor.getPlatform() == 'android') {\n            newMap.initScrolling();\n        }\n        if (Capacitor.isNativePlatform()) {\n            options.element = {};\n            const getMapBounds = () => {\n                var _a, _b;\n                const mapRect = (_b = (_a = newMap.element) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect()) !== null && _b !== void 0 ? _b : {};\n                return {\n                    x: mapRect.x,\n                    y: mapRect.y,\n                    width: mapRect.width,\n                    height: mapRect.height,\n                };\n            };\n            const onDisplay = () => {\n                CapacitorGoogleMaps.onDisplay({\n                    id: newMap.id,\n                    mapBounds: getMapBounds(),\n                });\n            };\n            const onResize = () => {\n                CapacitorGoogleMaps.onResize({\n                    id: newMap.id,\n                    mapBounds: getMapBounds(),\n                });\n            };\n            const ionicPage = newMap.element.closest('.ion-page');\n            if (Capacitor.getPlatform() === 'ios' && ionicPage) {\n                ionicPage.addEventListener('ionViewWillEnter', () => {\n                    setTimeout(() => {\n                        onDisplay();\n                    }, 100);\n                });\n                ionicPage.addEventListener('ionViewDidEnter', () => {\n                    setTimeout(() => {\n                        onDisplay();\n                    }, 100);\n                });\n            }\n            const lastState = {\n                width: elementBounds.width,\n                height: elementBounds.height,\n                isHidden: false,\n            };\n            newMap.resizeObserver = new ResizeObserver(() => {\n                if (newMap.element != null) {\n                    const mapRect = newMap.element.getBoundingClientRect();\n                    const isHidden = mapRect.width === 0 && mapRect.height === 0;\n                    if (!isHidden) {\n                        if (lastState.isHidden) {\n                            if (Capacitor.getPlatform() === 'ios' && !ionicPage) {\n                                onDisplay();\n                            }\n                        }\n                        else if (lastState.width !== mapRect.width || lastState.height !== mapRect.height) {\n                            onResize();\n                        }\n                    }\n                    lastState.width = mapRect.width;\n                    lastState.height = mapRect.height;\n                    lastState.isHidden = isHidden;\n                }\n            });\n            newMap.resizeObserver.observe(newMap.element);\n        }\n        // small delay to allow for iOS WKWebView to setup corresponding element sub-scroll views ???\n        await new Promise((resolve, reject) => {\n            setTimeout(async () => {\n                try {\n                    await CapacitorGoogleMaps.create(options);\n                    resolve(undefined);\n                }\n                catch (err) {\n                    reject(err);\n                }\n            }, 200);\n        });\n        if (callback) {\n            const onMapReadyListener = await CapacitorGoogleMaps.addListener('onMapReady', (data) => {\n                if (data.mapId == newMap.id) {\n                    callback(data);\n                    onMapReadyListener.remove();\n                }\n            });\n        }\n        return newMap;\n    }\n    static async getElementBounds(element) {\n        return new Promise((resolve) => {\n            let elementBounds = element.getBoundingClientRect();\n            if (elementBounds.width == 0) {\n                let retries = 0;\n                const boundsInterval = setInterval(function () {\n                    if (elementBounds.width == 0 && retries < 30) {\n                        elementBounds = element.getBoundingClientRect();\n                        retries++;\n                    }\n                    else {\n                        if (retries == 30) {\n                            console.warn('Map size could not be determined');\n                        }\n                        clearInterval(boundsInterval);\n                        resolve(elementBounds);\n                    }\n                }, 100);\n            }\n            else {\n                resolve(elementBounds);\n            }\n        });\n    }\n    /**\n     * Enable touch events on native map\n     *\n     * @returns void\n     */\n    async enableTouch() {\n        return CapacitorGoogleMaps.enableTouch({\n            id: this.id,\n        });\n    }\n    /**\n     * Disable touch events on native map\n     *\n     * @returns void\n     */\n    async disableTouch() {\n        return CapacitorGoogleMaps.disableTouch({\n            id: this.id,\n        });\n    }\n    /**\n     * Enable marker clustering\n     *\n     * @param minClusterSize - The minimum number of markers that can be clustered together.\n     * @defaultValue 4\n     *\n     * @returns void\n     */\n    async enableClustering(minClusterSize) {\n        return CapacitorGoogleMaps.enableClustering({\n            id: this.id,\n            minClusterSize,\n        });\n    }\n    /**\n     * Disable marker clustering\n     *\n     * @returns void\n     */\n    async disableClustering() {\n        return CapacitorGoogleMaps.disableClustering({\n            id: this.id,\n        });\n    }\n    /**\n     * Adds a tile overlay to the map\n     *\n     * @param tileOverlay\n     * @returns created tile overlay id\n     */\n    async addTileOverlay(tileOverlay) {\n        const res = await CapacitorGoogleMaps.addTileOverlay({\n            id: this.id,\n            tileOverlay,\n        });\n        return res.id;\n    }\n    /**\n     * Removes a tile overlay from the map\n     *\n     * @param id of the tile overlay to remove from the map\n     * @returns void\n     */\n    async removeTileOverlay(id) {\n        return CapacitorGoogleMaps.removeTileOverlay({\n            id: this.id,\n            tileOverlayId: id,\n        });\n    }\n    /**\n     * Adds a marker to the map\n     *\n     * @param marker\n     * @returns created marker id\n     */\n    async addMarker(marker) {\n        const res = await CapacitorGoogleMaps.addMarker({\n            id: this.id,\n            marker,\n        });\n        return res.id;\n    }\n    /**\n     * Adds multiple markers to the map\n     *\n     * @param markers\n     * @returns array of created marker IDs\n     */\n    async addMarkers(markers) {\n        const res = await CapacitorGoogleMaps.addMarkers({\n            id: this.id,\n            markers,\n        });\n        return res.ids;\n    }\n    /**\n     * Remove marker from the map\n     *\n     * @param id id of the marker to remove from the map\n     * @returns\n     */\n    async removeMarker(id) {\n        return CapacitorGoogleMaps.removeMarker({\n            id: this.id,\n            markerId: id,\n        });\n    }\n    /**\n     * Remove markers from the map\n     *\n     * @param ids array of ids to remove from the map\n     * @returns\n     */\n    async removeMarkers(ids) {\n        return CapacitorGoogleMaps.removeMarkers({\n            id: this.id,\n            markerIds: ids,\n        });\n    }\n    async addPolygons(polygons) {\n        const res = await CapacitorGoogleMaps.addPolygons({\n            id: this.id,\n            polygons,\n        });\n        return res.ids;\n    }\n    async addPolylines(polylines) {\n        const res = await CapacitorGoogleMaps.addPolylines({\n            id: this.id,\n            polylines,\n        });\n        return res.ids;\n    }\n    async removePolygons(ids) {\n        return CapacitorGoogleMaps.removePolygons({\n            id: this.id,\n            polygonIds: ids,\n        });\n    }\n    async addCircles(circles) {\n        const res = await CapacitorGoogleMaps.addCircles({\n            id: this.id,\n            circles,\n        });\n        return res.ids;\n    }\n    async removeCircles(ids) {\n        return CapacitorGoogleMaps.removeCircles({\n            id: this.id,\n            circleIds: ids,\n        });\n    }\n    async removePolylines(ids) {\n        return CapacitorGoogleMaps.removePolylines({\n            id: this.id,\n            polylineIds: ids,\n        });\n    }\n    /**\n     * Destroy the current instance of the map\n     */\n    async destroy() {\n        var _a;\n        if (Capacitor.getPlatform() == 'android') {\n            this.disableScrolling();\n        }\n        if (Capacitor.isNativePlatform()) {\n            (_a = this.resizeObserver) === null || _a === void 0 ? void 0 : _a.disconnect();\n        }\n        this.removeAllMapListeners();\n        return CapacitorGoogleMaps.destroy({\n            id: this.id,\n        });\n    }\n    /**\n     * Update the map camera configuration\n     *\n     * @param config\n     * @returns\n     */\n    async setCamera(config) {\n        return CapacitorGoogleMaps.setCamera({\n            id: this.id,\n            config,\n        });\n    }\n    async getMapType() {\n        const { type } = await CapacitorGoogleMaps.getMapType({ id: this.id });\n        return MapType[type];\n    }\n    /**\n     * Sets the type of map tiles that should be displayed.\n     *\n     * @param mapType\n     * @returns\n     */\n    async setMapType(mapType) {\n        return CapacitorGoogleMaps.setMapType({\n            id: this.id,\n            mapType,\n        });\n    }\n    /**\n     * Sets whether indoor maps are shown, where available.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableIndoorMaps(enabled) {\n        return CapacitorGoogleMaps.enableIndoorMaps({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Controls whether the map is drawing traffic data, if available.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableTrafficLayer(enabled) {\n        return CapacitorGoogleMaps.enableTrafficLayer({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Show accessibility elements for overlay objects, such as Marker and Polyline.\n     *\n     * Only available on iOS.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableAccessibilityElements(enabled) {\n        return CapacitorGoogleMaps.enableAccessibilityElements({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Set whether the My Location dot and accuracy circle is enabled.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableCurrentLocation(enabled) {\n        return CapacitorGoogleMaps.enableCurrentLocation({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Set padding on the 'visible' region of the view.\n     *\n     * @param padding\n     * @returns\n     */\n    async setPadding(padding) {\n        return CapacitorGoogleMaps.setPadding({\n            id: this.id,\n            padding,\n        });\n    }\n    /**\n     * Get the map's current viewport latitude and longitude bounds.\n     *\n     * @returns {LatLngBounds}\n     */\n    async getMapBounds() {\n        return new LatLngBounds(await CapacitorGoogleMaps.getMapBounds({\n            id: this.id,\n        }));\n    }\n    async fitBounds(bounds, padding) {\n        return CapacitorGoogleMaps.fitBounds({\n            id: this.id,\n            bounds,\n            padding,\n        });\n    }\n    initScrolling() {\n        const ionContents = document.getElementsByTagName('ion-content');\n        // eslint-disable-next-line @typescript-eslint/prefer-for-of\n        for (let i = 0; i < ionContents.length; i++) {\n            ionContents[i].scrollEvents = true;\n        }\n        window.addEventListener('ionScroll', this.handleScrollEvent);\n        window.addEventListener('scroll', this.handleScrollEvent);\n        window.addEventListener('resize', this.handleScrollEvent);\n        if (screen.orientation) {\n            screen.orientation.addEventListener('change', () => {\n                setTimeout(this.updateMapBounds, 500);\n            });\n        }\n        else {\n            window.addEventListener('orientationchange', () => {\n                setTimeout(this.updateMapBounds, 500);\n            });\n        }\n    }\n    disableScrolling() {\n        window.removeEventListener('ionScroll', this.handleScrollEvent);\n        window.removeEventListener('scroll', this.handleScrollEvent);\n        window.removeEventListener('resize', this.handleScrollEvent);\n        if (screen.orientation) {\n            screen.orientation.removeEventListener('change', () => {\n                setTimeout(this.updateMapBounds, 1000);\n            });\n        }\n        else {\n            window.removeEventListener('orientationchange', () => {\n                setTimeout(this.updateMapBounds, 1000);\n            });\n        }\n    }\n    updateMapBounds() {\n        if (this.element) {\n            const mapRect = this.element.getBoundingClientRect();\n            CapacitorGoogleMaps.onScroll({\n                id: this.id,\n                mapBounds: {\n                    x: mapRect.x,\n                    y: mapRect.y,\n                    width: mapRect.width,\n                    height: mapRect.height,\n                },\n            });\n        }\n    }\n    /*\n    private findContainerElement(): HTMLElement | null {\n      if (!this.element) {\n        return null;\n      }\n  \n      let parentElement = this.element.parentElement;\n      while (parentElement !== null) {\n        if (window.getComputedStyle(parentElement).overflowY !== 'hidden') {\n          return parentElement;\n        }\n  \n        parentElement = parentElement.parentElement;\n      }\n  \n      return null;\n    }\n    */\n    /**\n     * Set the event listener on the map for 'onCameraIdle' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnCameraIdleListener(callback) {\n        if (this.onCameraIdleListener) {\n            this.onCameraIdleListener.remove();\n        }\n        if (callback) {\n            this.onCameraIdleListener = await CapacitorGoogleMaps.addListener('onCameraIdle', this.generateCallback(callback));\n        }\n        else {\n            this.onCameraIdleListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onBoundsChanged' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnBoundsChangedListener(callback) {\n        if (this.onBoundsChangedListener) {\n            this.onBoundsChangedListener.remove();\n        }\n        if (callback) {\n            this.onBoundsChangedListener = await CapacitorGoogleMaps.addListener('onBoundsChanged', this.generateCallback(callback));\n        }\n        else {\n            this.onBoundsChangedListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onCameraMoveStarted' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnCameraMoveStartedListener(callback) {\n        if (this.onCameraMoveStartedListener) {\n            this.onCameraMoveStartedListener.remove();\n        }\n        if (callback) {\n            this.onCameraMoveStartedListener = await CapacitorGoogleMaps.addListener('onCameraMoveStarted', this.generateCallback(callback));\n        }\n        else {\n            this.onCameraMoveStartedListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onClusterClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnClusterClickListener(callback) {\n        if (this.onClusterClickListener) {\n            this.onClusterClickListener.remove();\n        }\n        if (callback) {\n            this.onClusterClickListener = await CapacitorGoogleMaps.addListener('onClusterClick', this.generateCallback(callback));\n        }\n        else {\n            this.onClusterClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onClusterInfoWindowClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnClusterInfoWindowClickListener(callback) {\n        if (this.onClusterInfoWindowClickListener) {\n            this.onClusterInfoWindowClickListener.remove();\n        }\n        if (callback) {\n            this.onClusterInfoWindowClickListener = await CapacitorGoogleMaps.addListener('onClusterInfoWindowClick', this.generateCallback(callback));\n        }\n        else {\n            this.onClusterInfoWindowClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onInfoWindowClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnInfoWindowClickListener(callback) {\n        if (this.onInfoWindowClickListener) {\n            this.onInfoWindowClickListener.remove();\n        }\n        if (callback) {\n            this.onInfoWindowClickListener = await CapacitorGoogleMaps.addListener('onInfoWindowClick', this.generateCallback(callback));\n        }\n        else {\n            this.onInfoWindowClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMapClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMapClickListener(callback) {\n        if (this.onMapClickListener) {\n            this.onMapClickListener.remove();\n        }\n        if (callback) {\n            this.onMapClickListener = await CapacitorGoogleMaps.addListener('onMapClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMapClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onPolygonClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnPolygonClickListener(callback) {\n        if (this.onPolygonClickListener) {\n            this.onPolygonClickListener.remove();\n        }\n        if (callback) {\n            this.onPolygonClickListener = await CapacitorGoogleMaps.addListener('onPolygonClick', this.generateCallback(callback));\n        }\n        else {\n            this.onPolygonClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onCircleClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnCircleClickListener(callback) {\n        if (this.onCircleClickListener)\n            [this.onCircleClickListener.remove()];\n        if (callback) {\n            this.onCircleClickListener = await CapacitorGoogleMaps.addListener('onCircleClick', this.generateCallback(callback));\n        }\n        else {\n            this.onCircleClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerClickListener(callback) {\n        if (this.onMarkerClickListener) {\n            this.onMarkerClickListener.remove();\n        }\n        if (callback) {\n            this.onMarkerClickListener = await CapacitorGoogleMaps.addListener('onMarkerClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onPolylineClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnPolylineClickListener(callback) {\n        if (this.onPolylineClickListener) {\n            this.onPolylineClickListener.remove();\n        }\n        if (callback) {\n            this.onPolylineClickListener = await CapacitorGoogleMaps.addListener('onPolylineClick', this.generateCallback(callback));\n        }\n        else {\n            this.onPolylineClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerDragStart' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerDragStartListener(callback) {\n        if (this.onMarkerDragStartListener) {\n            this.onMarkerDragStartListener.remove();\n        }\n        if (callback) {\n            this.onMarkerDragStartListener = await CapacitorGoogleMaps.addListener('onMarkerDragStart', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerDragStartListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerDrag' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerDragListener(callback) {\n        if (this.onMarkerDragListener) {\n            this.onMarkerDragListener.remove();\n        }\n        if (callback) {\n            this.onMarkerDragListener = await CapacitorGoogleMaps.addListener('onMarkerDrag', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerDragListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerDragEnd' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerDragEndListener(callback) {\n        if (this.onMarkerDragEndListener) {\n            this.onMarkerDragEndListener.remove();\n        }\n        if (callback) {\n            this.onMarkerDragEndListener = await CapacitorGoogleMaps.addListener('onMarkerDragEnd', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerDragEndListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMyLocationButtonClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMyLocationButtonClickListener(callback) {\n        if (this.onMyLocationButtonClickListener) {\n            this.onMyLocationButtonClickListener.remove();\n        }\n        if (callback) {\n            this.onMyLocationButtonClickListener = await CapacitorGoogleMaps.addListener('onMyLocationButtonClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMyLocationButtonClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMyLocationClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMyLocationClickListener(callback) {\n        if (this.onMyLocationClickListener) {\n            this.onMyLocationClickListener.remove();\n        }\n        if (callback) {\n            this.onMyLocationClickListener = await CapacitorGoogleMaps.addListener('onMyLocationClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMyLocationClickListener = undefined;\n        }\n    }\n    /**\n     * Remove all event listeners on the map.\n     *\n     * @param callback\n     * @returns\n     */\n    async removeAllMapListeners() {\n        if (this.onBoundsChangedListener) {\n            this.onBoundsChangedListener.remove();\n            this.onBoundsChangedListener = undefined;\n        }\n        if (this.onCameraIdleListener) {\n            this.onCameraIdleListener.remove();\n            this.onCameraIdleListener = undefined;\n        }\n        if (this.onCameraMoveStartedListener) {\n            this.onCameraMoveStartedListener.remove();\n            this.onCameraMoveStartedListener = undefined;\n        }\n        if (this.onClusterClickListener) {\n            this.onClusterClickListener.remove();\n            this.onClusterClickListener = undefined;\n        }\n        if (this.onClusterInfoWindowClickListener) {\n            this.onClusterInfoWindowClickListener.remove();\n            this.onClusterInfoWindowClickListener = undefined;\n        }\n        if (this.onInfoWindowClickListener) {\n            this.onInfoWindowClickListener.remove();\n            this.onInfoWindowClickListener = undefined;\n        }\n        if (this.onMapClickListener) {\n            this.onMapClickListener.remove();\n            this.onMapClickListener = undefined;\n        }\n        if (this.onPolylineClickListener) {\n            this.onPolylineClickListener.remove();\n            this.onPolylineClickListener = undefined;\n        }\n        if (this.onMarkerClickListener) {\n            this.onMarkerClickListener.remove();\n            this.onMarkerClickListener = undefined;\n        }\n        if (this.onPolygonClickListener) {\n            this.onPolygonClickListener.remove();\n            this.onPolygonClickListener = undefined;\n        }\n        if (this.onCircleClickListener) {\n            this.onCircleClickListener.remove();\n            this.onCircleClickListener = undefined;\n        }\n        if (this.onMarkerDragStartListener) {\n            this.onMarkerDragStartListener.remove();\n            this.onMarkerDragStartListener = undefined;\n        }\n        if (this.onMarkerDragListener) {\n            this.onMarkerDragListener.remove();\n            this.onMarkerDragListener = undefined;\n        }\n        if (this.onMarkerDragEndListener) {\n            this.onMarkerDragEndListener.remove();\n            this.onMarkerDragEndListener = undefined;\n        }\n        if (this.onMyLocationButtonClickListener) {\n            this.onMyLocationButtonClickListener.remove();\n            this.onMyLocationButtonClickListener = undefined;\n        }\n        if (this.onMyLocationClickListener) {\n            this.onMyLocationClickListener.remove();\n            this.onMyLocationClickListener = undefined;\n        }\n    }\n    generateCallback(callback) {\n        const mapId = this.id;\n        return (data) => {\n            if (data.mapId == mapId) {\n                callback(data);\n            }\n        };\n    }\n}\n","import { asyncScheduler } from '../scheduler/async';\nimport { timer } from './timer';\nexport function interval(period = 0, scheduler = asyncScheduler) {\n    if (period < 0) {\n        period = 0;\n    }\n    return timer(period, period, scheduler);\n}\n","function s(t) {\n  t.CapacitorUtils.Synapse = new Proxy(\n    {},\n    {\n      get(e, n) {\n        return new Proxy({}, {\n          get(w, o) {\n            return (c, p, r) => {\n              const i = t.Capacitor.Plugins[n];\n              if (i === void 0) {\n                r(new Error(`Capacitor plugin ${n} not found`));\n                return;\n              }\n              if (typeof i[o] != \"function\") {\n                r(new Error(`Method ${o} not found in Capacitor plugin ${n}`));\n                return;\n              }\n              (async () => {\n                try {\n                  const a = await i[o](c);\n                  p(a);\n                } catch (a) {\n                  r(a);\n                }\n              })();\n            };\n          }\n        });\n      }\n    }\n  );\n}\nfunction u(t) {\n  t.CapacitorUtils.Synapse = new Proxy(\n    {},\n    {\n      get(e, n) {\n        return t.cordova.plugins[n];\n      }\n    }\n  );\n}\nfunction f(t = !1) {\n  typeof window > \"u\" || (window.CapacitorUtils = window.CapacitorUtils || {}, window.Capacitor !== void 0 && !t ? s(window) : window.cordova !== void 0 && u(window));\n}\nexport {\n  f as exposeSynapse\n};\n"],"names":["ElementRef","NgZone","Geolocation","AutocompleteComponent","Observable","interval","BehaviorSubject","Subscription","updateDoc","getDoc","collection","onSnapshot","doc","Firestore","query","where","EnrouteChatComponent","Network","App","AddCardComponent","switchMap","Preferences","onAuthStateChanged","TripSummaryComponent","i0","HomePage","constructor","auth","authService","router","networkService","map","nav","platform","firestore","database","ngZone","geocode","overlay","modalCtrl","alert","payME","toastController","actionSheetController","BOOKING","CONFIRM","TRACKING","SEARCHING","DRIVING","NO_DRIVER","MAP_PIN","NO_DRIVERS","initializeApp","ngOnDestroy","unsubscribe","clearSubscriptions","clearPrevMarkers","clearAllPolylines","ionViewWillEnter","fetchSavedPaymentMethods","ngAfterViewInit","hasPermission","checkAndRequestLocationPermissions","initializeProfile","initializeNetworkMonitoring","loadPresets","initializeGeolocation","initializeMap","EnterBookingStage","initializeRideStateListener","e","console","log","raw","localStorage","getItem","presets","JSON","parse","name","address","lat","lng","setItem","stringify","error","savePresets","addCurrentAsPreset","destinationAddress","D_LatLng","create","header","message","buttons","present","unshift","length","deletePreset","i","splice","selectPreset","preset","getDistanceAndDirections","showAutocompleteModal","user","Promise","resolve","Error","profile","getUserProfile","userId","uid","email","createdAt","Date","toISOString","createUserProfile","hideLoader","showAlert","ensureProfileInitialized","lastHandledState","requestsQuery","snapshot","empty","setStage","STAGES","activeRides","docs","currentRide","rideData","data","requestID","id","price","status","isAppInitialization","Loc_lat","Loc_lng","LatLng","Des_lat","Des_lng","locationAddress","Rider_Location","Rider_Destination","handlePendingState","handleRideConfirmation","handleRideStart","handleRideCancellation","code","handleRemovedRide","clearRideData","driverInfo","rideHasStarted","paymentProcessed","processingPaymentForRide","is","permissionStatus","checkPermissions","location","text","handler","newStatus","requestPermissions","showLocationRequiredAlert","backdropDismiss","role","onDidDismiss","navigator","permissions","then","result","state","showWebLocationPrompt","geolocation","getCurrentPosition","savedPaymentMethods","getSavedPaymentMethods","selectedCard","cash","cardId","chooseCard","event","selectedValue","detail","value","openAddCardModal","processRidePayment","rideRef","rideDoc","existingData","totalAmount","Math","round","driverAmount","companyAmount","paymentData","amount","currency","paymentMethodId","driverId","driverDetails","Driver_id","rideId","description","paymentResult","toPromise","success","paymentIntentId","paymentAmount","paymentTimestamp","toast","duration","position","color","errorMessage","paymentMethod","showPaymentErrorModal","modal","component","onWillDismiss","updateMapPadding","bottomPadding","newMap","setPadding","top","left","right","bottom","setMapHeight","setMapHeightCreateAndAddMarkers","setMapHeightHandleDrivertoRider","setMapHeightHandleDrivertoDestination","ResetMapHeight","getStatus","isConnected","connected","networkStatus$","next","addListener","subscribe","navigate","ready","coordinates","timeout","reject","coords","latitude","longitude","accuracy","altitude","altitudeAccuracy","heading","speed","timestamp","updateLocation","startPollingPosition","startPermissionPolling","permissionCheckInterval","setInterval","clearInterval","lastLatLng","lastAddress","pollingInterval","newLatLng","hasSignificantLocationChange","getAddress","results","components","address_components","long_name","actualLocation","formatted_address","stopPolling","center","radiusInM","fetchAndDisplayDrivers","err","oldLatLng","minDistance","R","1","PI","2","","","a","sin","cos","c","atan2","sqrt","distance","stopPollingPosition","warn","now","createMap","mapRef","nativeElement","mapy","initializeDatabaseSubscriptions","getKnownPlaces","d","places","slice","initializeBackButtonCustomHandler","backButton","subscribeWithPriority","canGoBack","confirm","exitApp","window","history","back","setupMapListeners","setOnCameraIdleListener","g","run","showResetLocationButton","mapPinStage","addressResponse","processAddressResponse","logout","drivers","checkDriversWithin","handleDrivers","drivers_Requested","current_Request_Number","UpdateCarMarker","NoDrivers","closeDrivers","forEach","driver","onlineState","push","updateDriverInfo","min","cleanupListeners","Object","values","activeListeners","carname","Driver_car","driverImage","Driver_imgUrl","driver_duration_apart","ceil","driver_ID","driver_number_of_seats","seats","DriverLatLng","Driver_lat","Driver_lng","StartRide","isLoadingDriver","showLoader","all","enableTouch","BookRide","clearMarkers","marker1","undefined","removeMarker","catch","marker2","_carmarkers","Array","isArray","marker","hasValidDriver","showNoDriversAlert","userDocRef","docSnapshot","exists","handleNoAvailableDriver","requestRideWithDriverDetails","requestDetails","latLng","dLatLng","RequestRideWithRiderDetails","currentDriver","rideRequestDocRef","unsub","handleRideUpdates","routeUpdateSubscription","numCalls","countDown","animatedMarker","handleRideStop","ReturnHome","locationPromise","getDriverLocation","timeoutPromise","_","setTimeout","race","clearPolyline","newPoly","setCamera","animate","animationDuration","zoom","coordinate","handleDriverToRider","EnterSearchingStage","startCountdown","presentCancelRideActionSheet","actionSheet","cancelRide","reason","cancellationReason","canceledBy","stopCountdown","ClearRide","driverDoc","mapError","driverLocationFetched","driverLocation","locationError","driver_lat","driver_lng","EnterDrivingToDestinationStage","canCheck","handleRiderToDestination","visualError","isRideStopProcessed","attempt","docData","tripId","riderId","driverName","Driver_name","driverCar","driverPlate","Driver_plate","driverRating","Driver_rating","pickup","destination","rating","completed","completedAt","saveRideHistory","historyError","remove","key","RIDE_STATE_KEY","componentProps","clearRideState","driver_marker","rider_marker","destinationMarker","routePolyline","routePath","actualDestination","bookingStage","confirmStage","trackingStage","searchingStage","noDriverStage","drivingToDestinationStage","enableCurrentLocation","docOrData","docId","requestId","EnterTrackingStage","saveRideStateToStorage","rideState","stage","getCurrentStage","set","EnterChat","options","chatData","initialTime","countdownActive","timeRemaining","updateCountdown","UpdateCountDown","handleCountdownEnd","requestNextDriver","goBackToAutoComplete","ResetState","markers","ref","cm","clearPromises","filter","m","clearMarker","updateMarkerPosition","iconUrl","title","markerSize","width","height","iconAnchor","x","y","newMarker","addMarker","iconSize","iconOrigin","zIndex","removePolylines","pinOnMap","EnterMapPinStage","mapPinDrag","home","searching","AddKnownPlace","full","whole","getLatLng","geometry","RequestRide","dat","place","EnterNoDriverStage","EnterConfirmStage","origin1","google","maps","origin2","request","origin","travelMode","TravelMode","directions","route","response","direction","routes","legs","bounds","getPriceEstimate","createAndAddMarkers","getDistanceAndDirectionsDriver","D_duration","resetLocation","addressComponents","elements","LatLngBounds","hasValidBounds","driverMap","Map","element","updatedMarkers","get","latlng","extend","existingMarkerIndex","findIndex","mapDim","offsetHeight","offsetWidth","minZoom","maxZoom","zoomLevel","getBoundsZoomLevel","max","getCenter","GoHome","GotoSupport","navigateForward","CancelRide","riderCleared","currentUser","riderDocRef","currentRequestId","bearing","CallDriver","phone","Driver_phone","replace","encodeURIComponent","open","driverLatLng","riderLatLng","driverMarker","riderMarker","photoURL","updateRoute","updatedDriverLatLng","path","overview_path","locs","geoCode","calculateCenter","availableHeight","adjustedZoomLevel","setCameraToLocation","calculateBearing","addPolyline","routeUpdate$","UPDATE_INTERVAL","pipe","polylineId","destinationLatLng","style","loc","des","polylineColor","pathPoints","polylines","strokeColor","strokeWeight","geodesic","addedPolylines","addPolylines","disableTouch","animateMarker","lastMarker","ShowDriverInfoPop","ngOnInit","navigation","getCurrentNavigation","extras","mapLoadedSubscription","mapLoadedSubject","loaded","processBookAgainData","addLocationMarker","geocodeService","geocodeAddress","addDestinationMarker","drawRoute","calculatePrice","toastCtrl","selectors","viewQuery","environment","of","HttpParams","catchError","GeocodeService","client","http","DistanceMatrixService","DirectionsService","url","apiUrl","params","apiKey","getDirections","from","to","getDistanceMatrix","distanceMatrixService","observer","origins","destinations","complete","factory","providedIn","GoogleMap","MapService","_map","config","styles","scaleControl","streetViewControl","rotateControl","fullscreenControl","enableTrafficLayer","destroyMap","destroy","points","latitudes","p","longitudes","avgLat","reduce","b","avgLng","WORLD_DIM","ZOOM_MAX","latRad","radX2","mapPx","worldPx","fraction","floor","LN2","ne","getNorthEast","sw","getSouthWest","latFraction","lngDiff","lngFraction","latZoom","lngZoom","start","end","startLat","startLng","endLat","endLng","dLng","NetworkService","networkStatus","asObservable","initializeNetworkListener","handleReconnect","handleDisconnect","checkInitialNetworkStatus","controller","AbortController","timeoutId","abort","fetch","method","mode","cache","signal","clearTimeout","fetchError","registerPlugin","web","AppWeb","exposeSynapse","GeolocationWeb","CapacitorGoogleMaps","southwest","northeast","contains","point","mapBoundsContains","mapBoundsExtend","MapType","CapacitorGoogleMapsWeb","_a","elem","document","elementFromPoint","internalId","dataset","mapInFocus","mapId","dispatchMapEvent","focus","Capacitor","MapCustomElement","HTMLElement","connectedCallback","innerHTML","getPlatform","overflow","overflowDiv","createElement","appendChild","customElements","define","resizeObserver","handleScrollEvent","updateMapBounds","callback","androidLiteMode","elementBounds","getElementBounds","devicePixelRatio","initScrolling","isNativePlatform","getMapBounds","_b","mapRect","getBoundingClientRect","onDisplay","mapBounds","onResize","ionicPage","closest","addEventListener","lastState","isHidden","ResizeObserver","observe","onMapReadyListener","retries","boundsInterval","enableClustering","minClusterSize","disableClustering","addTileOverlay","tileOverlay","res","removeTileOverlay","tileOverlayId","addMarkers","ids","markerId","removeMarkers","markerIds","addPolygons","polygons","removePolygons","polygonIds","addCircles","circles","removeCircles","circleIds","polylineIds","disableScrolling","disconnect","removeAllMapListeners","getMapType","type","setMapType","mapType","enableIndoorMaps","enabled","enableAccessibilityElements","padding","fitBounds","ionContents","getElementsByTagName","scrollEvents","screen","orientation","removeEventListener","onScroll","onCameraIdleListener","generateCallback","setOnBoundsChangedListener","onBoundsChangedListener","setOnCameraMoveStartedListener","onCameraMoveStartedListener","setOnClusterClickListener","onClusterClickListener","setOnClusterInfoWindowClickListener","onClusterInfoWindowClickListener","setOnInfoWindowClickListener","onInfoWindowClickListener","setOnMapClickListener","onMapClickListener","setOnPolygonClickListener","onPolygonClickListener","setOnCircleClickListener","onCircleClickListener","setOnMarkerClickListener","onMarkerClickListener","setOnPolylineClickListener","onPolylineClickListener","setOnMarkerDragStartListener","onMarkerDragStartListener","setOnMarkerDragListener","onMarkerDragListener","setOnMarkerDragEndListener","onMarkerDragEndListener","setOnMyLocationButtonClickListener","onMyLocationButtonClickListener","setOnMyLocationClickListener","onMyLocationClickListener","asyncScheduler","timer","period","scheduler","s","t","CapacitorUtils","Synapse","Proxy","n","w","o","r","Plugins","u","cordova","plugins","f"],"sourceRoot":"webpack:///","x_google_ignoreList":[7,8,9,10,11,12,13,14,15]}