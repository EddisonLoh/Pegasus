{"version":3,"file":"src_app_home_home_module_ts.js","mappings":"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","sources":["./src/app/home/home-routing.module.ts","./src/app/home/home.module.ts","./src/app/home/home.page.ts","./src/app/home/home.page.html","./src/app/services/geocode.service.ts","./src/app/services/map.service.ts","./src/app/services/network.service.ts","./node_modules/@capacitor/app/dist/esm/index.js","./node_modules/@capacitor/geolocation/dist/esm/index.js","./node_modules/@capacitor/google-maps/dist/esm/definitions.js","./node_modules/@capacitor/google-maps/dist/esm/implementation.js","./node_modules/@capacitor/google-maps/dist/esm/index.js","./node_modules/@capacitor/google-maps/dist/esm/map.js","./node_modules/rxjs/_esm2015/internal/observable/interval.js"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { HomePage } from './home.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: HomePage,\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class HomePageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { HomePage } from './home.page';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\n\r\nimport { HomePageRoutingModule } from './home-routing.module';\r\n\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    \r\n    IonicModule,\r\n    HomePageRoutingModule\r\n  ],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA],\r\n  declarations: [HomePage]\r\n})\r\nexport class HomePageModule {}\r\n","import { AfterViewInit, Component, ElementRef, NgZone, ViewChild } from '@angular/core';\r\nimport { Geolocation, Position } from '@capacitor/geolocation';\r\nimport { ModalOptions, ModalController, Platform, NavController, AlertController, ToastController, ActionSheetController } from '@ionic/angular';\r\nimport { AutocompleteComponent } from '../autocomplete/autocomplete.component';\r\nimport { OverlayService } from '../services/overlay.service';\r\nimport { GeocodeService } from '../services/geocode.service';\r\nimport { MapService } from '../services/map.service';\r\nimport { AvatarService } from '../services/avatar.service';\r\nimport { Drivers } from '../interfaces/drivers';\r\nimport { Observable, timer, interval, BehaviorSubject, throwError, Subscription } from 'rxjs';\r\nimport { doc as firestoreDoc, updateDoc, getDoc, collection, onSnapshot, doc, Firestore, query, where } from '@angular/fire/firestore';\r\nimport { Marker, Polyline } from '@capacitor/google-maps';\r\nimport { AuthService } from '../services/auth.service';\r\nimport { EnrouteChatComponent } from '../enroute-chat/enroute-chat.component';\r\nimport { NetworkService } from '../services/network.service'\r\nimport { Network } from '@capacitor/network';\r\nimport { Router } from '@angular/router';\r\nimport { App } from '@capacitor/app';\r\nimport { PaymentService } from '../services/payment.service';\r\nimport { AddCardComponent } from '../add-card/add-card.component';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { LatLngLiteral } from '@googlemaps/google-maps-services-js';\r\nimport { LatLng } from '@capacitor/google-maps/dist/typings/definitions';\r\nimport { Preferences } from '@capacitor/preferences';\r\nimport { Auth, onAuthStateChanged } from '@angular/fire/auth';\r\nimport Debug from 'onesignal-cordova-plugin/dist/DebugNamespace';\r\nimport { TripSummaryComponent } from '../trip-summary/trip-summary.component';\r\nimport { geohashForLocation } from 'geofire-common';\r\n\r\ndeclare var google;\r\n\r\n@Component({\r\n  selector: 'app-home',\r\n  templateUrl: 'home.page.html',\r\n  styleUrls: ['home.page.scss'],\r\n})\r\nexport class HomePage implements AfterViewInit {\r\n  [x: string]: any;\r\n  profile = null;\r\n  @ViewChild('map',  { static: true }) mapRef: ElementRef<HTMLElement>;\r\n  @ViewChild('topBar', { static: true }) topBar: ElementRef<HTMLElement>;\r\n  @ViewChild('bottomBar', { static: true }) bottomBar: ElementRef<HTMLElement>;\r\n  mappy;\r\n  @ViewChild('mapElement') mapElement: ElementRef<HTMLElement>;\r\n  coordinates: Position;\r\n  address: any = 'Unknown';\r\n  bookingStage: any;\r\n  confirmStage: any;\r\n  trackingStage: any;\r\n  searchingStage: any;\r\n  noDriverStage: any;\r\n  drivingToDestinationStage: any;\r\n  data: any;\r\n  cash: any = false;\r\n  state: any = [];\r\n  mapPinStage: boolean;\r\n  D_LatLng: { lat: any; lng: any; };\r\n  mapPinDrag: any;\r\n  showResetLocationButton: any = false;\r\n  showloader: boolean;\r\n  mapClass: any;\r\n  destinationAddress: string = 'Drag To Pick Destination';\r\n  locationAddress: string = null;\r\n  distance: any;\r\n  direction: any;\r\n  actualDestination: any;\r\n  markers: any;\r\n  allDrivers: Observable<Drivers[]>;\r\n  NoDrivers: boolean;\r\n  driverMarker: string;\r\n  driver_duration_apart: number;\r\n  driver_number_of_seats: any;\r\n  price: any = 0;\r\n  carname: any;\r\n  driver_ID: any;\r\n  bounds: any;\r\n  DriverLatLng: { lat: any; lng: any; };\r\n  drivers_Requested: any[];\r\n  current_Request_Number: number = -1;\r\n  Driver_Rejected: any;\r\n  numCalls: any;\r\n  currentDriver: any;\r\n  private countdownActive = false;\r\n\r\n  unsubscribe: import(\"@angular/fire/firestore\").Unsubscribe;\r\n  driverInfo: import(\"@angular/fire/firestore\").DocumentData;\r\n  duration: any = null;\r\n  riderCleared: any;\r\n  updateDriverSubcription: any;\r\n  canCheck: boolean;\r\n  marker1: any;\r\n  marker2: any;\r\n  actualLocation: string;\r\n  LatLng: { lat: number; lng: number; };\r\n  mapy: boolean;\r\n  AllCarMarkers: Marker[];\r\n  private _carmarkers: { id: string, marker: any }[] = [];\r\n  private rider_marker: any;\r\n  private driver_marker: any;\r\n\r\n  cards: import(\"@angular/fire/firestore\").DocumentData[];\r\n  selected: any;\r\n  selectedCard: any;\r\n  closeDrivers: any;\r\n  countDown: any;\r\n  places: import(\"@angular/fire/firestore\").DocumentData[];\r\n  newPoly: string[];\r\n  isConnected: boolean;\r\n  private networkStatus$ = new BehaviorSubject<boolean>(true);\r\n  pollingInterval: any;\r\n  animatedMarker: any;\r\n  driverImage: any;\r\n  private permissionCheckInterval: any;\r\n  savedPaymentMethods: any;\r\n  requestID: string;\r\n  rideHasStarted: boolean;\r\n  driverLocation: { lat: number, lng: number } | null = null;\r\n  stopPolling: boolean = false;\r\n  riderMarker: string;\r\n  routePath: google.maps.MVCArray<google.maps.LatLng> | (google.maps.LatLng | google.maps.LatLngLiteral)[];\r\n  destinationMarker: any;\r\n  D_duration: any;\r\n  routePolyline: any;\r\n  private routeUpdateSubscription: Subscription;\r\n  topBarHeight: any;\r\n  bottomBarHeight:any;\r\n  private readonly RIDE_STATE_KEY = 'activeRideState';\r\n  private isLoadingDriver = false;\r\n\r\n  // Add these stage constants at the class level\r\n  private readonly STAGES = {\r\n    BOOKING: 'booking',\r\n    CONFIRM: 'confirm',\r\n    TRACKING: 'tracking',\r\n    SEARCHING: 'searching',\r\n    DRIVING: 'driving',\r\n    NO_DRIVER: 'noDriver',\r\n    MAP_PIN: 'mapPin',\r\n    NO_DRIVERS: 'noDrivers'\r\n  } as const;\r\n\r\n  // Add this to your class properties\r\n  private lastHandledState: string | null = null;\r\n\r\n  // Add this property to the class\r\n  private isRideStopProcessed = false;\r\n\r\n  constructor(\r\n    private auth: Auth,\r\n    private authService: AuthService,\r\n    private router: Router,\r\n    private networkService: NetworkService,\r\n    public map: MapService,\r\n    private nav: NavController,\r\n    private platform: Platform,\r\n    private firestore: Firestore,\r\n    private readonly database: AvatarService,\r\n    private ngZone: NgZone,\r\n    private geocode: GeocodeService,\r\n    private overlay: OverlayService,\r\n    private modalCtrl: ModalController,\r\n    private alert: AlertController,\r\n    private payME: PaymentService,\r\n    private toastController: ToastController,\r\n    private actionSheetController: ActionSheetController\r\n  \r\n  ) {\r\n    this.initializeApp();\r\n  }\r\n\r\n  async ngOnDestroy() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    window.removeEventListener('resize', this.setMapHeight.bind(this));\r\n    this.clearSubscriptions();\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n  }\r\n\r\n\r\n  async ngAfterViewInit() {\r\n    try {\r\n      // First check location permissions\r\n      const hasPermission = await this.checkAndRequestLocationPermissions();\r\n      if (!hasPermission) {\r\n        return;\r\n      }\r\n      \r\n      // Initialize profile first\r\n      await this.initializeProfile();\r\n      \r\n      // Then proceed with other initializations\r\n      await this.initializeApp();\r\n      await this.initializeNetworkMonitoring();\r\n      await this.fetchSavedPaymentMethods();\r\n      this.EnterBookingStage();\r\n      await this.initializeGeolocation();\r\n      await this.initializeMap();\r\n      \r\n      // Set up real-time listener for ride state\r\n      this.initializeRideStateListener();\r\n    } catch (e) {\r\n      console.error('Error in ngAfterViewInit:', e);\r\n      this.overlay.hideLoader();\r\n      this.overlay.showAlert('Error', 'An error occurred during initialization. Please try again.');\r\n    }\r\n  }\r\n\r\n  // Add this new method\r\n  private async initializeProfile() {\r\n    try {\r\n      // Show loader while initializing profile\r\n     // await this.overlay.showLoader('Loading profile...');\r\n\r\n      // Wait for auth state to be ready\r\n      const user = await new Promise<any>((resolve) => {\r\n        const unsubscribe = onAuthStateChanged(this.auth, (user) => {\r\n          unsubscribe();\r\n          resolve(user);\r\n        });\r\n      });\r\n\r\n      if (!user) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n\r\n      // Get profile data\r\n      this.profile = await this.database.getUserProfile();\r\n      \r\n      if (!this.profile) {\r\n        console.log('Creating new profile...');\r\n        // If profile doesn't exist, create it with default values\r\n        this.profile = {\r\n          userId: user.uid,\r\n          email: user.email,\r\n          createdAt: new Date().toISOString(),\r\n          // Add any other default profile fields you need\r\n        };\r\n        await this.database.createUserProfile(this.profile);\r\n      }\r\n\r\n      console.log('Profile initialized:', this.profile);\r\n      this.overlay.hideLoader();\r\n    } catch (error) {\r\n      console.error('Error initializing profile:', error);\r\n      this.overlay.hideLoader();\r\n      await this.overlay.showAlert(\r\n        'Profile Error',\r\n        'Unable to initialize user profile. Please try again or contact support.'\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Add this method to check profile before any ride-related action\r\n  private async ensureProfileInitialized(): Promise<boolean> {\r\n    if (!this.profile) {\r\n      try {\r\n        await this.initializeProfile();\r\n        return true;\r\n      } catch (error) {\r\n        console.error('Error ensuring profile is initialized:', error);\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private initializeRideStateListener() {\r\n    console.log('Initializing ride state listener');\r\n    \r\n    // Reset lastHandledState on initialization to ensure proper state restoration\r\n    this.lastHandledState = null;\r\n    \r\n    onAuthStateChanged(this.auth, (user) => {\r\n      if (!user) return;\r\n\r\n      // Listen to the Request collection for active rides for this user\r\n      const requestsQuery = query(\r\n        collection(this.firestore, 'Request'),\r\n        where('Rider_id', '==', user.uid),\r\n        where('status', 'in', ['pending', 'confirmed', 'started'])\r\n      );\r\n\r\n      this.unsubscribe = onSnapshot(requestsQuery, async (snapshot) => {\r\n        try {\r\n          // If no active rides found, go to booking stage\r\n          if (snapshot.empty) {\r\n            console.log('No active rides found');\r\n            this.setStage(this.STAGES.BOOKING);\r\n            return;\r\n          }\r\n\r\n          // Get the most recent active ride\r\n          const activeRides = snapshot.docs;\r\n          const currentRide = activeRides[0];\r\n          const rideData = currentRide.data();\r\n          this.requestID = currentRide.id;\r\n\r\n          // Restore price information\r\n          this.price = rideData.price || 0;\r\n          console.log('Restored ride price:', this.price);\r\n          console.log('Current ride status:', rideData.status);\r\n\r\n          // IMPORTANT: On app initialization, always restore ride state regardless of lastHandledState\r\n          const isAppInitialization = !this.lastHandledState;\r\n          \r\n          // Only skip if we've already handled this state AND it's not initial app load\r\n          if (this.lastHandledState === rideData.status && !isAppInitialization) {\r\n            console.log('State already properly handled:', rideData.status);\r\n            return;\r\n          }\r\n\r\n          // Store location data for later use\r\n          if (rideData.Loc_lat && rideData.Loc_lng) {\r\n            this.LatLng = {\r\n              lat: rideData.Loc_lat,\r\n              lng: rideData.Loc_lng\r\n            };\r\n          }\r\n          \r\n          if (rideData.Des_lat && rideData.Des_lng) {\r\n            this.D_LatLng = {\r\n              lat: rideData.Des_lat,\r\n              lng: rideData.Des_lng\r\n            };\r\n          }\r\n          \r\n          // Store addresses\r\n          this.locationAddress = rideData.Rider_Location || 'Unknown location';\r\n          this.destinationAddress = rideData.Rider_Destination || 'Unknown destination';\r\n\r\n          console.log('Restoring ride state:', rideData.status);\r\n\r\n          // Handle different ride states\r\n          switch (rideData.status) {\r\n            case 'pending':\r\n              await this.handlePendingState();\r\n              break;\r\n            case 'confirmed':\r\n              console.log('Handling confirmed state on restore...');\r\n              await this.handleRideConfirmation(rideData);\r\n              break;\r\n            case 'started':\r\n              await this.handleRideStart(currentRide);\r\n              break;\r\n            case 'cancelled':\r\n              await this.handleRideCancellation(rideData);\r\n              break;\r\n            default:\r\n              console.log('Unknown ride status:', rideData.status);\r\n              this.setStage(this.STAGES.BOOKING);\r\n          }\r\n          \r\n          // Only update lastHandledState AFTER successful handling\r\n          this.lastHandledState = rideData.status;\r\n          \r\n        } catch (error) {\r\n          console.error('Error handling ride state:', error);\r\n          if (error.code === 'permission-denied' || error.code === 'not-found') {\r\n            this.overlay.showAlert('Error', 'Failed to restore ride state. Please try again.');\r\n            this.setStage(this.STAGES.BOOKING);\r\n          }\r\n        }\r\n      }, (error) => {\r\n        console.error('Error in ride state listener:', error);\r\n        this.setStage(this.STAGES.BOOKING);\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  private handleRemovedRide() {\r\n    console.log('Ride was removed');\r\n    this.clearRideData();\r\n    this.setStage(this.STAGES.BOOKING);\r\n  }\r\n\r\n  private clearRideData() {\r\n    this.requestID = null;\r\n    this.driverInfo = null;\r\n    this.rideHasStarted = false;\r\n    this.lastHandledState = null;\r\n    // Clear any other ride-specific data\r\n  }\r\n\r\n  async checkAndRequestLocationPermissions() {\r\n    try {\r\n      // Check if running on web platform\r\n      if (this.platform.is('capacitor')) {\r\n        const permissionStatus = await Geolocation.checkPermissions();\r\n        \r\n        if (permissionStatus.location === 'granted') {\r\n          this.overlay.hideLoader();\r\n          return true;\r\n        }\r\n\r\n        const alert = await this.alert.create({\r\n          header: 'Location Permission Required',\r\n          message: 'This app needs access to your location to function properly.',\r\n          buttons: [\r\n            {\r\n              text: 'Enable Location',\r\n              handler: async () => {\r\n                const newStatus = await Geolocation.requestPermissions();\r\n                this.overlay.hideLoader();\r\n                \r\n                if (newStatus.location !== 'granted') {\r\n                  await this.showLocationRequiredAlert();\r\n                  return false;\r\n                }\r\n                return true;\r\n              }\r\n            }\r\n          ],\r\n          backdropDismiss: false\r\n        });\r\n\r\n        await alert.present();\r\n        const { role } = await alert.onDidDismiss();\r\n        \r\n        if (role === 'backdrop') {\r\n          this.overlay.hideLoader();\r\n          await this.showLocationRequiredAlert();\r\n          return false;\r\n        }\r\n      } else {\r\n        // Web platform - use browser's geolocation API\r\n        if ('geolocation' in navigator) {\r\n          return new Promise((resolve) => {\r\n            navigator.permissions.query({ name: 'geolocation' }).then((result) => {\r\n              if (result.state === 'granted') {\r\n                this.overlay.hideLoader();\r\n                resolve(true);\r\n              } else {\r\n                this.overlay.hideLoader();\r\n                resolve(this.showWebLocationPrompt());\r\n              }\r\n            });\r\n          });\r\n        } else {\r\n          this.overlay.hideLoader();\r\n          await this.overlay.showAlert('Error', 'Geolocation is not supported in this browser.');\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error checking/requesting location permissions:', error);\r\n      this.overlay.hideLoader();\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async showWebLocationPrompt(): Promise<boolean> {\r\n    const alert = await this.alert.create({\r\n      header: 'Location Access',\r\n      message: 'This app needs your location. Please allow location access when prompted by your browser.',\r\n      buttons: [\r\n        {\r\n          text: 'OK',\r\n          handler: () => {\r\n            return new Promise((resolve) => {\r\n              navigator.geolocation.getCurrentPosition(\r\n                () => resolve(true),\r\n                () => {\r\n                  this.showLocationRequiredAlert();\r\n                  resolve(false);\r\n                }\r\n              );\r\n            });\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n    return true;\r\n  }\r\n\r\n  private async showLocationRequiredAlert() {\r\n    const alert = await this.alert.create({\r\n      header: 'Location Required',\r\n      message: 'Location permission is required to use this app. Please enable location services in your device settings.',\r\n      buttons: ['OK']\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async fetchSavedPaymentMethods() {\r\n    try {\r\n      this.savedPaymentMethods = await this.database.getSavedPaymentMethods();\r\n      console.log('Saved Payment Methods:', this.savedPaymentMethods);\r\n      \r\n      // Set default payment method to cash if no cards are saved\r\n      if (this.savedPaymentMethods.length === 0) {\r\n        this.selectedCard = 'cash';\r\n        this.cash = true;\r\n      } else {\r\n        this.selectedCard = this.savedPaymentMethods[0].cardId;\r\n        this.cash = false;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching saved payment methods:', error);\r\n    }\r\n  }\r\n\r\n  chooseCard(event: any) {\r\n    this.selectedCard = event.detail.value;\r\n    this.cash = this.selectedCard === 'cash';\r\n    if (!this.cash) {\r\n     // this.processPayment(this.authService.user.email, this.defaultAmount, this.selectedCard);\r\n    }\r\n  }\r\n\r\n  async processPayment(email: string, amount: number, cardId: any) {\r\n    this.overlay.showLoader('Processing payment...');\r\n\r\n    try {\r\n      const paymentResult = await this.payME.processPaymentWithCardId(email, amount, cardId).toPromise();\r\n      console.log('Payment successful:', paymentResult);\r\n      await this.overlay.showAlert('Success', 'Payment successful!');\r\n    } catch (error) {\r\n      console.error('Error during payment:', error);\r\n      const errorMessage = error.error ? error.error.error : 'An unexpected error occurred.';\r\n      await this.showPaymentErrorModal(errorMessage);\r\n    } finally {\r\n      this.overlay.hideLoader();\r\n    }\r\n  }\r\n\r\n  async showPaymentErrorModal(errorMessage: string) {\r\n    const alert = await this.alert.create({\r\n      header: 'Payment Error',\r\n      message: errorMessage,\r\n      buttons: [\r\n        {\r\n          text: 'Add New Card',\r\n          handler: async () => {\r\n            const modal = await this.modalCtrl.create({\r\n              component: AddCardComponent, // Create this component to handle adding a new card\r\n            });\r\n            await modal.present();\r\n            const { data } = await modal.onWillDismiss();\r\n            if (data && data.newCardId) {\r\n              this.selectedCard = data.newCardId;\r\n              this.cash = false;\r\n            }\r\n          }\r\n        },\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n\r\n  // Add this single unified method for all map height calculations\r\n  setMapContainerHeight(extraPadding = 0) {\r\n    if (!this.mapRef || !this.topBar || !this.bottomBar) return;\r\n    \r\n    // Get proper measurements of the bars\r\n    const topHeight = this.topBar.nativeElement.offsetHeight || 0;\r\n    const bottomHeight = this.bottomBar.nativeElement.offsetHeight || 0;\r\n    \r\n    // Calculate available height properly\r\n    const availableHeight = window.innerHeight - topHeight - bottomHeight + extraPadding;\r\n    \r\n    // Set map height\r\n    this.mapRef.nativeElement.style.height = `${availableHeight}px`;\r\n    \r\n    // Ensure map container is positioned properly\r\n    this.mapRef.nativeElement.style.top = `${topHeight}px`;\r\n    this.mapRef.nativeElement.style.position = 'absolute';\r\n    this.mapRef.nativeElement.style.zIndex = '1'; // Lower than UI elements\r\n    this.mapRef.nativeElement.style.left = '0';\r\n    this.mapRef.nativeElement.style.right = '0';\r\n    \r\n    console.log(`Map container height set to: ${availableHeight}px (top: ${topHeight}px, bottom: ${bottomHeight}px)`);\r\n  }\r\n\r\n  // Update these methods to use the unified approach\r\n  setMapHeight() {\r\n    this.setMapContainerHeight(0);\r\n  }\r\n\r\n  setMapHeightCreateAndAddMarkers() {\r\n    this.setMapContainerHeight(40); // Add some padding if needed\r\n  }\r\n\r\n  setMapHeightHandleDrivertoRider() {\r\n    this.setMapContainerHeight(20);\r\n  }\r\n\r\n  setMapHeightHandleDrivertoDestination() {\r\n    this.setMapContainerHeight(0);\r\n  }\r\n\r\n  ResetMapHeight() {\r\n    this.setMapContainerHeight(0);\r\n  }\r\n\r\n  private async initializeNetworkMonitoring() {\r\n    const status = await Network.getStatus();\r\n    this.isConnected = status.connected;\r\n    this.networkStatus$.next(this.isConnected);\r\n    console.log('Network monitoring initialized. Initial status:', this.isConnected);\r\n\r\n    Network.addListener('networkStatusChange', (status) => {\r\n      console.log('Network status changed:', status);\r\n      this.isConnected = status.connected;\r\n      this.networkStatus$.next(this.isConnected);\r\n    });\r\n\r\n    this.networkStatus$.subscribe((isConnected) => {\r\n      if (isConnected) {\r\n        this.router.navigate(['home']);\r\n      } else {\r\n        this.router.navigate(['network']);\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  initializeApp() {\r\n    this.platform.ready().then(async () => {\r\n      try {\r\n        await this.initializeRideStateListener();\r\n      } catch (error) {\r\n        console.error('Error initializing app:', error);\r\n        this.setStage(this.STAGES.BOOKING);\r\n      }\r\n    });\r\n  }\r\n\r\n  \r\n \r\n  async initializeGeolocation() {\r\n    try {\r\n      let coordinates;\r\n      \r\n      if (this.platform.is('capacitor')) {\r\n        coordinates = await Geolocation.getCurrentPosition({\r\n          timeout: 10000\r\n        });\r\n      } else {\r\n        // Web fallback\r\n        coordinates = await new Promise((resolve, reject) => {\r\n          navigator.geolocation.getCurrentPosition(\r\n            (position) => {\r\n              resolve({\r\n                coords: {\r\n                  latitude: position.coords.latitude,\r\n                  longitude: position.coords.longitude,\r\n                  accuracy: position.coords.accuracy,\r\n                  altitude: position.coords.altitude,\r\n                  altitudeAccuracy: position.coords.altitudeAccuracy,\r\n                  heading: position.coords.heading,\r\n                  speed: position.coords.speed\r\n                },\r\n                timestamp: position.timestamp\r\n              });\r\n            },\r\n            (error) => reject(error),\r\n            { timeout: 10000 }\r\n          );\r\n        });\r\n      }\r\n      \r\n      this.coordinates = coordinates;\r\n      this.LatLng = {\r\n        lat: coordinates.coords.latitude,\r\n        lng: coordinates.coords.longitude\r\n      };\r\n      \r\n      await this.database.updateLocation(this.LatLng);\r\n      console.log('Geolocation initialized:', this.LatLng);\r\n      \r\n      this.startPollingPosition();\r\n    } catch (error) {\r\n      console.error('Error initializing geolocation:', error);\r\n      this.overlay.hideLoader();\r\n      await this.overlay.showAlert(\r\n        'Location Error',\r\n        'Unable to get your location. Please check your device settings and try again.'\r\n      );\r\n    }\r\n  }\r\n  \r\n  startPermissionPolling() {\r\n    this.permissionCheckInterval = setInterval(async () => {\r\n      const permissionStatus = await Geolocation.checkPermissions();\r\n      if (permissionStatus.location === 'granted') {\r\n        this.overlay.hideLoader();\r\n        clearInterval(this.permissionCheckInterval);\r\n        // Try to get the current position again if permissions are granted\r\n        const coordinates = await Geolocation.getCurrentPosition();\r\n        this.coordinates = coordinates;\r\n        this.LatLng = {\r\n          lat: coordinates.coords.latitude,\r\n          lng: coordinates.coords.longitude,\r\n        };\r\n        console.log('Geolocation initialized:', this.LatLng);\r\n  \r\n        // Start polling the user's position\r\n        this.startPollingPosition();\r\n      }\r\n    }, 1000); // Check every second\r\n  }\r\n\r\n  \r\n  startPollingPosition() {\r\n    let lastLatLng = { lat: null, lng: null };\r\n    let lastAddress = null;\r\n  \r\n    this.pollingInterval = setInterval(async () => {\r\n      try {\r\n        let position;\r\n        \r\n        if (this.platform.is('capacitor')) {\r\n          position = await Geolocation.getCurrentPosition();\r\n        } else {\r\n          // Web fallback\r\n          position = await new Promise((resolve, reject) => {\r\n            navigator.geolocation.getCurrentPosition(resolve, reject);\r\n          });\r\n        }\r\n\r\n        const newLatLng = {\r\n          lat: position.coords.latitude,\r\n          lng: position.coords.longitude,\r\n        };\r\n\r\n        await this.database.updateLocation(newLatLng);\r\n  \r\n        if (this.hasSignificantLocationChange(lastLatLng, newLatLng, 50)) { // Check if moved at least 50 meters\r\n          lastLatLng = newLatLng;\r\n  \r\n          const address = await this.map.getAddress(newLatLng.lat, newLatLng.lng);\r\n          \r\n          if (address && address.results && address.results.length > 1) {\r\n            const components = address.results[1].address_components;\r\n            if (components.length >= 2) {\r\n              this.locationAddress = components[0].long_name + ' ' + components[1].long_name;\r\n              this.actualLocation = address.results[0].formatted_address;\r\n              if (this.locationAddress !== lastAddress) {\r\n                console.log('Updated Location Address:', this.locationAddress);\r\n                lastAddress = this.locationAddress;\r\n              }\r\n            }\r\n          } else {\r\n            console.log('Unable to update location address');\r\n          }\r\n        }\r\n  \r\n        if (this.networkService.isConnected() && !this.stopPolling) {\r\n          const center: [number, number] = [newLatLng.lat, newLatLng.lng];\r\n          const radiusInM = 5000; // Example radius in meters\r\n          await this.fetchAndDisplayDrivers(center, radiusInM);\r\n        } else {\r\n          console.log('No network connection.', this.stopPolling);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error getting position:', err);\r\n        // Reduce error alerts by not showing specific errors repeatedly\r\n      }\r\n    }, 5000); // Poll every 10 seconds\r\n  }\r\n  \r\n  hasSignificantLocationChange(oldLatLng, newLatLng, minDistance) {\r\n    if (!oldLatLng.lat || !oldLatLng.lng) return true;\r\n    \r\n    const R = 6371e3; // Earth radius in meters\r\n    const 1 = oldLatLng.lat * Math.PI/180;\r\n    const 2 = newLatLng.lat * Math.PI/180;\r\n    const  = (newLatLng.lat - oldLatLng.lat) * Math.PI/180;\r\n    const  = (newLatLng.lng - oldLatLng.lng) * Math.PI/180;\r\n  \r\n    const a = Math.sin(/2) * Math.sin(/2) +\r\n              Math.cos(1) * Math.cos(2) *\r\n              Math.sin(/2) * Math.sin(/2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n  \r\n    const distance = R * c; // Distance in meters\r\n  \r\n    return distance >= minDistance;\r\n  }\r\n\r\n  \r\n  stopPollingPosition() {\r\n    if (this.pollingInterval) {\r\n      clearInterval(this.pollingInterval);\r\n      this.pollingInterval = null;\r\n      console.log('Stopped polling position.');\r\n    } else {\r\n      console.log('No polling to stop.');\r\n    }\r\n  }\r\n  \r\n  async initializeMap() {\r\n    try {\r\n      // Ensure coordinates are available before creating map\r\n      \r\n      if (!this.coordinates || !this.coordinates.coords) {\r\n         await this.overlay.showAlert('Coordinates not available, using default location', '');\r\n        console.warn('Coordinates not available, using default location');\r\n        // Use default coordinates (Kuala Lumpur, Malaysia)\r\n        this.coordinates = {\r\n          coords: {\r\n            latitude: 3.1390,\r\n            longitude: 101.6869,\r\n            accuracy: 0,\r\n            altitude: null,\r\n            altitudeAccuracy: null,\r\n            heading: null,\r\n            speed: null\r\n          },\r\n          timestamp: Date.now()\r\n        };\r\n      }\r\n      \r\n      await this.map.createMap(this.mapRef.nativeElement, this.coordinates);\r\n      this.mapy = true;\r\n      this.actualLocation = this.map.actualLocation;\r\n     // console.log('Map initialized:', this.actualLocation, this.locationAddress);\r\n    } catch (error) {\r\n      this.overlay.showAlert('Error initializing map:', error);\r\n      throw new Error('Map initialization failed');\r\n    }\r\n  }\r\n  \r\n  initializeDatabaseSubscriptions() {\r\n    this.database.getKnownPlaces().subscribe((d) => {\r\n      console.log('Received data:', d);\r\n      this.places = d.slice(0, 3);\r\n    });\r\n  }\r\n\r\n\r\n  initializeBackButtonCustomHandler(): void {\r\n    this.platform.backButton.subscribeWithPriority(10, () => {\r\n      console.log('Back button pressed');\r\n    });\r\n  \r\n    App.addListener('backButton', ({ canGoBack }) => {\r\n      if (!canGoBack) {\r\n        // Show a confirmation dialog before exiting the app\r\n        if (confirm('Are you sure you want to exit the app?')) {\r\n          App.exitApp();\r\n        }\r\n      } else {\r\n        console.log(\"back clicked\");\r\n        // Use Ionic's NavController to navigate back\r\n        // Replace 'NavController' with your specific navigation method\r\n        // this.navCtrl.pop();\r\n        window.history.back();\r\n      }\r\n    });\r\n\r\n    // App.addListener('appStateChange', (state) => {\r\n    //   if (!state.isActive) {\r\n    //     this.stopPollingPosition();\r\n    //   } else {\r\n    //     this.startPollingPosition();\r\n    //   }\r\n    // });\r\n  }\r\n  \r\n\r\n\r\n  \r\n  setupMapListeners() {\r\n    this.map.newMap.setOnCameraIdleListener(async (g) => {\r\n      this.ngZone.run(async () => {\r\n        this.showResetLocationButton = true;\r\n        if (this.mapPinStage) {\r\n          const addressResponse = await this.geocode.getAddress(g.latitude, g.longitude).toPromise();\r\n          this.processAddressResponse(addressResponse);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  async logout() {\r\n    await this.authService.logout();\r\n  }\r\n  \r\n  async fetchAndDisplayDrivers(center: [number, number], radiusInM: number): Promise<void> {\r\n    try {\r\n      const drivers: Drivers[] = await this.database.checkDriversWithin(center, radiusInM);\r\n      console.log('Fetched drivers:', drivers);\r\n  \r\n      await this.handleDrivers(drivers);\r\n  \r\n      if (this.drivers_Requested.length > 0) {\r\n        this.current_Request_Number = 0; // Set to the first available driver\r\n        await this.UpdateCarMarker(this.drivers_Requested);\r\n        this.NoDrivers = false;\r\n      } else {\r\n        this.current_Request_Number = -1; // No valid driver\r\n        await this.UpdateCarMarker([]); // Clear all markers if no drivers are requested\r\n        this.NoDrivers = true;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching drivers:', error);\r\n      this.current_Request_Number = -1; // Reset the request number\r\n      await this.UpdateCarMarker([]); // Clear all markers if there's an error\r\n      this.NoDrivers = true;\r\n    }\r\n  }\r\n  \r\n  \r\n  async handleDrivers(drivers: Drivers[]) {\r\n    this.drivers_Requested = [];\r\n    this.closeDrivers = null;\r\n  \r\n    console.log('Handling drivers:', drivers);\r\n  \r\n    if (drivers.length === 0) {\r\n      this.NoDrivers = true;\r\n      console.log('No drivers found.');\r\n      return;\r\n    }\r\n  \r\n    drivers.forEach((driver) => {\r\n      if (driver) {\r\n        console.log('Processing driver:', driver);\r\n        if (driver.duration <= 1000 && driver.onlineState) {\r\n          this.drivers_Requested.push(driver);\r\n          this.updateDriverInfo(driver);\r\n        }\r\n  \r\n        if (!this.closeDrivers || driver.duration < this.closeDrivers.duration) {\r\n          this.closeDrivers = driver;\r\n        }\r\n      } else {\r\n        console.error('Driver is null or undefined:', driver);\r\n      }\r\n    });\r\n  \r\n    if (this.drivers_Requested.length === 0) {\r\n      this.NoDrivers = true;\r\n    } else {\r\n      // Ensuring current_Request_Number is within the bounds\r\n      this.current_Request_Number = Math.min(this.current_Request_Number, this.drivers_Requested.length - 1);\r\n    }\r\n  \r\n    console.log('Final requested drivers list:', this.drivers_Requested);\r\n  }\r\n  \r\n   // Unsubscribe from all active listeners (for cleanup)\r\n   cleanupListeners() {\r\n    Object.values(this.database.activeListeners).forEach(unsubscribe => unsubscribe());\r\n    this.database.activeListeners = {};\r\n  }\r\n \r\n  \r\n  updateDriverInfo(driver) {\r\n    console.log(this.drivers_Requested);\r\n    this.carname = driver.Driver_car;\r\n    this.driverImage = driver.Driver_imgUrl,\r\n    this.driver_duration_apart = Math.ceil(driver.duration / 60000);\r\n    this.driver_ID = driver.Driver_id;\r\n    this.driver_number_of_seats = driver.seats;\r\n    this.DriverLatLng = {\r\n      lat: driver.Driver_lat,\r\n      lng: driver.Driver_lng\r\n    };\r\n  }\r\n  \r\n  async StartRide() {\r\n    if (this.isLoadingDriver) {\r\n      console.log('Ride request already in progress...');\r\n      return;\r\n    }\r\n\r\n    this.isLoadingDriver = true;\r\n    this.overlay.showLoader('Preparing your ride...');\r\n\r\n    try {\r\n      // Group operations that can be done concurrently\r\n      await Promise.all([\r\n        this.clearPrevMarkers(),\r\n        this.clearAllPolylines()\r\n      ]);\r\n      \r\n      this.map.newMap.enableTouch();\r\n      await this.BookRide();\r\n      \r\n    } catch (error) {\r\n      console.error('Error starting ride:', error);\r\n      await this.overlay.showAlert('Starting Ride Error', error.message || 'Failed to start ride');\r\n    } finally {\r\n      // Ensure we always hide the loader and reset the loading state\r\n      this.isLoadingDriver = false;\r\n      this.overlay.hideLoader();\r\n    }\r\n  }\r\n\r\nasync clearMarkers() {\r\n  if (this.marker1) {\r\n    await this.map.newMap.removeMarker(this.marker1);\r\n    this.marker1 = null;\r\n  }\r\n\r\n  if (this.marker2) {\r\n    await this.map.newMap.removeMarker(this.marker2.toString());\r\n    this.marker2 = null;\r\n  }\r\n\r\n  if (this._carmarkers) {\r\n    for (const { marker } of this._carmarkers) {\r\n      await this.map.newMap.removeMarker(marker); // Assuming marker is the instance\r\n    }\r\n    this._carmarkers = []; // Clear the array after removing markers\r\n  }\r\n}\r\n\r\nasync BookRide() {\r\n  try {\r\n    if (!await this.ensureProfileInitialized()) {\r\n      throw new Error('Profile not initialized');\r\n    }\r\n    if (!this.hasValidDriver()) {\r\n      this.showNoDriversAlert();\r\n      return;\r\n    }\r\n    \r\n    const driver = this.drivers_Requested[this.current_Request_Number];\r\n    const userDocRef = doc(this.firestore, `Drivers`, driver.Driver_id);\r\n    \r\n    const docSnapshot = await getDoc(userDocRef);\r\n    \r\n    if (!docSnapshot.exists()) {\r\n      throw new Error('Driver document not found');\r\n    }\r\n\r\n    const data = docSnapshot.data();\r\n    if (!data?.onlineState) {\r\n      await this.handleNoAvailableDriver();\r\n      return;\r\n    }\r\n\r\n    this.driverInfo = data;\r\n    await this.requestRideWithDriverDetails(driver, userDocRef);\r\n    this.updateDriverInfo(driver);\r\n    \r\n  } catch (error) {\r\n    console.error('Error in BookRide:', error);\r\n    this.overlay.showAlert('Error', 'Unable to book ride. Please try again.');\r\n  }\r\n}\r\n\r\nhasValidDriver(): boolean {\r\n  return this.drivers_Requested?.[this.current_Request_Number]?.Driver_id != null;\r\n}\r\n\r\nasync requestRideWithDriverDetails(driver, userDocRef) {\r\n  try {\r\n    if (!await this.ensureProfileInitialized()) {\r\n      throw new Error('Profile not initialized');\r\n    }\r\n    const requestDetails = {\r\n      latLng: this.LatLng,\r\n      destinationAddress: this.destinationAddress,\r\n      locationAddress: this.locationAddress,\r\n      dLatLng: this.D_LatLng,\r\n      driverId: driver.Driver_id,\r\n      price: this.price,\r\n      cash: this.cash\r\n    };\r\n\r\n    this.requestID = await this.database.RequestRideWithRiderDetails(requestDetails);\r\n\r\n    if (this.requestID) {\r\n      this.currentDriver = driver;\r\n      \r\n      // Set up listener before handling pending state\r\n      const rideRequestDocRef = doc(this.firestore, `Request`, this.requestID);\r\n      const unsub = onSnapshot(rideRequestDocRef, async (doc) => {\r\n        if (doc.exists()) {\r\n          await this.handleRideUpdates(doc);\r\n        } else {\r\n          console.error('Ride request document does not exist.');\r\n        }\r\n      });\r\n\r\n      this.unsubscribe = unsub;\r\n      \r\n      // Now handle the pending state\r\n      await this.handlePendingState();\r\n    } else {\r\n      throw new Error('Failed to generate requestID');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in requestRideWithDriverDetails:', error);\r\n    this.overlay.showAlert('Error', 'Unable to request ride. Please try again.');\r\n  }\r\n}\r\n\r\nshowNoDriversAlert() {\r\n  console.error('No valid driver available to book a ride.');\r\n  this.overlay.showAlert('No Drivers ', 'No available drivers found. Please try again later.');\r\n}\r\n\r\nasync handleNoAvailableDriver() {\r\n  console.log('Driver is not available, moving to next.');\r\n  this.current_Request_Number++;\r\n  if (this.hasValidDriver()) {\r\n    await this.BookRide();\r\n  } else {\r\n    this.showNoDriversAlert();\r\n  }\r\n}\r\n\r\n// Make sure to clear the subscription when it's no longer needed\r\nclearSubscriptions() {\r\n  console.log('Clearing all subscriptions');\r\n  \r\n  // Clear routeUpdateSubscription first as it's the main culprit\r\n  if (this.routeUpdateSubscription) {\r\n    this.routeUpdateSubscription.unsubscribe();\r\n    this.routeUpdateSubscription = null;\r\n  }\r\n  \r\n  // Clear other subscriptions\r\n  if (this.numCalls) {\r\n    this.numCalls.unsubscribe();\r\n    this.numCalls = null;\r\n  }\r\n  if (this.countDown) {\r\n    this.countDown.unsubscribe();\r\n    this.countDown = null;\r\n  }\r\n  if (this.unsubscribe) {\r\n    this.unsubscribe();\r\n    this.unsubscribe = null;\r\n  }\r\n  \r\n  // Stop any polling interval\r\n  if (this.pollingInterval) {\r\n    clearInterval(this.pollingInterval);\r\n    this.pollingInterval = null;\r\n  }\r\n  \r\n  // Reset any animation state\r\n  this.animatedMarker = null;\r\n}\r\n\r\nasync handleRideUpdates(doc) {\r\n  const data = doc.data();\r\n  if (!data) return;\r\n\r\n  try {\r\n    switch (data.status) {\r\n      case 'confirmed':\r\n        await this.handleRideConfirmation(doc);\r\n        break;\r\n      case 'started':\r\n        await this.handleRideStart(doc);\r\n        break;\r\n      case 'stopped':\r\n        await this.handleRideStop(doc);\r\n        break;\r\n      case 'cancelled':\r\n        await this.handleRideCancellation(data);\r\n        break;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error handling ride updates:', error);\r\n    if (error.code === 'permission-denied' || error.code === 'not-found') {\r\n      await this.ReturnHome();\r\n    }\r\n  }\r\n}\r\n\r\n\r\nasync handlePendingState() {\r\n  try {\r\n    // Don't show another loader here since BookRide is already showing one\r\n    if (!this.currentDriver?.Driver_id) {\r\n      throw new Error('No valid driver ID found');\r\n    }\r\n\r\n    // Get driver location with timeout\r\n    const locationPromise = this.getDriverLocation(this.currentDriver.Driver_id);\r\n    const timeoutPromise = new Promise((_, reject) => \r\n      setTimeout(() => reject(new Error('Location fetch timeout')), 10000)\r\n    );\r\n    \r\n    await Promise.race([locationPromise, timeoutPromise]);\r\n\r\n    if (!this.DriverLatLng) {\r\n      throw new Error('Failed to get driver location');\r\n    }\r\n\r\n    // Group all map operations\r\n    await Promise.all([\r\n      this.clearPrevMarkers(),\r\n      this.clearPolyline(this.newPoly),\r\n      this.map.newMap.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom: 15,\r\n        coordinate: this.DriverLatLng\r\n      })\r\n    ]);\r\n    \r\n    // Update map height properly instead of using fixed positioning\r\n    this.ngZone.run(() => {\r\n      this.setMapHeightHandleDrivertoRider();\r\n    });\r\n    \r\n    await this.handleDriverToRider(this.DriverLatLng, this.LatLng);\r\n    this.EnterSearchingStage();\r\n    await this.startCountdown(20, this.requestID);\r\n    \r\n  } catch (error) {\r\n    console.error('Error in handlePendingState:', error);\r\n    throw error; // Let BookRide handle the error and cleanup\r\n  }\r\n}\r\n\r\n\r\nasync presentCancelRideActionSheet() {\r\n  const actionSheet = await this.actionSheetController.create({\r\n    header: 'Cancel Ride',\r\n    buttons: [\r\n      {\r\n        text: 'Changed my mind',\r\n        handler: () => {\r\n          this.cancelRide('Changed my mind');\r\n        }\r\n      },\r\n      {\r\n        text: 'Driver took too long',\r\n        handler: () => {\r\n          this.cancelRide('Driver took too long');\r\n        }\r\n      },\r\n      {\r\n        text: 'Found another ride',\r\n        handler: () => {\r\n          this.cancelRide('Found another ride');\r\n        }\r\n      },\r\n      {\r\n        text: 'Other',\r\n        handler: () => {\r\n          this.cancelRide('Other');\r\n        }\r\n      },\r\n      {\r\n        text: 'Cancel',\r\n        role: 'cancel'\r\n      }\r\n    ]\r\n  });\r\n  await actionSheet.present();\r\n}\r\n\r\nasync cancelRide(reason: string) {\r\n  const rideRef = doc(this.firestore, 'Request', this.requestID);\r\n  await updateDoc(rideRef, {\r\n    status: 'cancelled',\r\n    cancellationReason: reason,\r\n    canceledBy: 'rider'\r\n  });\r\n  const toast = await this.toastController.create({\r\n    message: 'Ride has been cancelled.',\r\n    duration: 2000\r\n  });\r\n  await toast.present();\r\n}\r\n\r\n\r\n\r\nasync handleRideCancellation(data) {\r\n  this.stopCountdown();\r\n  await this.clearPrevMarkers();\r\n  this.unsubscribe();\r\n  this.clearSubscriptions();\r\n  if (this.drivers_Requested[this.current_Request_Number + 1] && !this.rideHasStarted) {\r\n    this.current_Request_Number++;\r\n    await this.BookRide();\r\n        } else {\r\n    if (data.canceledBy == 'driver') {\r\n      this.overlay.showAlert('Cancelled', 'Driver cancelled');\r\n    } \r\n    this.ClearRide();\r\n      this.ReturnHome();\r\n  }\r\n}\r\n\r\n\r\nasync handleRideStart(doc) {\r\n  try {\r\n    console.log('Starting ride tracking setup...');\r\n    \r\n    // Clear previous visual elements\r\n    await this.clearPrevMarkers();\r\n    await this.clearPolyline(this.newPoly);\r\n    \r\n    // Get ride data and validate\r\n    const data = doc.data();\r\n    if (!data) {\r\n      console.warn('handleRideStart: No data found in document');\r\n      throw new Error('No ride data available');\r\n    }\r\n    \r\n    console.log('handleRideStart data:', data);\r\n    \r\n    // Set ride state flag first to prevent race conditions\r\n    this.rideHasStarted = true;\r\n    \r\n    // Set current driver from document data with fallback options\r\n    if (data.driverDetails) {\r\n      this.currentDriver = data.driverDetails;\r\n      this.driverInfo = data.driverDetails;\r\n    } else if (data.driverId) {\r\n      console.log('Driver details missing, attempting to fetch from driver ID');\r\n      try {\r\n        const driverDoc = await getDoc(doc(this.firestore, 'Drivers', data.driverId));\r\n        if (driverDoc.exists()) {\r\n          this.driverInfo = driverDoc.data();\r\n          this.currentDriver = this.driverInfo;\r\n        }\r\n      } catch (error) {\r\n        console.warn('Failed to fetch driver details:', error);\r\n        // Continue with limited driver info\r\n      }\r\n    }\r\n    \r\n    // Adjust map height before adding markers\r\n    this.setMapHeightHandleDrivertoDestination();\r\n    window.addEventListener('resize', this.setMapHeightHandleDrivertoDestination.bind(this));\r\n    \r\n    // Initialize locations with fallbacks\r\n    this.LatLng = {\r\n      lat: data.Loc_lat || (this.LatLng?.lat || 0),\r\n      lng: data.Loc_lng || (this.LatLng?.lng || 0)\r\n    };\r\n    \r\n    this.D_LatLng = {\r\n      lat: data.Des_lat || (this.D_LatLng?.lat || 0),\r\n      lng: data.Des_lng || (this.D_LatLng?.lng || 0)\r\n    };\r\n    \r\n    // Ensure map is initialized\r\n    if (!this.map.newMap) {\r\n      console.log('Map not initialized in handleRideStart, initializing now...');\r\n      try {\r\n        await this.initializeMap();\r\n      } catch (mapError) {\r\n        console.error('Failed to initialize map:', mapError);\r\n        // Allow continuation with limited functionality\r\n      }\r\n    }\r\n    \r\n    // Get driver location with better error handling\r\n    let driverLocationFetched = false;\r\n    \r\n    if (data.driverId) {\r\n      try {\r\n        console.log('Fetching driver location for ID:', data.driverId);\r\n        \r\n        // Use Promise.race with a timeout to prevent hanging\r\n        const locationPromise = this.database.getDriverLocation(data.driverId);\r\n        const timeoutPromise = new Promise((_, reject) => \r\n          setTimeout(() => reject(new Error('Driver location fetch timeout')), 5000)\r\n        );\r\n        \r\n        const driverLocation = await Promise.race([locationPromise, timeoutPromise]) as any;\r\n        \r\n        if (driverLocation && typeof driverLocation === 'object' && 'lat' in driverLocation && 'lng' in driverLocation) {\r\n          console.log('Got real-time driver location:', driverLocation);\r\n          this.DriverLatLng = {\r\n            lat: driverLocation.lat,\r\n            lng: driverLocation.lng\r\n          };\r\n          driverLocationFetched = true;\r\n        }\r\n      } catch (locationError) {\r\n        console.warn('Error getting real-time driver location:', locationError);\r\n        // Will use fallback below\r\n      }\r\n    }\r\n    \r\n    // Fallback to location in document if real-time fetch failed\r\n    if (!driverLocationFetched) {\r\n      console.log('Using driver location from document data');\r\n      this.DriverLatLng = {\r\n        lat: data.driverDetails?.Driver_lat || data.driver_lat || this.LatLng.lat,\r\n        lng: data.driverDetails?.Driver_lng || data.driver_lng || this.LatLng.lng\r\n      };\r\n    }\r\n    \r\n    // Setup UI state even if visualization might fail\r\n    this.EnterDrivingToDestinationStage();\r\n    this.canCheck = true;\r\n    \r\n    // Proceed with visualization if we have valid coordinates\r\n    if (this.DriverLatLng?.lat && this.D_LatLng?.lat) {\r\n      console.log('Calling handleRiderToDestination with locations:', \r\n                  'Driver:', this.DriverLatLng, \r\n                  'Destination:', this.D_LatLng);\r\n      \r\n      try {\r\n        await this.handleRiderToDestination(this.DriverLatLng, this.D_LatLng);\r\n      } catch (visualError) {\r\n        console.warn('Failed to visualize route, but ride is still active:', visualError);\r\n        // Show a non-blocking toast or notification\r\n        const toast = await this.toastController.create({\r\n          message: 'Route visualization failed, but your ride is still active',\r\n          duration: 3000\r\n        });\r\n        toast.present();\r\n      }\r\n    } else {\r\n      console.warn('Invalid coordinates for visualization:', this.DriverLatLng, this.D_LatLng);\r\n      const toast = await this.toastController.create({\r\n        message: 'Location data incomplete. Your ride is active but not fully visualized.',\r\n        duration: 3000\r\n      });\r\n      toast.present();\r\n    }\r\n    \r\n    console.log('Ride tracking setup completed successfully');\r\n    \r\n  } catch (error) {\r\n    console.error('Error in handleRideStart:', error);\r\n    \r\n    // Still enter driving stage so user can see at least some UI\r\n    this.EnterDrivingToDestinationStage();\r\n    this.canCheck = true;\r\n    \r\n    // Show a less alarming message to the user\r\n    const toast = await this.toastController.create({\r\n      message: 'Some ride details couldn\\'t be loaded. Your ride is still active.',\r\n      duration: 3000\r\n    });\r\n    toast.present();\r\n  }\r\n}\r\n\r\n// Improve handleRideStop to better handle map errors\r\nasync handleRideStop(docSnapshot) {\r\n  try {\r\n    console.log('Handling ride stop...');\r\n    \r\n    // If already processed, exit immediately\r\n    if (this.isRideStopProcessed) {\r\n      console.log('Ride stop already processed, exiting function');\r\n      return;\r\n    }\r\n    \r\n    // Set flag immediately to prevent re-processing\r\n    this.isRideStopProcessed = true;\r\n    \r\n    // Stop all location polling and mapping activities immediately\r\n    this.stopPolling = true;\r\n    \r\n    // Unsubscribe from route updates first\r\n    if (this.routeUpdateSubscription) {\r\n      this.routeUpdateSubscription.unsubscribe();\r\n      this.routeUpdateSubscription = null;\r\n    }\r\n    \r\n    // Then clear other subscriptions\r\n    this.clearSubscriptions();\r\n    \r\n    // Force removal of all map elements with multiple attempts if needed\r\n    for (let attempt = 0; attempt < 3; attempt++) {\r\n      try {\r\n        await this.clearPrevMarkers();\r\n        await this.clearAllPolylines();\r\n        break; // Exit loop if successful\r\n      } catch (e) {\r\n        console.error(`Map cleanup attempt ${attempt + 1} failed:`, e);\r\n        // Short delay before retry\r\n        await new Promise(resolve => setTimeout(resolve, 100));\r\n      }\r\n    }\r\n    \r\n    // Prepare ride data with proper fallbacks for required fields\r\n    const docData = docSnapshot.data ? docSnapshot.data() : docSnapshot;\r\n    const tripId = docSnapshot.id || this.requestID;\r\n    \r\n    \r\n    const rideData = {\r\n      tripId: tripId || '',\r\n      driverId: docData?.driverDetails?.Driver_id || this.driverInfo?.Driver_id || '',\r\n      driverName: docData?.driverDetails?.Driver_name || this.driverInfo?.Driver_name || 'Unknown Driver',\r\n      driverImage: docData?.driverDetails?.Driver_imgUrl || this.driverInfo?.Driver_imgUrl || '',\r\n      driverCar: docData?.driverDetails?.Driver_car || this.driverInfo?.Driver_car || '',\r\n      driverPlate: docData?.driverDetails?.Driver_plate || this.driverInfo?.Driver_plate || '',\r\n      pickup: docData?.Rider_Location || this.locationAddress || 'Unknown pickup',\r\n      destination: docData?.Rider_Destination || this.destinationAddress || 'Unknown destination',\r\n      price: docData?.price || this.price || 0,\r\n      distance: docData?.distance || this.distance || 0,\r\n      duration: docData?.duration || this.duration || '',\r\n      rating: docData?.driverDetails?.Driver_rating || this.driverInfo?.Driver_rating || 0,\r\n      completed: true,\r\n      completedAt: new Date()\r\n    };\r\n\r\n    // CRITICAL: Clear ride state from storage BEFORE showing modal\r\n    try {\r\n      await Preferences.remove({ key: this.RIDE_STATE_KEY });\r\n      console.log('Cleared ride state from storage');\r\n    } catch (e) {\r\n      console.warn('Error clearing storage:', e);\r\n    }\r\n\r\n    // Reset ride properties BEFORE showing modal\r\n    this.rideHasStarted = false;\r\n    this.driverLocation = null;\r\n    this.lastHandledState = null;\r\n    \r\n    console.log('Showing trip summary with data:', rideData);\r\n    \r\n    // Show the trip summary\r\n    const modal = await this.modalCtrl.create({\r\n      component: TripSummaryComponent,\r\n      componentProps: { rideData }\r\n    });\r\n    \r\n    await modal.present();\r\n    \r\n    // Clean up once modal is dismissed\r\n    modal.onDidDismiss().then(() => {\r\n      console.log('Trip summary dismissed, resetting state');\r\n      this.isRideStopProcessed = false; // Reset the flag\r\n      this.clearRideState();            // Additional cleanup\r\n      this.ReturnHome();                // Return to booking view\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Error in handleRideStop:', error);\r\n    this.isRideStopProcessed = false;\r\n    this.ReturnHome();\r\n  }\r\n}\r\n\r\n// Add this method for more thorough ride state cleanup\r\nprivate clearRideState() {\r\n  console.log('Clearing ride state completely');\r\n  \r\n  // First clear all subscriptions\r\n  this.clearSubscriptions();\r\n  \r\n  // Reset all ride-related properties\r\n  this.requestID = null;\r\n  this.driverInfo = null;\r\n  this.currentDriver = null;\r\n  this.driver_marker = null;\r\n  this.rider_marker = null;\r\n  this.destinationMarker = null;\r\n  this.routePolyline = null;\r\n  this.routePath = null;\r\n  this.newPoly = null;\r\n  this.animatedMarker = null;\r\n  this.driverLocation = null;\r\n  this.isRideStopProcessed = false;\r\n  \r\n  // Reset stage-related properties\r\n  this.bookingStage = false;\r\n  this.confirmStage = false;\r\n  this.trackingStage = false;\r\n  this.searchingStage = false;\r\n  this.noDriverStage = false;\r\n  this.drivingToDestinationStage = false;\r\n  this.mapPinStage = false;\r\n  \r\n  // Set default stage\r\n  this.EnterBookingStage();\r\n  \r\n  // Stop polling\r\n  this.stopPolling = false;\r\n  \r\n  // Re-enable map interactions if needed\r\n  if (this.map && this.map.newMap) {\r\n    this.map.newMap.enableCurrentLocation(true);\r\n    this.map.newMap.enableTouch();\r\n  }\r\n}\r\n\r\nasync handleRideConfirmation(docOrData) {\r\n  try {\r\n    console.log('Starting ride confirmation handling...', docOrData);\r\n    this.stopCountdown();\r\n\r\n    // Clear existing markers and polylines\r\n    await Promise.all([\r\n      this.clearPrevMarkers(),\r\n      this.clearPolyline(this.newPoly)\r\n    ]);\r\n\r\n    // Get the ride data\r\n    let rideData;\r\n    let docId;\r\n    \r\n    if (!docOrData) {\r\n      throw new Error('Invalid input: null or undefined');\r\n    }\r\n    \r\n    // Handle different input types\r\n    if (typeof docOrData.data === 'function') {\r\n      // It's a Firebase DocumentSnapshot\r\n      rideData = docOrData.data();\r\n      docId = docOrData.id;\r\n    } else {\r\n      // It's already a data object from currentRide.data()\r\n      rideData = docOrData;\r\n      docId = this.requestID; // Use the current requestID if available\r\n    }\r\n    \r\n    if (!rideData) {\r\n      throw new Error('No ride data found');\r\n    }\r\n\r\n    // Update ride information\r\n    this.requestID = docId || rideData.requestId;\r\n    this.driverInfo = rideData.driverDetails;\r\n    \r\n    // Set driver information for UI display to avoid template errors\r\n    if (this.driverInfo) {\r\n      this.carname = this.driverInfo.Driver_car || 'Unknown Car';\r\n      this.driverImage = this.driverInfo.Driver_imgUrl || 'assets/icon/profile.png';\r\n      this.driver_ID = this.driverInfo.Driver_id;\r\n      this.driver_number_of_seats = this.driverInfo.seats || 4;\r\n      this.driver_duration_apart = this.driverInfo.duration ? \r\n        Math.ceil(this.driverInfo.duration / 60000) : 0;\r\n    }\r\n    \r\n    // Set locations\r\n    this.LatLng = {\r\n      lat: rideData.Loc_lat,\r\n      lng: rideData.Loc_lng\r\n    };\r\n    \r\n    this.D_LatLng = {\r\n      lat: rideData.Des_lat,\r\n      lng: rideData.Des_lng\r\n    };\r\n\r\n    // Initialize map if not already initialized\r\n    if (!this.map.newMap) {\r\n      await this.initializeMap();\r\n    }\r\n\r\n    // Get and wait for driver location\r\n    if (!this.driverInfo?.Driver_id) {\r\n      console.warn('Driver ID not found in driver details, using fallback location');\r\n      // Use fallback location from driver details\r\n      this.driverLocation = {\r\n        lat: this.driverInfo?.Driver_lat || this.driverInfo?.driver_lat,\r\n        lng: this.driverInfo?.Driver_lng || this.driverInfo?.driver_lng\r\n      };\r\n    } else {\r\n      try {\r\n        await this.getDriverLocation(this.driverInfo.Driver_id);\r\n      } catch (locationError) {\r\n        console.warn('Error getting real-time driver location, using fallback:', locationError);\r\n        // Use fallback location from driver details\r\n        this.driverLocation = {\r\n          lat: this.driverInfo?.Driver_lat || this.driverInfo?.driver_lat,\r\n          lng: this.driverInfo?.Driver_lng || this.driverInfo?.driver_lng\r\n        };\r\n      }\r\n    }\r\n\r\n    if (!this.driverLocation?.lat || !this.driverLocation?.lng) {\r\n      throw new Error('Unable to determine driver location');\r\n    }\r\n\r\n    this.DriverLatLng = {\r\n      lat: this.driverLocation.lat,\r\n      lng: this.driverLocation.lng\r\n    };\r\n\r\n    console.log('Driver location set:', this.DriverLatLng);\r\n\r\n    // Set map height and add event listener\r\n    this.setMapHeightHandleDrivertoRider();\r\n    window.addEventListener('resize', this.setMapHeightHandleDrivertoRider.bind(this));\r\n\r\n    // Initialize the map view with driver and rider markers\r\n    await this.handleDriverToRider(this.DriverLatLng, this.LatLng);\r\n\r\n    // Update UI state\r\n    this.EnterTrackingStage();\r\n    \r\n    // Save ride state to local storage\r\n    await this.saveRideStateToStorage();\r\n\r\n    console.log('Ride confirmation handled successfully');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error handling ride confirmation:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Add this method to save ride state to storage\r\nprivate async saveRideStateToStorage() {\r\n  try {\r\n    const rideState = {\r\n      requestID: this.requestID,\r\n      driverInfo: this.driverInfo,\r\n      LatLng: this.LatLng,\r\n      D_LatLng: this.D_LatLng,\r\n      DriverLatLng: this.DriverLatLng,\r\n      stage: this.getCurrentStage()\r\n    };\r\n    \r\n    await Preferences.set({\r\n      key: 'RIDE_STATE',\r\n      value: JSON.stringify(rideState)\r\n    });\r\n    \r\n    console.log('Ride state saved successfully');\r\n  } catch (error) {\r\n    console.error('Error saving ride state:', error);\r\n    // Don't throw the error as this is not critical\r\n  }\r\n}\r\n\r\n\r\n// Update getDriverLocation to return a Promise<void> and handle errors better\r\ngetDriverLocation(driverId: string): Promise<void> {\r\n  if (!driverId) {\r\n    return Promise.reject(new Error('No driver ID provided'));\r\n  }\r\n\r\n  console.log('Getting driver location for:', driverId);\r\n  return this.database.getDriverLocation(driverId)\r\n    .then(location => {\r\n      if (!location || !location.lat || !location.lng) {\r\n        throw new Error('Invalid location data received');\r\n      }\r\n      console.log('Driver location received:', location);\r\n      this.driverLocation = location;\r\n    })\r\n    .catch(error => {\r\n      console.error('Error getting driver location:', error);\r\n      throw error;\r\n    });\r\n}\r\n\r\n\r\n\r\nasync EnterChat(): Promise<void> {\r\nconst options: ModalOptions = {\r\n    component: EnrouteChatComponent,\r\n    componentProps: {\r\n        userId: this.requestID,\r\n        message: \"\"\r\n    },\r\n    swipeToClose: true,\r\n};\r\n\r\nconst modal = await this.modalCtrl.create(options);\r\nreturn await modal.present();\r\n}\r\n\r\nasync startCountdown(initialTime, requestId) {\r\n  this.countdownActive = true;\r\n  let timeRemaining = initialTime;\r\n\r\n  const updateCountdown = async () => {\r\n    if (!this.countdownActive) {\r\n      console.log('Countdown stopped');\r\n      return;\r\n    }\r\n\r\n    if (timeRemaining > 0) {\r\n      try {\r\n        await this.database.UpdateCountDown(timeRemaining, requestId);\r\n        timeRemaining--;\r\n        setTimeout(updateCountdown, 1000);\r\n      } catch (error) {\r\n        console.error('Error updating countdown:', error);\r\n        // Retry after a short delay\r\n        setTimeout(updateCountdown, 2000);\r\n      }\r\n    } else {\r\n      await this.handleCountdownEnd(requestId);\r\n      console.log('Countdown ended');\r\n    }\r\n  };\r\n\r\n  updateCountdown();\r\n}\r\n\r\nasync handleCountdownEnd(requestId) {\r\n  try {\r\n    // Implement a grace period to account for any delays\r\n    setTimeout(async () => {\r\n      await this.clearPrevMarkers();\r\n      await this.requestNextDriver();\r\n    }, 5000); // 5-second grace period\r\n  } catch (error) {\r\n    console.error('Error handling countdown end:', error);\r\n    // Optionally, retry the operation or notify the user\r\n  }\r\n}\r\n\r\n\r\nstopCountdown() {\r\n  this.countdownActive = false;\r\n}\r\n\r\nasync goBackToAutoComplete() {\r\n  try {\r\n    this.stopPolling = false;\r\n    // Enable current location and set the camera to the initial position\r\n    await this.map.newMap.enableCurrentLocation(true);\r\n \r\n\r\n    await this.ResetState();\r\n\r\n    await this.showAutocompleteModal();\r\n    \r\n\r\n    console.log('Game state reset successfully');\r\n  } catch (error) {\r\n    console.error('Error resetting game state:', error);\r\n  }\r\n}\r\n\r\nprivate async clearPrevMarkers() {\r\n  try {\r\n    // Check if map is initialized\r\n    if (!this.map || !this.map.newMap) {\r\n      console.warn('Map not initialized when clearing markers');\r\n      return; // Exit early if map is not available\r\n    }\r\n    \r\n    console.log('Clearing all markers...');\r\n    \r\n    // Clear individual markers with proper error handling\r\n    const markers = [\r\n      this.rider_marker,\r\n      this.driver_marker,\r\n      this.destinationMarker,\r\n      this.marker1,\r\n      this.marker2,\r\n      this.animatedMarker\r\n    ];\r\n    \r\n    const clearPromises = markers\r\n      .filter(marker => marker !== null && marker !== undefined)\r\n      .map(marker => this.clearMarker(marker).catch(e => {\r\n        console.error('Error clearing specific marker:', e);\r\n        // Continue despite error\r\n        return null;\r\n      }));\r\n    \r\n    await Promise.all(clearPromises);\r\n    \r\n    // Reset all marker references\r\n    this.rider_marker = null;\r\n    this.driver_marker = null;\r\n    this.destinationMarker = null;\r\n    this.marker1 = null;\r\n    this.marker2 = null;\r\n    this.animatedMarker = null;\r\n    \r\n    console.log('All markers cleared successfully');\r\n  } catch (e) {\r\n    console.error('Error in clearPrevMarkers:', e);\r\n    // Just log the error but don't throw, allowing the process to continue\r\n  }\r\n}\r\n\r\n// Add this helper method for individual marker clearing\r\nprivate async clearMarker(marker) {\r\n  if (!marker || !this.map?.newMap) return Promise.resolve();\r\n  \r\n  try {\r\n    console.log('Clearing marker:', marker);\r\n    await this.map.newMap.removeMarker(marker);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error clearing marker:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Modify clearAllPolylines for safer handling\r\nasync clearAllPolylines() {\r\n  try {\r\n    if (!this.map || !this.map.newMap) {\r\n      console.warn('Map not initialized when clearing polylines');\r\n      return;\r\n    }\r\n    \r\n    console.log('Clearing all polylines...');\r\n    \r\n    // Try to clear specific polyline first\r\n    if (this.newPoly) {\r\n      try {\r\n        await this.map.newMap.removePolylines(this.newPoly);\r\n        console.log('Specific polyline cleared');\r\n      } catch (error) {\r\n        console.error('Error clearing specific polyline:', error);\r\n      }\r\n    }\r\n    \r\n    // Reset reference\r\n    this.newPoly = null;\r\n      } catch (error) {\r\n    console.error('Error in clearAllPolylines:', error);\r\n    // Just log the error but don't throw\r\n  }\r\n}\r\n\r\n\r\nasync ResetState(){\r\n  try{\r\n    // Clear previous markers\r\n    await this.clearPrevMarkers();\r\n\r\n    // Clear any existing polylines\r\n    await this.clearPolyline(this.newPoly);\r\n\r\n    await this.map.newMap.setCamera({\r\n      animate: true,\r\n      animationDuration: 500,\r\n      zoom: 15,\r\n      coordinate: this.LatLng\r\n    });\r\n\r\n    this.ResetMapHeight();\r\n    window.addEventListener('resize', this.ResetMapHeight.bind(this));\r\n  \r\n    this.map.newMap.enableTouch();\r\n    // Ensure the map respects the boundaries of the top and bottom bars\r\n    this.current_Request_Number = 0;\r\n    this.price = null;\r\n    this.actualDestination = null;\r\n    this.D_LatLng = { lat: null, lng: null };\r\n    this.destinationAddress = 'Unknown location';\r\n\r\n    await this.map.newMap.enableCurrentLocation(true);\r\n    \r\n  }catch(e){\r\n    throw new Error(e);\r\n    \r\n  }\r\n}\r\n\r\nasync showAutocompleteModal(): Promise<void> {\r\n  const options: ModalOptions = {\r\n      component: AutocompleteComponent,\r\n      componentProps: {\r\n          LatLng: this.LatLng,\r\n          locationAddress: this.locationAddress,\r\n      },\r\n      swipeToClose: true,\r\n  };\r\n\r\n  const modal = await this.modalCtrl.create(options);\r\n  await modal.present();\r\n\r\n  const { data } = await modal.onWillDismiss();\r\n  console.log('Modal dismissed with data:', data);\r\n\r\n  this.data = data;\r\n\r\n  if (data.pinOnMap) {\r\n      this.EnterMapPinStage();\r\n      this.mapPinDrag = true;\r\n      this.stopPolling = true;\r\n\r\n  }\r\n\r\n  if (data.home) {\r\n      console.log(\"Entering Booking Stage...\");\r\n      this.EnterBookingStage();\r\n      this.stopPolling = false;\r\n      this.ResetState();\r\n  }\r\n\r\n  if (data.searching) {\r\n      this.database.AddKnownPlace(data);\r\n      this.destinationAddress = data.full;\r\n      this.actualDestination = data.whole.full;\r\n\r\n      try {\r\n          const latLng = await this.geocode.getLatLng(data.whole.description).toPromise();\r\n          this.D_LatLng = {\r\n              lat: latLng.results[0].geometry.location.lat,\r\n              lng: latLng.results[0].geometry.location.lng,\r\n          };\r\n          console.log(\"Destination LatLng:\", this.D_LatLng);\r\n\r\n          await this.getDistanceAndDirections();\r\n    } catch (error) {\r\n          console.error(\"Error in geocoding:\", error);\r\n          this.overlay.showAlert('Error in geocoding:', error.message);\r\n      }\r\n  }\r\n}\r\n\r\n\r\nasync RequestRide(dat) {\r\n  if (!this.NoDrivers) {\r\n    this.destinationAddress = dat.place.full;\r\n    this.actualDestination = dat.place.whole.full;\r\n\r\n    try {\r\n      const latLng = await this.geocode.getLatLng(dat.place.whole.description).toPromise();\r\n      this.D_LatLng = {\r\n        lat: latLng.results[0].geometry.location.lat,\r\n        lng: latLng.results[0].geometry.location.lng,\r\n      };\r\n\r\n      await this.getDistanceAndDirections();\r\n  } catch (error) {\r\n      console.error(\"Error in geocoding:\", error);\r\n      this.overlay.showAlert('Check Your Network', error.message);\r\n    }\r\n  } else {\r\n    this.EnterNoDriverStage();\r\n    console.log(\"No drivers available\");\r\n  }\r\n}\r\n\r\nasync getDistanceAndDirections() {\r\n  console.log(\"getDistanceAndDirections called\");\r\n  this.duration = null;\r\n  await this.clearMarkers();\r\n  this.cleanupListeners();\r\n  this.stopPolling = true;\r\n\r\n  if (this.D_LatLng && this.D_LatLng.lat) {\r\n    console.log(\"D_LatLng is set:\", this.D_LatLng);\r\n\r\n    if (!this.NoDrivers) {\r\n      this.EnterConfirmStage();\r\n    } else {\r\n      this.EnterNoDriverStage();\r\n      console.log(\"No drivers available\");\r\n      return;\r\n    }\r\n    \r\n    const origin1 = new google.maps.LatLng(this.LatLng.lat, this.LatLng.lng);\r\n    const origin2 = new google.maps.LatLng(this.D_LatLng.lat, this.D_LatLng.lng);\r\n    \r\n    const request = {\r\n      origin: origin1,\r\n      destination: origin2,\r\n      travelMode: google.maps.TravelMode.DRIVING,\r\n    };\r\n    \r\n    this.geocode.directions.route(request, async (response, status) => {\r\n      if (status === 'OK') {\r\n        this.direction = response;\r\n        this.distance = response.routes[0].legs[0].distance.value;\r\n        this.bounds = response.routes[0].bounds;\r\n        this.price = await this.database.getPriceEstimate(this.distance);\r\n        this.duration = response.routes[0].legs[0].duration.text;\r\n\r\n        await this.createAndAddMarkers(this.LatLng, this.D_LatLng);\r\n\r\n        // Call getDistanceAndDirectionsDriver after this part is successful\r\n        await this.getDistanceAndDirectionsDriver();\r\n      } else {\r\n        console.error('Direction ERROR:', response);\r\n        this.overlay.showAlert('Check Your Network', JSON.stringify(response));\r\n      }\r\n    });\r\n  } else {\r\n    this.overlay.showAlert('Drag Map', 'Drag the map and stop on your required destination');\r\n    console.error('D_LatLng or D_LatLng.lat is undefined');\r\n  }\r\n}\r\n\r\nasync getDistanceAndDirectionsDriver() {\r\n  console.log(\"getDistanceAndDirectionsDriver called\");\r\n\r\n  if (!this.NoDrivers) {\r\n    console.log(\"Driver LatLng:\", this.DriverLatLng);\r\n\r\n    if (this.DriverLatLng) {\r\n      const origin1 = new google.maps.LatLng(this.LatLng.lat, this.LatLng.lng);\r\n      const origin2 = new google.maps.LatLng(this.DriverLatLng.lat, this.DriverLatLng.lng);\r\n\r\n      const request = {\r\n        origin: origin1,\r\n        destination: origin2,\r\n        travelMode: google.maps.TravelMode.DRIVING,\r\n      };\r\n\r\n      this.geocode.directions.route(request, (response, status) => {\r\n        if (status === 'OK') {\r\n          this.D_duration = response.routes[0].legs[0].duration.text;\r\n          console.log(\"Driver duration:\", this.D_duration);\r\n        } else {\r\n          console.error('Direction ERROR:', response);\r\n          this.overlay.showAlert('Direction ERROR:', JSON.stringify(response));\r\n        }\r\n      });\r\n    } else {\r\n      console.log(\"DriverLatLng is undefined\");\r\n    }\r\n  } else {\r\n    console.log(\"No drivers available\");\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nasync resetLocation(): Promise<void> {\r\nconsole.log(this.LatLng);\r\nawait this.map.newMap.setCamera({\r\n    animate: true,\r\n    animationDuration: 500,\r\n    zoom: 15,\r\n    coordinate: this.LatLng\r\n});\r\nthis.showResetLocationButton = false;\r\n}\r\n\r\n\r\n\r\nprocessAddressResponse(addressResponse) {\r\n  console.log(\"processAddressResponse : \" + addressResponse);\r\n  if (addressResponse) {\r\n      console.log(addressResponse);\r\n      this.actualDestination = this.map.actualLocation;\r\n      const results = addressResponse.results;\r\n\r\n      if (results && results.length > 1 && results[1].geometry && results[1].geometry.location) {\r\n          this.D_LatLng = {\r\n              lat: results[1].geometry.location.lat,\r\n              lng: results[1].geometry.location.lng\r\n          };\r\n\r\n          const addressComponents = results[1].address_components;\r\n          if (addressComponents && addressComponents.length > 1) {\r\n              this.destinationAddress = `${addressComponents[0].long_name} ${addressComponents[1].long_name}`;\r\n              console.log(\"this is it \" + this.destinationAddress);\r\n          } else {\r\n              console.log('Address components are missing or incomplete.');\r\n              this.destinationAddress = 'Unknown address';\r\n          }\r\n      } else {\r\n          console.log('Results are missing or incomplete.');\r\n          this.D_LatLng = { lat: null, lng: null };\r\n          this.destinationAddress = 'Unknown location';\r\n      }\r\n  } else {\r\n      console.log('Failed to fetch address.');\r\n      this.D_LatLng = { lat: null, lng: null };\r\n      this.destinationAddress = 'Failed to fetch address';\r\n  }\r\n}\r\n\r\n\r\nasync UpdateCarMarker(elements: Drivers[]) {\r\n  console.log('Elements to update car markers:', elements);\r\n\r\n  const bounds = new google.maps.LatLngBounds();\r\n\r\n  // Create a map of driver IDs to driver elements for quick lookup\r\n  const driverMap = new Map(elements.map(element => [element.Driver_id, element]));\r\n\r\n  // Track markers to keep and update\r\n  const updatedMarkers: { id: string, marker: any }[] = [];\r\n\r\n  // Remove markers that are not needed and update positions\r\n  for (const { id, marker } of this._carmarkers) {\r\n    const driver = driverMap.get(id);\r\n    if (!driver || !driver.onlineState) {\r\n      console.log(`Removing marker for driver ID: ${id}`);\r\n      await this.map.newMap.removeMarker(marker); // Remove the marker from the map\r\n    } else if (driver.Driver_lat !== undefined && driver.Driver_lng !== undefined) {\r\n      const latlng = { lat: driver.Driver_lat, lng: driver.Driver_lng };\r\n      // Remove old marker and add a new one with updated position\r\n      await this.map.newMap.removeMarker(marker);\r\n     // updatedMarkers.push({ id, marker: newMarker });\r\n      bounds.extend(latlng);\r\n      console.log(`Updated marker for driver ID: ${id}`);\r\n    } else {\r\n      console.error('Invalid driver coordinates:', driver);\r\n    }\r\n  }\r\n\r\n  // Add new markers for drivers that are online and not in the existing markers\r\n  for (const element of elements) {\r\n    if (element.onlineState) {\r\n      const existingMarkerIndex = updatedMarkers.findIndex(({ id }) => id === element.Driver_id);\r\n      if (existingMarkerIndex === -1 && element.Driver_lat !== undefined && element.Driver_lng !== undefined) {\r\n        const latlng = { lat: element.Driver_lat, lng: element.Driver_lng };\r\n        console.log(`Adding new marker for driver ID: ${element.Driver_id} at`, latlng);\r\n        try {\r\n          // const marker = await this.map.newMap.addMarker({\r\n          //   coordinate: latlng,\r\n          //   iconUrl: 'https://i.ibb.co/KDy365b/hatchback.png',\r\n          //   title: 'Driver',\r\n          //   iconSize: { width: 30, height: 30 }\r\n          // });\r\n\r\n          // if (marker) {\r\n          //   updatedMarkers.push({ id: element.Driver_id, marker });\r\n          //   bounds.extend(latlng);\r\n          // }\r\n        } catch (error) {\r\n          console.error('Error adding marker:', error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Update the _carmarkers array with the updated markers\r\n  this._carmarkers = updatedMarkers;\r\n\r\n  // Center the map around the car markers if there are any markers\r\n  if (updatedMarkers.length > 0) {\r\n    const mapDim = {\r\n      height: this.mapRef.nativeElement.offsetHeight,\r\n      width: this.mapRef.nativeElement.offsetWidth\r\n    };\r\n\r\n    const minZoom = 5; // Define your minimum zoom level\r\n    const maxZoom = 18; // Define your maximum zoom level\r\n    \r\n    let zoomLevel = await this.map.getBoundsZoomLevel(bounds, mapDim);\r\n    \r\n    // Constrain the zoom level within the min and max range\r\n    zoomLevel = Math.max(minZoom, Math.min(maxZoom, zoomLevel));\r\n    \r\n    console.log('Setting camera with zoom level:', zoomLevel);\r\n    \r\n    await this.map.newMap.setCamera({\r\n      animate: true,\r\n      animationDuration: 500,\r\n      zoom: zoomLevel,\r\n      coordinate: bounds.getCenter()\r\n    });\r\n\r\n    this.map.newMap.fitBounds(bounds);\r\n      } else {\r\n    console.log('No markers to display on the map.');\r\n  }\r\n}\r\n\r\n\r\n\r\nasync GoHome() {\r\n  await this.map.newMap.enableCurrentLocation(true);\r\n  this.current_Request_Number = 0;\r\n  this.stopPolling = false;\r\n  this.price = null;\r\n  this.EnterBookingStage();\r\n  await this.map.newMap.setCamera({\r\n      animate: true,\r\n      animationDuration: 500,\r\n      zoom: 15,\r\n      coordinate: this.LatLng\r\n  });\r\n}\r\n\r\nasync GotoSupport() {\r\n  await this.nav.navigateForward('support');\r\n}\r\n\r\n\r\nasync ReturnHome() {\r\n  await this.ResetState();\r\n  this.EnterBookingStage();\r\n  this.stopPolling = false;\r\n  await this.map.newMap.setCamera({\r\n      animate: true,\r\n      animationDuration: 500,\r\n      zoom: 15,\r\n      coordinate: this.LatLng\r\n  });\r\n}\r\n\r\nasync CancelRide() {\r\n  try {\r\n    this.overlay.showLoader('Cancelling your ride...');\r\n    await this.clearPrevMarkers();\r\n    await this.clearPolyline(this.newPoly);\r\n\r\n    this.unsubscribe();\r\n    this.numCalls.unsubscribe();\r\n    this.riderCleared = true;\r\n    await this.database.cancelRide(this.requestID);\r\n    await this.map.newMap.enableCurrentLocation(true);\r\n    this.current_Request_Number = 0;\r\n    this.price = null;\r\n    this.EnterBookingStage();\r\n    this.overlay.hideLoader();\r\n    await this.map.newMap.setCamera({\r\n      animate: true,\r\n      animationDuration: 500,\r\n      zoom: 15,\r\n      coordinate: this.LatLng\r\n    });\r\n    await this.clearRideState();\r\n  } catch (error) {\r\n    this.overlay.hideLoader();\r\n    console.error('Error cancelling ride:', error);\r\n    this.overlay.showAlert('Error', 'Failed to cancel ride. Please try again.');\r\n  }\r\n}\r\n\r\nasync ClearRide() {\r\n  try {\r\n    const user = this.auth.currentUser;\r\n    if (user) {\r\n      const riderDocRef = doc(this.firestore, 'Riders', user.uid);\r\n      await updateDoc(riderDocRef, {\r\n        currentRequestId: null\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error clearing ride state:', error);\r\n  }\r\n\r\n  this.EnterBookingStage();\r\n  await this.clearPrevMarkers();\r\n  await this.clearPolyline(this.newPoly);\r\n  this.newPoly = null;\r\n\r\n  await this.map.newMap.enableCurrentLocation(true);\r\n  this.current_Request_Number = 0;\r\n  this.price = null;\r\n  await this.map.newMap.setCamera({\r\n    animate: true,\r\n    animationDuration: 500,\r\n    zoom: 15,\r\n    coordinate: this.LatLng,\r\n    bearing: 0\r\n  });\r\n}\r\n\r\nasync CallDriver() {\r\n  // Implement CallDriver logic\r\n}\r\n\r\n\r\n// Interval in milliseconds for updating the route\r\nUPDATE_INTERVAL = 10000; // Update every 10 seconds\r\n\r\nasync handleDriverToRider(driverLatLng, riderLatLng) {\r\n  const markerSize = { width: 30, height: 30 };\r\n  const iconAnchor = { x: 15, y: 30 }; // Center bottom of the icon\r\n\r\n  try {\r\n    // Cancel any existing route update subscription first\r\n    if (this.routeUpdateSubscription) {\r\n      this.routeUpdateSubscription.unsubscribe();\r\n      this.routeUpdateSubscription = null;\r\n    }\r\n    \r\n    // Check if map is initialized, if not initialize it\r\n    if (!this.map.newMap) {\r\n      console.log('Map not initialized, initializing now...');\r\n      await this.initializeMap();\r\n    }\r\n    \r\n    // Thoroughly clean up previous visual elements\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n    \r\n    // Use the unified height method and ensure proper positioning\r\n    this.setMapContainerHeight(20);\r\n    \r\n    // Add driver marker at the starting position with adjusted z-index\r\n    const driverMarker = await this.map.newMap.addMarker({\r\n      coordinate: driverLatLng,\r\n      iconUrl: 'assets/icon/car.png',\r\n      title: 'Driver',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      zIndex: 10 // Ensure marker appears above polylines\r\n    });\r\n    this.driver_marker = driverMarker;\r\n\r\n    // Add rider marker with higher z-index\r\n    const riderMarker = await this.map.newMap.addMarker({\r\n      coordinate: riderLatLng,\r\n      iconUrl: this.database.user?.photoURL || 'assets/icon/person.png',\r\n      title: 'Rider',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      zIndex: 11 // Higher than driver marker\r\n    });\r\n    this.rider_marker = riderMarker;\r\n\r\n    // Function to update route, duration, and distance\r\n    const updateRoute = async () => {\r\n        const request = {\r\n          origin: driverLatLng,\r\n        destination: riderLatLng,\r\n          travelMode: google.maps.TravelMode.DRIVING,\r\n        };\r\n\r\n        this.geocode.directions.route(request, async (response, status) => {\r\n          if (status === 'OK') {\r\n            const path = response.routes[0].overview_path.map(latlng => ({\r\n              lat: latlng.lat(),\r\n              lng: latlng.lng()\r\n            }));\r\n            this.duration = response.routes[0].legs[0].duration.text;\r\n            this.distance = response.routes[0].legs[0].distance.text;\r\n\r\n            console.log(`Duration: ${this.duration}, Distance: ${this.distance}`);\r\n\r\n            const locs = [\r\n              { geoCode: { latitude: driverLatLng.lat, longitude: driverLatLng.lng } },\r\n            { geoCode: { latitude: riderLatLng.lat, longitude: riderLatLng.lng } },\r\n            ];\r\n\r\n            const center = this.map.calculateCenter(locs);\r\n\r\n            const bounds = new google.maps.LatLngBounds();\r\n            bounds.extend(new google.maps.LatLng(driverLatLng.lat, driverLatLng.lng));\r\n          bounds.extend(new google.maps.LatLng(riderLatLng.lat, riderLatLng.lng));\r\n    \r\n            const availableHeight = this.mapRef.nativeElement.offsetHeight;\r\n    \r\n            // Prepare map dimensions for calculating zoom level\r\n            const mapDim = {\r\n              height: availableHeight,\r\n              width: this.mapRef.nativeElement.offsetWidth,\r\n            };\r\n    \r\n            // Calculate zoom level\r\n            const zoomLevel = this.map.getBoundsZoomLevel(bounds, mapDim);\r\n    \r\n            // Manually set zoom level if needed\r\n            const adjustedZoomLevel = zoomLevel - 1; // Adjust as necessary\r\n    \r\n          await this.map.setCameraToLocation({ lat: center.latitude, lng: center.longitude }, adjustedZoomLevel, this.map.calculateBearing(driverLatLng, riderLatLng));\r\n    \r\n          // Clear existing polyline before drawing a new one\r\n          await this.clearAllPolylines();\r\n          await this.addPolyline(driverLatLng, riderLatLng);\r\n            \r\n            // Clear any existing animated marker before starting a new animation\r\n            if (this.animatedMarker) {\r\n              await this.map.newMap.removeMarker(this.animatedMarker);\r\n              this.animatedMarker = null;\r\n            }\r\n            \r\n          // Animate the driver marker along the path to the rider\r\n            await this.animateMarker(this.driver_marker, path, 'assets/icon/car.png');\r\n          } else {\r\n            console.error('Direction ERROR:', response);\r\n            this.overlay.showAlert('Direction ERROR', JSON.stringify(response));\r\n          }\r\n        });\r\n    };\r\n\r\n    // Start updating the route periodically\r\n    const routeUpdate$ = interval(this.UPDATE_INTERVAL).pipe(\r\n      switchMap(() => updateRoute())\r\n    );\r\n\r\n    // Subscribe to the interval observable to start updating\r\n    this.routeUpdateSubscription = routeUpdate$.subscribe();\r\n\r\n  } catch (error) {\r\n    console.error('Error handling driver to rider:', error);\r\n  }\r\n}\r\n\r\n// Update clearPolyline to handle null map\r\nasync clearPolyline(polylineId) {\r\n  if (!polylineId || !this.map?.newMap) return;\r\n  \r\n  try {\r\n    await this.map.newMap.removePolylines(polylineId);\r\n  } catch (error) {\r\n    console.error('Error clearing polyline:', error);\r\n  }\r\n}\r\n\r\n\r\nasync handleRiderToDestination(driverLatLng, destinationLatLng) {\r\n  const markerSize = { width: 30, height: 30 };\r\n  const iconAnchor = { x: 10, y: 0 }; // Center bottom of the icon\r\n\r\n  try {\r\n    // Cancel any existing route update subscription first\r\n    if (this.routeUpdateSubscription) {\r\n      this.routeUpdateSubscription.unsubscribe();\r\n      this.routeUpdateSubscription = null;\r\n    }\r\n    \r\n    // Check if map is initialized, if not initialize it\r\n    if (!this.map.newMap) {\r\n      console.log('Map not initialized, initializing now...');\r\n      await this.initializeMap();\r\n    }\r\n    \r\n    // Reset map position and apply proper height first\r\n    this.mapRef.nativeElement.style.top = '0';\r\n    this.setMapHeightHandleDrivertoDestination();\r\n    \r\n    // Thoroughly clean up previous visual elements\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n    \r\n    // Update driver marker to driver's current position\r\n    const driverMarker = await this.map.newMap.addMarker({\r\n      coordinate: driverLatLng,\r\n      iconUrl: 'assets/icon/car.png',\r\n      title: 'Driver',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 0, y: 0 },\r\n      zIndex: 10, // Higher z-index to appear above polyline\r\n    });\r\n    this.driver_marker = driverMarker;\r\n\r\n    // Add destination marker\r\n    const destinationMarker = await this.map.newMap.addMarker({\r\n      coordinate: destinationLatLng,\r\n      iconUrl: 'assets/icon/flag.png',\r\n      title: 'Destination',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 0, y: 0 },\r\n      zIndex: 11, // Higher z-index than driver marker\r\n    });\r\n    this.destinationMarker = destinationMarker;\r\n\r\n    // Function to update route, duration, and distance\r\n    const updateRoute = async () => {\r\n        const request = {\r\n          origin: driverLatLng,\r\n          destination: destinationLatLng,\r\n          travelMode: google.maps.TravelMode.DRIVING,\r\n        };\r\n\r\n        this.geocode.directions.route(request, async (response, status) => {\r\n          if (status === 'OK') {\r\n            const path = response.routes[0].overview_path.map(latlng => ({\r\n              lat: latlng.lat(),\r\n              lng: latlng.lng()\r\n            }));\r\n            this.duration = response.routes[0].legs[0].duration.text;\r\n            this.distance = response.routes[0].legs[0].distance.text;\r\n\r\n            console.log(`Duration: ${this.duration}, Distance: ${this.distance}`);\r\n\r\n            const locs = [\r\n              { geoCode: { latitude: driverLatLng.lat, longitude: driverLatLng.lng } },\r\n              { geoCode: { latitude: destinationLatLng.lat, longitude: destinationLatLng.lng } },\r\n            ];\r\n\r\n            const center = this.map.calculateCenter(locs);\r\n\r\n            const bounds = new google.maps.LatLngBounds();\r\n            bounds.extend(new google.maps.LatLng(driverLatLng.lat, driverLatLng.lng));\r\n            bounds.extend(new google.maps.LatLng(destinationLatLng.lat, destinationLatLng.lng));\r\n    \r\n            const availableHeight = this.mapRef.nativeElement.offsetHeight;\r\n    \r\n            // Prepare map dimensions for calculating zoom level\r\n            const mapDim = {\r\n              height: availableHeight,\r\n              width: this.mapRef.nativeElement.offsetWidth,\r\n            };\r\n    \r\n            // Calculate zoom level\r\n            const zoomLevel = this.map.getBoundsZoomLevel(bounds, mapDim);\r\n    \r\n            // Manually set zoom level if needed\r\n            const adjustedZoomLevel = zoomLevel - 1; // Adjust as necessary\r\n    \r\n            // Set the camera to focus on the center point with appropriate zoom level\r\n            await this.map.setCameraToLocation({ lat: center.latitude, lng: center.longitude }, adjustedZoomLevel, this.map.calculateBearing(driverLatLng, destinationLatLng));\r\n    \r\n          // Clear existing polyline before drawing a new one\r\n          await this.clearAllPolylines();\r\n            await this.addPolyline(driverLatLng, destinationLatLng);\r\n            \r\n            // Clear any existing animated marker before starting a new animation\r\n            if (this.animatedMarker) {\r\n              await this.map.newMap.removeMarker(this.animatedMarker);\r\n              this.animatedMarker = null;\r\n            }\r\n            \r\n            // Animate the driver marker along the path to the destination\r\n            await this.animateMarker(this.driver_marker, path, 'assets/icon/car.png');\r\n          } else {\r\n            console.error('Direction ERROR:', response);\r\n            this.overlay.showAlert('Direction ERROR', JSON.stringify(response));\r\n          }\r\n        });\r\n    };\r\n\r\n    // Start updating the route periodically\r\n    const routeUpdate$ = interval(this.UPDATE_INTERVAL).pipe(\r\n      switchMap(() => updateRoute())\r\n    );\r\n\r\n    // Subscribe to the interval observable to start updating\r\n    this.routeUpdateSubscription = routeUpdate$.subscribe();\r\n\r\n  } catch (error) {\r\n    console.error('Error handling rider to destination:', error);\r\n  }\r\n}\r\n\r\nasync addPolyline(loc: { lat: number, lng: number }, des: { lat: number, lng: number }) {\r\n  try {\r\n    const polylineColor = \"#007bff\";\r\n    const polylines: Polyline[] = [\r\n      {\r\n        path: [\r\n          { lat: loc.lat, lng: loc.lng },\r\n          { lat: des.lat, lng: des.lng }\r\n        ],\r\n        strokeColor: polylineColor,\r\n        strokeWeight: 8,\r\n        geodesic: true\r\n      }\r\n    ];\r\n    const addedPolylines = await this.map.newMap.addPolylines(polylines);\r\n    if (Array.isArray(addedPolylines) && addedPolylines.length > 0) {\r\n      this.newPoly = addedPolylines; // Change to assign the entire array\r\n      console.log('Polylines added:', this.newPoly);\r\n      return this.newPoly;\r\n    } else {\r\n      throw new Error('Failed to add polyline: Unexpected response format');\r\n    }\r\n  } catch (e) {\r\n    console.error('Error Adding Polyline: ', e);\r\n    throw e; // Re-throw the error to be handled by the caller\r\n  }\r\n}\r\n\r\nasync createAndAddMarkers(loc, des) {\r\n  const markerSize = { width: 30, height: 30 };\r\n  const iconAnchor = { x: 10, y: 0 }; // Center bottom of the icon\r\n\r\n  try {\r\n    this.map.newMap.disableTouch();\r\n\r\n    // Add start marker\r\n    this.marker1 = await this.map.newMap.addMarker({\r\n      coordinate: loc,\r\n      iconUrl: 'assets/icon/point.png',\r\n      title: 'Start',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 1, y: 0 },\r\n    });\r\n\r\n    // Add destination marker\r\n    this.marker2 = await this.map.newMap.addMarker({\r\n      coordinate: des,\r\n      iconUrl: 'assets/icon/flag.png',\r\n      title: 'Destination',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 1, y: 0 },\r\n    });\r\n\r\n    // Calculate the center point between the start and destination\r\n    const locs = [\r\n      { geoCode: { latitude: loc.lat, longitude: loc.lng } },\r\n      { geoCode: { latitude: des.lat, longitude: des.lng } },\r\n    ];\r\n\r\n    const center = this.map.calculateCenter(locs);\r\n\r\n    // Calculate the bounds\r\n    const bounds = new google.maps.LatLngBounds();\r\n    bounds.extend(new google.maps.LatLng(loc.lat, loc.lng));\r\n    bounds.extend(new google.maps.LatLng(des.lat, des.lng));\r\n\r\n    // Set map height before calculating zoom level\r\n    this.setMapHeight();\r\n    const availableHeight = this.mapRef.nativeElement.offsetHeight;\r\n\r\n    // Prepare map dimensions for calculating zoom level\r\n    const mapDim = {\r\n      height: availableHeight,\r\n      width: this.mapRef.nativeElement.offsetWidth,\r\n    };\r\n\r\n    // Calculate zoom level\r\n    const zoomLevel = this.map.getBoundsZoomLevel(bounds, mapDim);\r\n\r\n    // Manually set zoom level if needed\r\n    const adjustedZoomLevel = zoomLevel - 1; // Adjust as necessary\r\n\r\n    // Set the camera to focus on the center point with appropriate zoom level\r\n    await this.map.setCameraToLocation({ lat: center.latitude, lng: center.longitude }, adjustedZoomLevel, this.map.calculateBearing(loc, des));\r\n\r\n    // Add polyline for the route\r\n    const polylineColor = \"#007bff\";\r\n    const polylines: Polyline[] = [\r\n      {\r\n        path: [\r\n          { lat: loc.lat, lng: loc.lng },\r\n          { lat: des.lat, lng: des.lng }\r\n        ],\r\n        strokeColor: polylineColor,\r\n        strokeWeight: 8,\r\n        geodesic: true\r\n      }\r\n    ];\r\n\r\n    // Add polyline to the map\r\n    this.newPoly = await this.map.newMap.addPolylines(polylines);\r\n  } catch (error) {\r\n    console.error('Error creating and adding markers:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n// Update the animateMarker method to properly handle cleanup\r\nasync animateMarker(marker, path, iconUrl) {\r\n  const markerSize = { width: 50, height: 50 };\r\n  const iconAnchor = { x: 25, y: 50 }; // Center bottom of the icon\r\n  \r\n  // Remove any existing animated marker\r\n  if (this.animatedMarker) {\r\n    await this.map.newMap.removeMarker(this.animatedMarker);\r\n    this.animatedMarker = null;\r\n  }\r\n\r\n  let lastMarker = null;\r\n  \r\n  for (let i = 0; i < path.length; i++) {\r\n    // Remove previous animation step marker if it exists\r\n    if (lastMarker) {\r\n      await this.map.newMap.removeMarker(lastMarker);\r\n    }\r\n    \r\n    // Remove the original marker for the first frame of animation\r\n    if (i === 0) {\r\n      await this.map.newMap.removeMarker(marker);\r\n    }\r\n    \r\n    const coordinate = path[i] instanceof google.maps.LatLng ? \r\n                     { lat: path[i].lat(), lng: path[i].lng() } : \r\n                     { lat: path[i].lat, lng: path[i].lng };\r\n                     \r\n    lastMarker = await this.map.newMap.addMarker({\r\n      coordinate: coordinate,\r\n      iconUrl: iconUrl,\r\n      title: 'Moving Marker',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 0, y: 0 },\r\n      zIndex: 20, // Higher than other markers\r\n    });\r\n    \r\n    await new Promise(resolve => setTimeout(resolve, 100)); // Adjust the interval as needed\r\n  }\r\n\r\n  // Store the last position of the animated marker\r\n  this.animatedMarker = lastMarker;\r\n}\r\n\r\n\r\n\r\n\r\nasync ShowDriverInfoPop() {\r\n  const alert = await this.alert.create({\r\n    header: 'Driver Information',\r\n    message: `\r\n      <div style=\"text-align: center;\">\r\n        <h2 style=\"font-size: 1.2em; margin-bottom: 0.5em;\">Car Name: ${this.carname}</h2>\r\n        <div style=\"margin: 10px 0;\">\r\n          <img src=\"${this.driverImage}\" alt=\"Driver Image\" style=\"width: 60px; height: 60px; border-radius: 50%;\">\r\n        </div>\r\n        <p><strong>Duration Apart:</strong> ${this.driver_duration_apart} minutes</p>\r\n        <p><strong>Driver ID:</strong> ${this.driver_ID}</p>\r\n        <p><strong>Number of Seats:</strong> ${this.driver_number_of_seats}</p>\r\n        <p><strong>Driver Location:</strong> (${this.DriverLatLng.lat}, ${this.DriverLatLng.lng})</p>\r\n      </div>\r\n    `,\r\n    buttons: ['OK']\r\n  });\r\n\r\n  await alert.present();\r\n}\r\n\r\n\r\n// State management methods\r\nEnterBookingStage() {\r\n  this.setStage(this.STAGES.BOOKING);\r\n}\r\n\r\nEnterMapPinStage() {\r\n  this.setStage(this.STAGES.MAP_PIN);\r\n}\r\n\r\nEnterConfirmStage() {\r\n  this.setStage(this.STAGES.CONFIRM);\r\n}\r\n\r\nEnterSearchingStage() {\r\n  this.setStage(this.STAGES.SEARCHING);\r\n}\r\n\r\nEnterNoDriverStage() {\r\n  this.setStage(this.STAGES.NO_DRIVER);\r\n}\r\n\r\nEnterTrackingStage() {\r\n  this.setStage(this.STAGES.TRACKING);\r\n}\r\n\r\nEnterDrivingToDestinationStage() {\r\n  this.setStage(this.STAGES.DRIVING);\r\n}\r\n\r\nprivate setStage(stage: string) {\r\n  // Reset all stages first\r\n  this.bookingStage = false;\r\n  this.confirmStage = false;\r\n  this.trackingStage = false;\r\n  this.searchingStage = false;\r\n  this.drivingToDestinationStage = false;\r\n  this.noDriverStage = false;\r\n  this.mapPinStage = false;\r\n\r\n  // Set the appropriate stage without calling Enter methods\r\n  switch (stage) {\r\n    case this.STAGES.BOOKING:\r\n      this.bookingStage = true;\r\n      break;\r\n    case this.STAGES.CONFIRM:\r\n      this.confirmStage = true;\r\n      break;\r\n    case this.STAGES.TRACKING:\r\n      this.trackingStage = true;\r\n      break;\r\n    case this.STAGES.SEARCHING:\r\n      this.searchingStage = true;\r\n      break;\r\n    case this.STAGES.DRIVING:\r\n      this.drivingToDestinationStage = true;\r\n      break;\r\n    case this.STAGES.NO_DRIVER:\r\n      this.noDriverStage = true;\r\n      break;\r\n    case this.STAGES.MAP_PIN:\r\n      this.mapPinStage = true;\r\n      break;\r\n  }\r\n}\r\n\r\nprivate getCurrentStage(): string {\r\n  if (this.bookingStage) return this.STAGES.BOOKING;\r\n  if (this.confirmStage) return this.STAGES.CONFIRM;\r\n  if (this.trackingStage) return this.STAGES.TRACKING;\r\n  if (this.searchingStage) return this.STAGES.SEARCHING;\r\n  if (this.drivingToDestinationStage) return this.STAGES.DRIVING;\r\n  if (this.noDriverStage) return this.STAGES.NO_DRIVER;\r\n  if (this.mapPinStage) return this.STAGES.MAP_PIN;\r\n  return this.STAGES.BOOKING; // default\r\n}\r\n\r\nngOnInit() {\r\n  // ... existing code ...\r\n  \r\n  // Check for \"book again\" navigation state\r\n  const navigation = this.router.getCurrentNavigation();\r\n  if (navigation?.extras.state) {\r\n    const state = navigation.extras.state;\r\n    console.log('Navigation state received:', state);\r\n    \r\n    if (state['bookAgain']) {\r\n      // Wait for the map to be ready\r\n      this.mapLoadedSubscription = this.mapLoadedSubject.subscribe(loaded => {\r\n        if (loaded) {\r\n          setTimeout(() => {\r\n            console.log('Processing book again data:', state);\r\n            this.processBookAgainData(state);\r\n          }, 1000); // Small delay to ensure map is fully ready\r\n        }\r\n      });\r\n    }\r\n  }\r\n  \r\n  // ... existing code ...\r\n}\r\n\r\nasync processBookAgainData(state) {\r\n  try {\r\n    console.log('Setting up rebooking with data:', state);\r\n    \r\n    // Set pickup location\r\n    if (state.pickup && state.pickup.address) {\r\n      this.locationAddress = state.pickup.address;\r\n      \r\n      if (state.pickup.lat && state.pickup.lng) {\r\n        this.LatLng = {\r\n          lat: state.pickup.lat,\r\n          lng: state.pickup.lng\r\n        };\r\n        \r\n        // Add location marker\r\n        await this.addLocationMarker(this.LatLng);\r\n      } else {\r\n        // If no coordinates, geocode the address\r\n        const coords = await this.geocodeService.geocodeAddress(state.pickup.address);\r\n        if (coords) {\r\n          this.LatLng = coords;\r\n          await this.addLocationMarker(coords);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Set destination\r\n    if (state.destination && state.destination.address) {\r\n      this.destinationAddress = state.destination.address;\r\n      \r\n      if (state.destination.lat && state.destination.lng) {\r\n        this.D_LatLng = {\r\n          lat: state.destination.lat,\r\n          lng: state.destination.lng\r\n        };\r\n        \r\n        // Add destination marker\r\n        await this.addDestinationMarker(this.D_LatLng);\r\n      } else {\r\n        // If no coordinates, geocode the address\r\n        const coords = await this.geocodeService.geocodeAddress(state.destination.address);\r\n        if (coords) {\r\n          this.D_LatLng = coords;\r\n          await this.addDestinationMarker(coords);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // If both locations are set, calculate route\r\n    if (this.LatLng && this.D_LatLng) {\r\n      await this.drawRoute();\r\n      await this.calculatePrice();\r\n      this.EnterConfirmStage();\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('Error processing book again data:', error);\r\n    // Show error toast\r\n    const toast = await this.toastCtrl.create({\r\n      message: 'Could not load previous ride data. Please try again.',\r\n      duration: 3000,\r\n      position: 'bottom',\r\n      color: 'danger'\r\n    });\r\n    toast.present();\r\n  }\r\n}\r\n\r\n}","<ion-header class=\"ion-no-border\" [translucent]=\"true\" style=\"position: relative; z-index: 1000;\">\r\n  <!--destination bar-->\r\n  <ion-toolbar class=\"ion-padding\" *ngIf=\"confirmStage\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-button shape=\"round\" (click)=\"goBackToAutoComplete()\">\r\n        <ion-icon slot=\"icon-only\" name=\"arrow-back\" color=\"tertiary\"></ion-icon> \r\n      </ion-button>\r\n    </ion-buttons>\r\n    <ion-title> Cancel </ion-title>\r\n    <ion-buttons slot=\"end\">\r\n      <ion-item fill=\"outline\" class=\"duration\" color=\"primary\" lines=\"none\">\r\n        <ion-icon slot=\"icon-only\" name=\"flag\" color=\"primary\"></ion-icon>\r\n        <ion-label *ngIf=\"duration\" color=\"primary\"><h1>{{duration}}</h1></ion-label>\r\n      </ion-item>\r\n    </ion-buttons>\r\n  </ion-toolbar>\r\n\r\n  \r\n  <ion-item lines=\"none\" color='light' class=\"main-buttons ion-no-padding\" class='top_bar'  (click)=\"goBackToAutoComplete()\" *ngIf=\"confirmStage\">\r\n      <ion-icon slot=\"start\" color='primary' name=\"pencil\"></ion-icon>\r\n      <ion-label color='primary' >{{destinationAddress}}</ion-label>\r\n  </ion-item>\r\n  \r\n\r\n  <!--menu button-->\r\n  <ion-fab *ngIf=\"bookingStage\" vertical=\"top\" horizontal=\"start\" style=\"top: 35px;\">\r\n    <ion-fab-button color=\"light\">\r\n      <ion-menu-button color=\"primary\"></ion-menu-button>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  <!--sos button-->\r\n  <ion-fab *ngIf=\"bookingStage\" vertical=\"top\" horizontal=\"end\" (click)=\"GotoSupport()\" style=\"top: 35px;\">\r\n    <ion-fab-button color=\"light\">\r\n      <ion-icon color=\"primary\" name=\"chatbubble-ellipses\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n   <!--back button if map Pin-->\r\n   <ion-fab *ngIf=\"mapPinStage\" vertical=\"top\" (click)=\"goBackToAutoComplete()\" horizontal=\"start\" style=\"top: 35px;\">\r\n    <ion-fab-button color=\"light\">\r\n      <ion-icon name=\"arrow-back\" color=\"primary\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  <!--Search Bar-->\r\n\r\n  <!-- Driver arrival time header -->\r\n  <ion-toolbar *ngIf=\"trackingStage\" class=\"ion-text-center\">\r\n    <ion-title>Driver Arrives in {{duration}}</ion-title>\r\n  </ion-toolbar>\r\n  \r\n  <!-- Destination arrival time header -->\r\n  <ion-toolbar *ngIf=\"drivingToDestinationStage\" class=\"ion-text-center\">\r\n    <ion-title>Arrival in {{duration}}</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n\r\n<!--Capacitor Google Map-->\r\n\r\n<ion-content [fullscreen]=\"true\" scroll-y=\"false\">\r\n  <capacitor-google-maps #map></capacitor-google-maps>\r\n\r\n\r\n  <ion-fab *ngIf=\"bookingStage && showResetLocationButton\" vertical=\"bottom\" horizontal=\"end\" style=\"bottom: 130px;\">\r\n    <ion-fab-button color=\"light\" (click)=\"resetLocation()\">\r\n      <ion-icon name=\"locate\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  \r\n</ion-content>\r\n\r\n\r\n\r\n<ion-fab class=\"centerPin\" *ngIf=\"mapPinStage\" vertical=\"center\" horizontal=\"center\" style=\"z-index: 1000;\">\r\n    <ion-avatar>\r\n      <ion-img src=\"../../assets/icon/pin.png\"></ion-img>\r\n    </ion-avatar>\r\n</ion-fab>\r\n\r\n  <ion-footer  [translucent]=\"true\" class=\"ion-no-border\" style=\"position: relative; z-index: 1000;\">\r\n    <div #bottomBar>\r\n    <ion-row>\r\n\r\n\r\n      <!--where to bar and button-->\r\n      <ion-list class=\"bottomItems shadow-top\" *ngIf=\"bookingStage\" lines=\"full\">\r\n  \r\n        <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom \">\r\n          <ion-button \r\n          [disabled]=\"!locationAddress\" \r\n          shape=\"round\" \r\n          class=\"main-button\" \r\n          size=\"large\" \r\n          type=\"submit\" \r\n          (click)=\"showAutocompleteModal()\" \r\n          expand=\"block\">\r\n          <ion-icon slot=\"start\" name=\"search\" color=\"primary\"></ion-icon>\r\n          <ion-label>{{ locationAddress ? 'Where To?' : 'Waiting for address...' }}</ion-label>\r\n        </ion-button>\r\n        \r\n        </ion-item-group>\r\n\r\n      </ion-list>\r\n\r\n      <!--Map Pin Choose Bar-->\r\n      <ion-list class='bottomItems shadow-top' [hidden]=\"!mapPinStage\" lines=\"full\">\r\n\r\n        <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom\">\r\n          <ion-button shape=\"round\" size=\"large\" type=\"submit\" (click)=\"getDistanceAndDirections()\" expand=\"block\">\r\n            <ion-icon slot=\"end\" name=\"arrow-forward\"></ion-icon>\r\n            <ion-label>{{destinationAddress}}</ion-label>\r\n          </ion-button>\r\n        </ion-item-group>\r\n\r\n      </ion-list>\r\n\r\n      <!--No driver Found Bar-->\r\n      \r\n      <ion-list class='bottomItems shadow-top' *ngIf=\"noDriverStage\" lines=\"none\">\r\n        <ion-list-header>\r\n          <ion-item style=\"margin:0 auto;\">\r\n              <img src=\"../../assets/imgs/No connection-pana.svg\">\r\n          </ion-item>\r\n            \r\n         </ion-list-header>\r\n       <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom\">\r\n        \r\n               <ion-button shape=\"round\"  class='main-button' size=\"large\" type=\"submit\" color=\"primary\" (click)=\"ReturnHome()\" expand=\"block\">\r\n                 <ion-icon slot=\"start\" name=\"arrow-back\"></ion-icon>\r\n                 <ion-label> No Drivers Here </ion-label>\r\n               </ion-button>\r\n            \r\n       </ion-item-group>\r\n\r\n     </ion-list>\r\n\r\n      <!--Car type, payment, confirmation and Selection Bar-->\r\n      <ion-list class='bottomItems shadow-top' *ngIf=\"confirmStage\" lines=\"none\">\r\n        <!-- Modern card layout -->\r\n        <div class=\"ride-confirmation-card\">\r\n          <!-- Vehicle info with price section -->\r\n          <div *ngIf=\"price\" class=\"ride-details\">\r\n            <div class=\"vehicle-info\" (click)=\"ShowDriverInfoPop()\">\r\n              <ion-avatar>\r\n                <ion-img src=\"../../assets/icon/hatchback.png\"></ion-img>\r\n              </ion-avatar>\r\n              <div class=\"vehicle-details\">\r\n                <h2>{{carname}} <ion-icon name=\"information-circle\" color=\"primary\"></ion-icon></h2>\r\n                <p class=\"vehicle-stats\">\r\n                  <span><ion-icon name=\"time\" color=\"primary\"></ion-icon> {{D_duration}}</span>\r\n                  <span><ion-icon name=\"person\" color=\"primary\"></ion-icon> {{driver_number_of_seats}} seats</span>\r\n                </p>\r\n              </div>\r\n              <div class=\"price-tag\">\r\n                <h2>${{price}}</h2>\r\n                <p class=\"original-price\"><del>${{price*2}}</del></p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- Loading skeleton for ride details -->\r\n          <div *ngIf=\"!price\" class=\"ride-details skeleton\">\r\n            <div class=\"vehicle-info\">\r\n              <ion-avatar>\r\n                <ion-skeleton-text [animated]=\"true\"></ion-skeleton-text>\r\n              </ion-avatar>\r\n              <div class=\"vehicle-details\">\r\n                <h2><ion-skeleton-text [animated]=\"true\" style=\"width: 130px\"></ion-skeleton-text></h2>\r\n                <p class=\"vehicle-stats\">\r\n                  <ion-skeleton-text [animated]=\"true\" style=\"width: 130px\"></ion-skeleton-text>\r\n                </p>\r\n              </div>\r\n              <div class=\"price-tag\">\r\n                <h2><ion-skeleton-text [animated]=\"true\" style=\"width: 60px\"></ion-skeleton-text></h2>\r\n                <p><ion-skeleton-text [animated]=\"true\" style=\"width: 60px\"></ion-skeleton-text></p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- Payment method selector -->\r\n          <div class=\"payment-selector\">\r\n            <ion-item lines=\"none\">\r\n              <ion-icon name=\"wallet-outline\" slot=\"start\" color=\"primary\"></ion-icon>\r\n              <ion-label>Payment Method</ion-label>\r\n              <ion-select [value]=\"selectedCard\" (ionChange)=\"chooseCard($event)\" interface=\"popover\">\r\n                <ion-select-option value=\"cash\">\r\n                  <ion-icon name=\"cash-outline\"></ion-icon> Cash\r\n                </ion-select-option>\r\n                <ion-select-option *ngFor=\"let card of savedPaymentMethods\" [value]=\"card.cardId\">\r\n                  <ion-icon name=\"card-outline\"></ion-icon>  {{card.last4}}\r\n                </ion-select-option>\r\n              </ion-select>\r\n            </ion-item>\r\n          </div>\r\n          \r\n          <!-- Book ride button -->\r\n          <div class=\"book-button-container\">\r\n            <ion-button class=\"book-ride-btn\" shape=\"round\" color=\"primary\" size=\"large\" \r\n                      expand=\"block\" (click)=\"StartRide()\">\r\n              <ion-icon *ngIf='price' slot=\"start\" name=\"checkmark-sharp\"></ion-icon>\r\n              <ion-progress-bar color=\"light\" *ngIf='!price' type=\"indeterminate\"></ion-progress-bar>\r\n              <ion-label *ngIf='price'>Book Ride</ion-label>\r\n            </ion-button>\r\n          </div>\r\n        </div>\r\n      </ion-list>\r\n\r\n\r\n<!-- Connecting to driver bar-->\r\n      <ion-list class='bottomItems shadow-top' *ngIf=\"searchingStage\" lines=\"none\">\r\n         <ion-list-header>\r\n          <ion-item>\r\n            <ion-avatar slot=\"start\">\r\n              <ion-img [src]=\"currentDriver.Driver_imgUrl\"></ion-img>\r\n            </ion-avatar>\r\n            <ion-label>\r\n\r\n              <h1>{{currentDriver.Driver_name}}</h1>\r\n              <p>Arrives In {{duration}}</p>\r\n\r\n            </ion-label>\r\n          </ion-item>\r\n            \r\n         </ion-list-header>\r\n        <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom\">\r\n\r\n                <ion-button  fill=\"outline\" shape=\"round\" color=\"danger\"  class='main-button' size=\"small\" type=\"submit\" expand=\"block\" (click)=\"presentCancelRideActionSheet()\">\r\n                  <ion-label></ion-label>\r\n                  <ion-icon slot=\"start\" slot=\"icon-only\" name=\"close-sharp\" color=\"danger\"></ion-icon>\r\n                </ion-button>\r\n                 \r\n                <ion-progress-bar color=\"primary\" class=\"ion-padding\" type=\"indeterminate\"></ion-progress-bar>\r\n\r\n             \r\n        </ion-item-group>\r\n       \r\n      </ion-list>\r\n\r\n\r\n\r\n       <!--Driver tracking to user bar (FIXED LAYOUT)-->\r\n       <ion-list class='bottomItems shadow-top' *ngIf=\"trackingStage\" lines=\"none\">\r\n         <div class=\"card\">\r\n           <!-- Car information row -->\r\n           <ion-item lines=\"none\" class=\"driver-card-item\">\r\n             <ion-label>\r\n               <p>{{driverInfo.Driver_car}}.{{driverInfo.Driver_cartype}}</p>\r\n               <h1>{{driverInfo.Driver_plate}}</h1>\r\n             </ion-label>\r\n             \r\n             <!-- Driver avatar and rating on right side -->\r\n             <div slot=\"end\" class=\"driver-avatar-container\">\r\n               <ion-avatar>\r\n                 <ion-img [src]=\"driverInfo.Driver_imgUrl\"></ion-img>\r\n               </ion-avatar>\r\n               <div class=\"driver-rating\">\r\n                 <ion-icon color=\"warning\" name=\"star\"></ion-icon>\r\n                 <span>{{driverInfo.Driver_rating}}</span>\r\n               </div>\r\n             </div>\r\n           </ion-item>\r\n\r\n           <!-- Driver name row -->\r\n           <ion-item lines=\"none\" class=\"driver-card-item\">\r\n             <ion-label>\r\n               <ion-text color=\"primary\">{{driverInfo.Driver_name}}</ion-text>\r\n               <p>1,832 rides</p>\r\n             </ion-label>\r\n           </ion-item>\r\n\r\n           <!-- Payment row -->\r\n           <ion-item lines=\"none\" class=\"driver-card-item\">\r\n             <ion-label *ngIf=\"cash\">\r\n               <h2><ion-icon color='primary' name=\"cash\"></ion-icon> Cash</h2>\r\n             </ion-label>\r\n             <ion-label *ngIf=\"!cash\">\r\n               <h2><ion-icon color='primary' name=\"card\"></ion-icon> Card</h2>\r\n             </ion-label>\r\n             \r\n             <div slot=\"end\" class=\"price-container\">\r\n               <h1>${{price}}</h1>\r\n             </div>\r\n           </ion-item>\r\n\r\n           <!-- More options accordion (made more visible) -->\r\n           <ion-accordion-group class=\"driver-actions-accordion\">\r\n             <ion-accordion value=\"first\">\r\n               <ion-item slot=\"header\" class=\"accordion-header\">\r\n                 <ion-label><h2>More Options</h2></ion-label>\r\n               </ion-item>\r\n               <div slot=\"content\" class=\"accordion-content\">\r\n                 <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"CallDriver()\">\r\n                   <ion-icon color='primary' slot=\"start\" name=\"person\"></ion-icon>\r\n                   <ion-label>Contact</ion-label>\r\n                 </ion-button>\r\n                 \r\n                 <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"EnterChat()\">\r\n                   <ion-icon color='primary' slot=\"start\" name=\"chatbubbles\"></ion-icon>\r\n                   <ion-label>Chat</ion-label>\r\n                 </ion-button>\r\n                 \r\n                 <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"presentCancelRideActionSheet()\">\r\n                   <ion-icon color='primary' slot=\"start\" name=\"close\"></ion-icon>\r\n                   <ion-label>Cancel ride</ion-label>\r\n                 </ion-button>\r\n               </div>\r\n             </ion-accordion>\r\n           </ion-accordion-group>\r\n         </div>\r\n       </ion-list>\r\n\r\n\r\n\r\n    \r\n   <!--Rider Picked Up now tracking to destination bar (FIXED LAYOUT)-->\r\n      <ion-list class='bottomItems shadow-top' *ngIf=\"drivingToDestinationStage\" lines=\"none\">\r\n        <div class=\"card\">\r\n          <!-- Car information row -->\r\n          <ion-item lines=\"none\" class=\"driver-card-item\">\r\n            <ion-label>\r\n              <p>{{driverInfo.Driver_car}}.{{driverInfo.Driver_cartype}}</p>\r\n              <h1>{{driverInfo.Driver_plate}}</h1>\r\n            </ion-label>\r\n            \r\n            <!-- Driver avatar and rating on right side -->\r\n            <div slot=\"end\" class=\"driver-avatar-container\">\r\n              <ion-avatar>\r\n                <ion-img [src]=\"driverInfo.Driver_imgUrl\"></ion-img>\r\n              </ion-avatar>\r\n              <div class=\"driver-rating\">\r\n                <ion-icon color=\"secondary\" name=\"star\"></ion-icon>\r\n                <span>{{driverInfo.Driver_rating || 5}}</span>\r\n              </div>\r\n            </div>\r\n          </ion-item>\r\n\r\n          <!-- Driver name row -->\r\n          <ion-item lines=\"none\" class=\"driver-card-item\">\r\n            <ion-label>\r\n              <ion-text color=\"primary\">{{driverInfo.Driver_name}}</ion-text>\r\n              <p>1,832 rides</p>\r\n            </ion-label>\r\n          </ion-item>\r\n\r\n          <!-- Payment row -->\r\n          <ion-item lines=\"none\" class=\"driver-card-item\">\r\n            <ion-label *ngIf=\"cash\">\r\n              <h2><ion-icon color='primary' name=\"cash\"></ion-icon> Cash</h2>\r\n            </ion-label>\r\n            <ion-label *ngIf=\"!cash\">\r\n              <h2><ion-icon color='primary' name=\"card\"></ion-icon> Card</h2>\r\n            </ion-label>\r\n            \r\n            <div slot=\"end\" class=\"price-container\">\r\n              <h1>${{price}}</h1>\r\n            </div>\r\n          </ion-item>\r\n\r\n          <!-- Added accordion here too for consistency -->\r\n          <ion-accordion-group class=\"driver-actions-accordion\">\r\n            <ion-accordion value=\"first\">\r\n              <ion-item slot=\"header\" class=\"accordion-header\">\r\n                <ion-label><h2>More Options</h2></ion-label>\r\n              </ion-item>\r\n              <div slot=\"content\" class=\"accordion-content\">\r\n                <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"CallDriver()\">\r\n                  <ion-icon color='primary' slot=\"start\" name=\"person\"></ion-icon>\r\n                  <ion-label>Contact</ion-label>\r\n                </ion-button>\r\n                \r\n                <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"EnterChat()\">\r\n                  <ion-icon color='primary' slot=\"start\" name=\"chatbubbles\"></ion-icon>\r\n                  <ion-label>Chat</ion-label>\r\n                </ion-button>\r\n              </div>\r\n            </ion-accordion>\r\n          </ion-accordion-group>\r\n        </div>\r\n      </ion-list>\r\n      \r\n\r\n\r\n    </ion-row>\r\n    </div>\r\n  </ion-footer>","import { Injectable } from '@angular/core';\r\nimport { Client } from '@googlemaps/google-maps-services-js';\r\nimport { environment } from 'src/environments/environment';\r\nimport { OverlayService } from './overlay.service';\r\nimport { Observable, of } from 'rxjs';\r\nimport { HttpParams, HttpClient } from '@angular/common/http';\r\nimport { catchError, map } from 'rxjs/operators';\r\n\r\ndeclare let google;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeocodeService {\r\n  service = new google.maps.DistanceMatrixService();\r\n  directions = new google.maps.DirectionsService();\r\n  private readonly apiUrl = 'https://maps.googleapis.com/maps/api';\r\n\r\n  constructor(private client: Client, private overlay: OverlayService, private http: HttpClient) { }\r\n\r\n  getAddress(lat: number, lng: number): Observable<any> {\r\n    const url = `${this.apiUrl}/geocode/json`;\r\n    const params = new HttpParams()\r\n      .set('latlng', `${lat},${lng}`)\r\n      .set('key', environment.apiKey);\r\n  \r\n    return this.http.get(url, { params }).pipe(\r\n      map((response: any) => response),\r\n      catchError((error) => {\r\n        console.error('Error in reverse geocoding:', error);\r\n        this.overlay.showAlert('GeoError', error.message);\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Convert the address to lat and lng\r\n  getLatLng(address: string): Observable<any> {\r\n    const url = `${this.apiUrl}/geocode/json`;\r\n    const params = new HttpParams()\r\n      .set('address', address)\r\n      .set('key', environment.apiKey);\r\n\r\n    return this.http.get(url, { params }).pipe(\r\n      map((response: any) => response),\r\n      catchError((error) => {\r\n        console.error('Error in geocoding:', error);\r\n        this.overlay.showAlert('GeoError', error.message);\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n\r\n  \r\n\r\n  // Get the distance between the origin and destination\r\n  async getDirections(from: string, to: string): Promise<any> {\r\n    try {\r\n      // You can implement the directions request here using google.maps.DirectionsService\r\n    } catch (e) {\r\n      this.overlay.showAlert('GeoError', e);\r\n      console.log(e);\r\n    }\r\n  }\r\n\r\n  getDistanceMatrix(origin: any, destination: any): Observable<any> {\r\n    const distanceMatrixService = new google.maps.DistanceMatrixService();\r\n    \r\n    return new Observable(observer => {\r\n      distanceMatrixService.getDistanceMatrix({\r\n        origins: [new google.maps.LatLng(origin.lat, origin.lng)],\r\n        destinations: [new google.maps.LatLng(destination.lat, destination.lng)],\r\n        travelMode: google.maps.TravelMode.DRIVING,\r\n      }, (response, status) => {\r\n        if (status === 'OK') {\r\n          observer.next(response);\r\n        } else {\r\n          observer.error(status);\r\n        }\r\n        observer.complete();\r\n      });\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { GoogleMap, Marker } from '@capacitor/google-maps';\r\nimport { environment } from 'src/environments/environment';\r\nimport { GeocodeService } from './geocode.service';\r\nimport { OverlayService } from './overlay.service';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapService {\r\n  private _map: GoogleMap | null = null;\r\n  \r\n  get newMap(): GoogleMap {\r\n    if (!this._map) {\r\n      throw new Error('Map not initialized');\r\n    }\r\n    return this._map;\r\n  }\r\n\r\n  set newMap(map: GoogleMap) {\r\n    this._map = map;\r\n  }\r\n\r\n  LatLng: { lat: any; lng: any; };\r\n  locationAddress: string = 'Loading..';\r\n  showResetLocationButton: boolean;\r\n  mapPinStage: any;\r\n  D_LatLng: { lat: any; lng: any; };\r\n  actualLocation: any;\r\n  exampleMapId: any;\r\n\r\n  constructor(private overlay: OverlayService, private geocode: GeocodeService, private http: HttpClient) {}\r\n\r\n  async createMap(ref: HTMLElement, coords: { coords: { latitude: number; longitude: number } }) {\r\n    try {\r\n      // Validate coords before using\r\n      const lat = coords?.coords?.latitude || 3.1390; // Default to Kuala Lumpur, Malaysia\r\n      const lng = coords?.coords?.longitude || 101.6869;\r\n      \r\n      // Destroy existing map if it exists\r\n      this._map = await GoogleMap.create({\r\n        id: 'my-cool-map',\r\n        element: ref,\r\n        apiKey: environment.apiKey,\r\n        config: {\r\n          center: {\r\n            lat: lat,\r\n            lng: lng\r\n          },\r\n          zoom: 15,\r\n          styles: [],\r\n          scaleControl: false,\r\n          streetViewControl: false,\r\n          rotateControl: false,\r\n          fullscreenControl: false,\r\n        },\r\n      });\r\n\r\n      this.LatLng = {\r\n        lat: lat,\r\n        lng: lng\r\n      };\r\n\r\n      await Promise.all([\r\n        this._map.enableTrafficLayer(true),\r\n        this._map.enableCurrentLocation(true),\r\n        this._map.setCamera({\r\n          animate: true,\r\n          animationDuration: 500,\r\n          zoom: 15,\r\n          coordinate: this.LatLng\r\n        })\r\n      ]);\r\n\r\n      const address = await this.getAddress(this.LatLng.lat, this.LatLng.lng);\r\n      this.processAddressResponse(address);\r\n\r\n    } catch (error) {\r\n      console.error('Error creating map:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async destroyMap() {\r\n    if (this._map) {\r\n      try {\r\n        await this._map.destroy();\r\n        this._map = null;\r\n      } catch (error) {\r\n        console.error('Error destroying map:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  private processAddressResponse(address: any) {\r\n    if (address?.results?.length > 0) {\r\n      this.actualLocation = address.results[0].formatted_address;\r\n      \r\n      if (address.results.length > 1) {\r\n        const components = address.results[1].address_components;\r\n        if (components?.length >= 2) {\r\n          this.locationAddress = `${components[0].long_name} ${components[1].long_name}`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  calculateCenter(points) {\r\n    const latitudes = points.map(p => p.geoCode.latitude);\r\n    const longitudes = points.map(p => p.geoCode.longitude);\r\n  \r\n    const avgLat = latitudes.reduce((a, b) => a + b, 0) / latitudes.length;\r\n    const avgLng = longitudes.reduce((a, b) => a + b, 0) / longitudes.length;\r\n  \r\n    return { latitude: avgLat, longitude: avgLng };\r\n  }\r\n\r\n  async setCameraToLocation(coordinate: { lat: number; lng: number }, zoom: number, bearing: number) {\r\n    if (!this._map) {\r\n      console.error('Map not initialized');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this._map.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom,\r\n        coordinate,\r\n        bearing\r\n      });\r\n    } catch (error) {\r\n      console.error('Error setting camera:', error);\r\n    }\r\n  }\r\n  \r\n  // Add other necessary methods like getAddress here\r\n\r\n  \r\n  \r\n   getBoundsZoomLevel(bounds, mapDim) {\r\n    const WORLD_DIM = { height: 256, width: 256 };\r\n      const ZOOM_MAX = 21;\r\n\r\n      const latRad = lat => {\r\n        const sin = Math.sin((lat * Math.PI) / 180);\r\n        const radX2 = Math.log((1 + sin) / (1 - sin)) / 2;\r\n        return Math.max(Math.min(radX2, Math.PI), -Math.PI) / 2;\r\n      };\r\n\r\n      const zoom = (mapPx, worldPx, fraction) =>\r\n        Math.floor(Math.log(mapPx / worldPx / fraction) / Math.LN2);\r\n\r\n      const ne = bounds.getNorthEast();\r\n      const sw = bounds.getSouthWest();\r\n\r\n      const latFraction = (latRad(ne.lat()) - latRad(sw.lat())) / Math.PI;\r\n\r\n      const lngDiff = ne.lng() - sw.lng();\r\n      const lngFraction = (lngDiff < 0 ? lngDiff + 360 : lngDiff) / 360;\r\n\r\n      const latZoom = zoom(mapDim.height, WORLD_DIM.height, latFraction);\r\n      const lngZoom = zoom(mapDim.width, WORLD_DIM.width, lngFraction);\r\n\r\n      return Math.min(latZoom, lngZoom, ZOOM_MAX);\r\n  }\r\n  \r\n  calculateBearing(start, end) {\r\n    const startLat = start.lat * (Math.PI / 180);\r\n    const startLng = start.lng * (Math.PI / 180);\r\n    const endLat = end.lat * (Math.PI / 180);\r\n    const endLng = end.lng * (Math.PI / 180);\r\n  \r\n    const dLng = endLng - startLng;\r\n    const y = Math.sin(dLng) * Math.cos(endLat);\r\n    const x = Math.cos(startLat) * Math.sin(endLat) - Math.sin(startLat) * Math.cos(endLat) * Math.cos(dLng);\r\n    const bearing = Math.atan2(y, x) * (180 / Math.PI);\r\n  \r\n    return (bearing + 360) % 360;\r\n  }\r\n  async getDirections(from: string, to: string): Promise<any> {\r\n    try {\r\n      const url = `https://maps.googleapis.com/maps/api/directions/json?origin=${from}&destination=${to}&key=${environment.apiKey}`;\r\n      const response = await this.http.get(url).toPromise();\r\n      return response;\r\n    } catch (error) {\r\n      console.error('Error in getting directions:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n getAddress(lat: number, lng: number): Promise<any> {\r\n    const url = `https://maps.googleapis.com/maps/api/geocode/json`;\r\n    const params = new HttpParams()\r\n      .set('latlng', `${lat},${lng}`)\r\n      .set('key', environment.apiKey);\r\n\r\n    return this.http.get(url, { params }).toPromise();\r\n  }\r\n\r\n  // Add the addMarker method to the MapService class\r\n  async addMarker(lat: number, lng: number, title: string): Promise<Marker> {\r\n    try {\r\n      const marker: Marker = {\r\n        coordinate: { lat, lng },\r\n        title,\r\n      };\r\n      await this._map.addMarker(marker);\r\n      return marker;\r\n    } catch (error) {\r\n      console.error('Error adding marker:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","// src/app/services/network.service.ts\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { Network } from '@capacitor/network';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NetworkService {\r\n  private networkStatus = new BehaviorSubject<boolean>(true);\r\n  networkStatus$ = this.networkStatus.asObservable();\r\n\r\n  constructor() {\r\n    this.initializeNetworkListener();\r\n  }\r\n\r\n  private initializeNetworkListener() {\r\n    try {\r\n      Network.addListener('networkStatusChange', status => {\r\n        console.log('Network status changed', status);\r\n        this.networkStatus.next(status.connected);\r\n\r\n        if (status.connected) {\r\n          this.handleReconnect();\r\n        } else {\r\n          this.handleDisconnect();\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.warn('Failed to add network listener:', error);\r\n    }\r\n\r\n    this.checkInitialNetworkStatus();\r\n  }\r\n\r\n  private async checkInitialNetworkStatus() {\r\n    try {\r\n      const status = await Network.getStatus();\r\n      console.log('Initial network status:', status);\r\n      this.networkStatus.next(status.connected);\r\n      if (!status.connected) {\r\n        this.handleDisconnect();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Network status check failed, performing fallback check:', error);\r\n      // Fallback: try to make a simple network request with timeout\r\n      try {\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout\r\n        \r\n        await fetch('https://www.google.com/favicon.ico', { \r\n          method: 'HEAD',\r\n          mode: 'no-cors',\r\n          cache: 'no-cache',\r\n          signal: controller.signal\r\n        });\r\n        \r\n        clearTimeout(timeoutId);\r\n        this.networkStatus.next(true);\r\n        console.log('Fallback network check: connected');\r\n      } catch (fetchError) {\r\n        console.warn('Fallback network check failed:', fetchError);\r\n        // Be more conservative - assume connected if we can't determine\r\n        this.networkStatus.next(true);\r\n        console.log('Network status uncertain, assuming connected');\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleDisconnect() {\r\n    console.log('Disconnected from network');\r\n    // Handle the UI or logic when the network is disconnected\r\n  }\r\n\r\n  private handleReconnect() {\r\n    console.log('Reconnected to network');\r\n    // Handle the UI or logic when the network is reconnected\r\n  }\r\n\r\n  isConnected(): boolean {\r\n    return this.networkStatus.value;\r\n  }\r\n}\r\n","import { registerPlugin } from '@capacitor/core';\nconst App = registerPlugin('App', {\n    web: () => import('./web').then(m => new m.AppWeb()),\n});\nexport * from './definitions';\nexport { App };\n","import { registerPlugin } from '@capacitor/core';\nconst Geolocation = registerPlugin('Geolocation', {\n    web: () => import('./web').then(m => new m.GeolocationWeb()),\n});\nexport * from './definitions';\nexport { Geolocation };\n","import { CapacitorGoogleMaps } from './implementation';\nexport class LatLngBounds {\n    constructor(bounds) {\n        this.southwest = bounds.southwest;\n        this.center = bounds.center;\n        this.northeast = bounds.northeast;\n    }\n    async contains(point) {\n        const result = await CapacitorGoogleMaps.mapBoundsContains({\n            bounds: this,\n            point,\n        });\n        return result['contains'];\n    }\n    async extend(point) {\n        const result = await CapacitorGoogleMaps.mapBoundsExtend({\n            bounds: this,\n            point,\n        });\n        this.southwest = result['bounds']['southwest'];\n        this.center = result['bounds']['center'];\n        this.northeast = result['bounds']['northeast'];\n        return this;\n    }\n}\nexport var MapType;\n(function (MapType) {\n    /**\n     * Basic map.\n     */\n    MapType[\"Normal\"] = \"Normal\";\n    /**\n     * Satellite imagery with roads and labels.\n     */\n    MapType[\"Hybrid\"] = \"Hybrid\";\n    /**\n     * Satellite imagery with no labels.\n     */\n    MapType[\"Satellite\"] = \"Satellite\";\n    /**\n     * Topographic data.\n     */\n    MapType[\"Terrain\"] = \"Terrain\";\n    /**\n     * No base map tiles.\n     */\n    MapType[\"None\"] = \"None\";\n})(MapType || (MapType = {}));\n","import { registerPlugin } from '@capacitor/core';\nconst CapacitorGoogleMaps = registerPlugin('CapacitorGoogleMaps', {\n    web: () => import('./web').then(m => new m.CapacitorGoogleMapsWeb()),\n});\nCapacitorGoogleMaps.addListener('isMapInFocus', data => {\n    var _a;\n    const x = data.x;\n    const y = data.y;\n    const elem = document.elementFromPoint(x, y);\n    const internalId = (_a = elem === null || elem === void 0 ? void 0 : elem.dataset) === null || _a === void 0 ? void 0 : _a.internalId;\n    const mapInFocus = internalId === data.mapId;\n    CapacitorGoogleMaps.dispatchMapEvent({ id: data.mapId, focus: mapInFocus });\n});\nexport { CapacitorGoogleMaps };\n","/* eslint-disable @typescript-eslint/no-namespace */\nimport { LatLngBounds, MapType, } from './definitions';\nimport { GoogleMap } from './map';\nexport { GoogleMap, LatLngBounds, MapType, };\n","import { Capacitor } from '@capacitor/core';\nimport { LatLngBounds, MapType } from './definitions';\nimport { CapacitorGoogleMaps } from './implementation';\nclass MapCustomElement extends HTMLElement {\n    constructor() {\n        super();\n    }\n    connectedCallback() {\n        this.innerHTML = '';\n        if (Capacitor.getPlatform() == 'ios') {\n            this.style.overflow = 'scroll';\n            this.style['-webkit-overflow-scrolling'] = 'touch';\n            const overflowDiv = document.createElement('div');\n            overflowDiv.style.height = '200%';\n            this.appendChild(overflowDiv);\n        }\n    }\n}\ncustomElements.define('capacitor-google-map', MapCustomElement);\nexport class GoogleMap {\n    constructor(id) {\n        this.element = null;\n        this.resizeObserver = null;\n        this.handleScrollEvent = () => this.updateMapBounds();\n        this.id = id;\n    }\n    /**\n     * Creates a new instance of a Google Map\n     * @param options\n     * @param callback\n     * @returns GoogleMap\n     */\n    static async create(options, callback) {\n        const newMap = new GoogleMap(options.id);\n        if (!options.element) {\n            throw new Error('container element is required');\n        }\n        if (options.config.androidLiteMode === undefined) {\n            options.config.androidLiteMode = false;\n        }\n        newMap.element = options.element;\n        newMap.element.dataset.internalId = options.id;\n        const elementBounds = await GoogleMap.getElementBounds(options.element);\n        options.config.width = elementBounds.width;\n        options.config.height = elementBounds.height;\n        options.config.x = elementBounds.x;\n        options.config.y = elementBounds.y;\n        options.config.devicePixelRatio = window.devicePixelRatio;\n        if (Capacitor.getPlatform() == 'android') {\n            newMap.initScrolling();\n        }\n        if (Capacitor.isNativePlatform()) {\n            options.element = {};\n            const getMapBounds = () => {\n                var _a, _b;\n                const mapRect = (_b = (_a = newMap.element) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect()) !== null && _b !== void 0 ? _b : {};\n                return {\n                    x: mapRect.x,\n                    y: mapRect.y,\n                    width: mapRect.width,\n                    height: mapRect.height,\n                };\n            };\n            const onDisplay = () => {\n                CapacitorGoogleMaps.onDisplay({\n                    id: newMap.id,\n                    mapBounds: getMapBounds(),\n                });\n            };\n            const onResize = () => {\n                CapacitorGoogleMaps.onResize({\n                    id: newMap.id,\n                    mapBounds: getMapBounds(),\n                });\n            };\n            const ionicPage = newMap.element.closest('.ion-page');\n            if (Capacitor.getPlatform() === 'ios' && ionicPage) {\n                ionicPage.addEventListener('ionViewWillEnter', () => {\n                    setTimeout(() => {\n                        onDisplay();\n                    }, 100);\n                });\n                ionicPage.addEventListener('ionViewDidEnter', () => {\n                    setTimeout(() => {\n                        onDisplay();\n                    }, 100);\n                });\n            }\n            const lastState = {\n                width: elementBounds.width,\n                height: elementBounds.height,\n                isHidden: false,\n            };\n            newMap.resizeObserver = new ResizeObserver(() => {\n                if (newMap.element != null) {\n                    const mapRect = newMap.element.getBoundingClientRect();\n                    const isHidden = mapRect.width === 0 && mapRect.height === 0;\n                    if (!isHidden) {\n                        if (lastState.isHidden) {\n                            if (Capacitor.getPlatform() === 'ios' && !ionicPage) {\n                                onDisplay();\n                            }\n                        }\n                        else if (lastState.width !== mapRect.width ||\n                            lastState.height !== mapRect.height) {\n                            onResize();\n                        }\n                    }\n                    lastState.width = mapRect.width;\n                    lastState.height = mapRect.height;\n                    lastState.isHidden = isHidden;\n                }\n            });\n            newMap.resizeObserver.observe(newMap.element);\n        }\n        // small delay to allow for iOS WKWebView to setup corresponding element sub-scroll views ???\n        await new Promise((resolve, reject) => {\n            setTimeout(async () => {\n                try {\n                    await CapacitorGoogleMaps.create(options);\n                    resolve(undefined);\n                }\n                catch (err) {\n                    reject(err);\n                }\n            }, 200);\n        });\n        if (callback) {\n            const onMapReadyListener = await CapacitorGoogleMaps.addListener('onMapReady', (data) => {\n                if (data.mapId == newMap.id) {\n                    callback(data);\n                    onMapReadyListener.remove();\n                }\n            });\n        }\n        return newMap;\n    }\n    static async getElementBounds(element) {\n        return new Promise(resolve => {\n            let elementBounds = element.getBoundingClientRect();\n            if (elementBounds.width == 0) {\n                let retries = 0;\n                const boundsInterval = setInterval(function () {\n                    if (elementBounds.width == 0 && retries < 30) {\n                        elementBounds = element.getBoundingClientRect();\n                        retries++;\n                    }\n                    else {\n                        if (retries == 30) {\n                            console.warn('Map size could not be determined');\n                        }\n                        clearInterval(boundsInterval);\n                        resolve(elementBounds);\n                    }\n                }, 100);\n            }\n            else {\n                resolve(elementBounds);\n            }\n        });\n    }\n    /**\n     * Enable touch events on native map\n     *\n     * @returns void\n     */\n    async enableTouch() {\n        return CapacitorGoogleMaps.enableTouch({\n            id: this.id,\n        });\n    }\n    /**\n     * Disable touch events on native map\n     *\n     * @returns void\n     */\n    async disableTouch() {\n        return CapacitorGoogleMaps.disableTouch({\n            id: this.id,\n        });\n    }\n    /**\n     * Enable marker clustering\n     *\n     * @param minClusterSize - The minimum number of markers that can be clustered together.\n     * @defaultValue 4\n     *\n     * @returns void\n     */\n    async enableClustering(minClusterSize) {\n        return CapacitorGoogleMaps.enableClustering({\n            id: this.id,\n            minClusterSize,\n        });\n    }\n    /**\n     * Disable marker clustering\n     *\n     * @returns void\n     */\n    async disableClustering() {\n        return CapacitorGoogleMaps.disableClustering({\n            id: this.id,\n        });\n    }\n    /**\n     * Adds a marker to the map\n     *\n     * @param marker\n     * @returns created marker id\n     */\n    async addMarker(marker) {\n        const res = await CapacitorGoogleMaps.addMarker({\n            id: this.id,\n            marker,\n        });\n        return res.id;\n    }\n    /**\n     * Adds multiple markers to the map\n     *\n     * @param markers\n     * @returns array of created marker IDs\n     */\n    async addMarkers(markers) {\n        const res = await CapacitorGoogleMaps.addMarkers({\n            id: this.id,\n            markers,\n        });\n        return res.ids;\n    }\n    /**\n     * Remove marker from the map\n     *\n     * @param id id of the marker to remove from the map\n     * @returns\n     */\n    async removeMarker(id) {\n        return CapacitorGoogleMaps.removeMarker({\n            id: this.id,\n            markerId: id,\n        });\n    }\n    /**\n     * Remove markers from the map\n     *\n     * @param ids array of ids to remove from the map\n     * @returns\n     */\n    async removeMarkers(ids) {\n        return CapacitorGoogleMaps.removeMarkers({\n            id: this.id,\n            markerIds: ids,\n        });\n    }\n    async addPolygons(polygons) {\n        const res = await CapacitorGoogleMaps.addPolygons({\n            id: this.id,\n            polygons,\n        });\n        return res.ids;\n    }\n    async addPolylines(polylines) {\n        const res = await CapacitorGoogleMaps.addPolylines({\n            id: this.id,\n            polylines,\n        });\n        return res.ids;\n    }\n    async removePolygons(ids) {\n        return CapacitorGoogleMaps.removePolygons({\n            id: this.id,\n            polygonIds: ids,\n        });\n    }\n    async addCircles(circles) {\n        const res = await CapacitorGoogleMaps.addCircles({\n            id: this.id,\n            circles,\n        });\n        return res.ids;\n    }\n    async removeCircles(ids) {\n        return CapacitorGoogleMaps.removeCircles({\n            id: this.id,\n            circleIds: ids,\n        });\n    }\n    async removePolylines(ids) {\n        return CapacitorGoogleMaps.removePolylines({\n            id: this.id,\n            polylineIds: ids,\n        });\n    }\n    /**\n     * Destroy the current instance of the map\n     */\n    async destroy() {\n        var _a;\n        if (Capacitor.getPlatform() == 'android') {\n            this.disableScrolling();\n        }\n        if (Capacitor.isNativePlatform()) {\n            (_a = this.resizeObserver) === null || _a === void 0 ? void 0 : _a.disconnect();\n        }\n        this.removeAllMapListeners();\n        return CapacitorGoogleMaps.destroy({\n            id: this.id,\n        });\n    }\n    /**\n     * Update the map camera configuration\n     *\n     * @param config\n     * @returns\n     */\n    async setCamera(config) {\n        return CapacitorGoogleMaps.setCamera({\n            id: this.id,\n            config,\n        });\n    }\n    async getMapType() {\n        const { type } = await CapacitorGoogleMaps.getMapType({ id: this.id });\n        return MapType[type];\n    }\n    /**\n     * Sets the type of map tiles that should be displayed.\n     *\n     * @param mapType\n     * @returns\n     */\n    async setMapType(mapType) {\n        return CapacitorGoogleMaps.setMapType({\n            id: this.id,\n            mapType,\n        });\n    }\n    /**\n     * Sets whether indoor maps are shown, where available.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableIndoorMaps(enabled) {\n        return CapacitorGoogleMaps.enableIndoorMaps({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Controls whether the map is drawing traffic data, if available.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableTrafficLayer(enabled) {\n        return CapacitorGoogleMaps.enableTrafficLayer({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Show accessibility elements for overlay objects, such as Marker and Polyline.\n     *\n     * Only available on iOS.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableAccessibilityElements(enabled) {\n        return CapacitorGoogleMaps.enableAccessibilityElements({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Set whether the My Location dot and accuracy circle is enabled.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableCurrentLocation(enabled) {\n        return CapacitorGoogleMaps.enableCurrentLocation({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Set padding on the 'visible' region of the view.\n     *\n     * @param padding\n     * @returns\n     */\n    async setPadding(padding) {\n        return CapacitorGoogleMaps.setPadding({\n            id: this.id,\n            padding,\n        });\n    }\n    /**\n     * Get the map's current viewport latitude and longitude bounds.\n     *\n     * @returns {LatLngBounds}\n     */\n    async getMapBounds() {\n        return new LatLngBounds(await CapacitorGoogleMaps.getMapBounds({\n            id: this.id,\n        }));\n    }\n    async fitBounds(bounds, padding) {\n        return CapacitorGoogleMaps.fitBounds({\n            id: this.id,\n            bounds,\n            padding,\n        });\n    }\n    initScrolling() {\n        const ionContents = document.getElementsByTagName('ion-content');\n        // eslint-disable-next-line @typescript-eslint/prefer-for-of\n        for (let i = 0; i < ionContents.length; i++) {\n            ionContents[i].scrollEvents = true;\n        }\n        window.addEventListener('ionScroll', this.handleScrollEvent);\n        window.addEventListener('scroll', this.handleScrollEvent);\n        window.addEventListener('resize', this.handleScrollEvent);\n        if (screen.orientation) {\n            screen.orientation.addEventListener('change', () => {\n                setTimeout(this.updateMapBounds, 500);\n            });\n        }\n        else {\n            window.addEventListener('orientationchange', () => {\n                setTimeout(this.updateMapBounds, 500);\n            });\n        }\n    }\n    disableScrolling() {\n        window.removeEventListener('ionScroll', this.handleScrollEvent);\n        window.removeEventListener('scroll', this.handleScrollEvent);\n        window.removeEventListener('resize', this.handleScrollEvent);\n        if (screen.orientation) {\n            screen.orientation.removeEventListener('change', () => {\n                setTimeout(this.updateMapBounds, 1000);\n            });\n        }\n        else {\n            window.removeEventListener('orientationchange', () => {\n                setTimeout(this.updateMapBounds, 1000);\n            });\n        }\n    }\n    updateMapBounds() {\n        if (this.element) {\n            const mapRect = this.element.getBoundingClientRect();\n            CapacitorGoogleMaps.onScroll({\n                id: this.id,\n                mapBounds: {\n                    x: mapRect.x,\n                    y: mapRect.y,\n                    width: mapRect.width,\n                    height: mapRect.height,\n                },\n            });\n        }\n    }\n    /*\n    private findContainerElement(): HTMLElement | null {\n      if (!this.element) {\n        return null;\n      }\n  \n      let parentElement = this.element.parentElement;\n      while (parentElement !== null) {\n        if (window.getComputedStyle(parentElement).overflowY !== 'hidden') {\n          return parentElement;\n        }\n  \n        parentElement = parentElement.parentElement;\n      }\n  \n      return null;\n    }\n    */\n    /**\n     * Set the event listener on the map for 'onCameraIdle' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnCameraIdleListener(callback) {\n        if (this.onCameraIdleListener) {\n            this.onCameraIdleListener.remove();\n        }\n        if (callback) {\n            this.onCameraIdleListener = await CapacitorGoogleMaps.addListener('onCameraIdle', this.generateCallback(callback));\n        }\n        else {\n            this.onCameraIdleListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onBoundsChanged' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnBoundsChangedListener(callback) {\n        if (this.onBoundsChangedListener) {\n            this.onBoundsChangedListener.remove();\n        }\n        if (callback) {\n            this.onBoundsChangedListener = await CapacitorGoogleMaps.addListener('onBoundsChanged', this.generateCallback(callback));\n        }\n        else {\n            this.onBoundsChangedListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onCameraMoveStarted' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnCameraMoveStartedListener(callback) {\n        if (this.onCameraMoveStartedListener) {\n            this.onCameraMoveStartedListener.remove();\n        }\n        if (callback) {\n            this.onCameraMoveStartedListener = await CapacitorGoogleMaps.addListener('onCameraMoveStarted', this.generateCallback(callback));\n        }\n        else {\n            this.onCameraMoveStartedListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onClusterClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnClusterClickListener(callback) {\n        if (this.onClusterClickListener) {\n            this.onClusterClickListener.remove();\n        }\n        if (callback) {\n            this.onClusterClickListener = await CapacitorGoogleMaps.addListener('onClusterClick', this.generateCallback(callback));\n        }\n        else {\n            this.onClusterClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onClusterInfoWindowClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnClusterInfoWindowClickListener(callback) {\n        if (this.onClusterInfoWindowClickListener) {\n            this.onClusterInfoWindowClickListener.remove();\n        }\n        if (callback) {\n            this.onClusterInfoWindowClickListener =\n                await CapacitorGoogleMaps.addListener('onClusterInfoWindowClick', this.generateCallback(callback));\n        }\n        else {\n            this.onClusterInfoWindowClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onInfoWindowClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnInfoWindowClickListener(callback) {\n        if (this.onInfoWindowClickListener) {\n            this.onInfoWindowClickListener.remove();\n        }\n        if (callback) {\n            this.onInfoWindowClickListener = await CapacitorGoogleMaps.addListener('onInfoWindowClick', this.generateCallback(callback));\n        }\n        else {\n            this.onInfoWindowClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMapClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMapClickListener(callback) {\n        if (this.onMapClickListener) {\n            this.onMapClickListener.remove();\n        }\n        if (callback) {\n            this.onMapClickListener = await CapacitorGoogleMaps.addListener('onMapClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMapClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onPolygonClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnPolygonClickListener(callback) {\n        if (this.onPolygonClickListener) {\n            this.onPolygonClickListener.remove();\n        }\n        if (callback) {\n            this.onPolygonClickListener = await CapacitorGoogleMaps.addListener('onPolygonClick', this.generateCallback(callback));\n        }\n        else {\n            this.onPolygonClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onCircleClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnCircleClickListener(callback) {\n        if (this.onCircleClickListener)\n            [this.onCircleClickListener.remove()];\n        if (callback) {\n            this.onCircleClickListener = await CapacitorGoogleMaps.addListener('onCircleClick', this.generateCallback(callback));\n        }\n        else {\n            this.onCircleClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerClickListener(callback) {\n        if (this.onMarkerClickListener) {\n            this.onMarkerClickListener.remove();\n        }\n        if (callback) {\n            this.onMarkerClickListener = await CapacitorGoogleMaps.addListener('onMarkerClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onPolylineClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnPolylineClickListener(callback) {\n        if (this.onPolylineClickListener) {\n            this.onPolylineClickListener.remove();\n        }\n        if (callback) {\n            this.onPolylineClickListener = await CapacitorGoogleMaps.addListener('onPolylineClick', this.generateCallback(callback));\n        }\n        else {\n            this.onPolylineClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerDragStart' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerDragStartListener(callback) {\n        if (this.onMarkerDragStartListener) {\n            this.onMarkerDragStartListener.remove();\n        }\n        if (callback) {\n            this.onMarkerDragStartListener = await CapacitorGoogleMaps.addListener('onMarkerDragStart', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerDragStartListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerDrag' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerDragListener(callback) {\n        if (this.onMarkerDragListener) {\n            this.onMarkerDragListener.remove();\n        }\n        if (callback) {\n            this.onMarkerDragListener = await CapacitorGoogleMaps.addListener('onMarkerDrag', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerDragListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerDragEnd' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerDragEndListener(callback) {\n        if (this.onMarkerDragEndListener) {\n            this.onMarkerDragEndListener.remove();\n        }\n        if (callback) {\n            this.onMarkerDragEndListener = await CapacitorGoogleMaps.addListener('onMarkerDragEnd', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerDragEndListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMyLocationButtonClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMyLocationButtonClickListener(callback) {\n        if (this.onMyLocationButtonClickListener) {\n            this.onMyLocationButtonClickListener.remove();\n        }\n        if (callback) {\n            this.onMyLocationButtonClickListener =\n                await CapacitorGoogleMaps.addListener('onMyLocationButtonClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMyLocationButtonClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMyLocationClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMyLocationClickListener(callback) {\n        if (this.onMyLocationClickListener) {\n            this.onMyLocationClickListener.remove();\n        }\n        if (callback) {\n            this.onMyLocationClickListener = await CapacitorGoogleMaps.addListener('onMyLocationClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMyLocationClickListener = undefined;\n        }\n    }\n    /**\n     * Remove all event listeners on the map.\n     *\n     * @param callback\n     * @returns\n     */\n    async removeAllMapListeners() {\n        if (this.onBoundsChangedListener) {\n            this.onBoundsChangedListener.remove();\n            this.onBoundsChangedListener = undefined;\n        }\n        if (this.onCameraIdleListener) {\n            this.onCameraIdleListener.remove();\n            this.onCameraIdleListener = undefined;\n        }\n        if (this.onCameraMoveStartedListener) {\n            this.onCameraMoveStartedListener.remove();\n            this.onCameraMoveStartedListener = undefined;\n        }\n        if (this.onClusterClickListener) {\n            this.onClusterClickListener.remove();\n            this.onClusterClickListener = undefined;\n        }\n        if (this.onClusterInfoWindowClickListener) {\n            this.onClusterInfoWindowClickListener.remove();\n            this.onClusterInfoWindowClickListener = undefined;\n        }\n        if (this.onInfoWindowClickListener) {\n            this.onInfoWindowClickListener.remove();\n            this.onInfoWindowClickListener = undefined;\n        }\n        if (this.onMapClickListener) {\n            this.onMapClickListener.remove();\n            this.onMapClickListener = undefined;\n        }\n        if (this.onPolylineClickListener) {\n            this.onPolylineClickListener.remove();\n            this.onPolylineClickListener = undefined;\n        }\n        if (this.onMarkerClickListener) {\n            this.onMarkerClickListener.remove();\n            this.onMarkerClickListener = undefined;\n        }\n        if (this.onPolygonClickListener) {\n            this.onPolygonClickListener.remove();\n            this.onPolygonClickListener = undefined;\n        }\n        if (this.onCircleClickListener) {\n            this.onCircleClickListener.remove();\n            this.onCircleClickListener = undefined;\n        }\n        if (this.onMarkerDragStartListener) {\n            this.onMarkerDragStartListener.remove();\n            this.onMarkerDragStartListener = undefined;\n        }\n        if (this.onMarkerDragListener) {\n            this.onMarkerDragListener.remove();\n            this.onMarkerDragListener = undefined;\n        }\n        if (this.onMarkerDragEndListener) {\n            this.onMarkerDragEndListener.remove();\n            this.onMarkerDragEndListener = undefined;\n        }\n        if (this.onMyLocationButtonClickListener) {\n            this.onMyLocationButtonClickListener.remove();\n            this.onMyLocationButtonClickListener = undefined;\n        }\n        if (this.onMyLocationClickListener) {\n            this.onMyLocationClickListener.remove();\n            this.onMyLocationClickListener = undefined;\n        }\n    }\n    generateCallback(callback) {\n        const mapId = this.id;\n        return (data) => {\n            if (data.mapId == mapId) {\n                callback(data);\n            }\n        };\n    }\n}\n","import { Observable } from '../Observable';\nimport { async } from '../scheduler/async';\nimport { isNumeric } from '../util/isNumeric';\nexport function interval(period = 0, scheduler = async) {\n    if (!isNumeric(period) || period < 0) {\n        period = 0;\n    }\n    if (!scheduler || typeof scheduler.schedule !== 'function') {\n        scheduler = async;\n    }\n    return new Observable(subscriber => {\n        subscriber.add(scheduler.schedule(dispatch, period, { subscriber, counter: 0, period }));\n        return subscriber;\n    });\n}\nfunction dispatch(state) {\n    const { subscriber, counter, period } = state;\n    subscriber.next(counter);\n    this.schedule({ subscriber, counter: counter + 1, period }, period);\n}\n"],"names":["ElementRef","NgZone","Geolocation","AutocompleteComponent","Observable","interval","BehaviorSubject","Subscription","updateDoc","getDoc","collection","onSnapshot","doc","Firestore","query","where","EnrouteChatComponent","Network","App","AddCardComponent","switchMap","Preferences","onAuthStateChanged","TripSummaryComponent","i0","HomePage","constructor","auth","authService","router","networkService","map","nav","platform","firestore","database","ngZone","geocode","overlay","modalCtrl","alert","payME","toastController","actionSheetController","BOOKING","CONFIRM","TRACKING","SEARCHING","DRIVING","NO_DRIVER","MAP_PIN","NO_DRIVERS","initializeApp","ngOnDestroy","unsubscribe","window","removeEventListener","setMapHeight","bind","clearSubscriptions","clearPrevMarkers","clearAllPolylines","ngAfterViewInit","hasPermission","checkAndRequestLocationPermissions","initializeProfile","initializeNetworkMonitoring","fetchSavedPaymentMethods","EnterBookingStage","initializeGeolocation","initializeMap","initializeRideStateListener","e","console","error","hideLoader","showAlert","user","Promise","resolve","Error","profile","getUserProfile","log","userId","uid","email","createdAt","Date","toISOString","createUserProfile","ensureProfileInitialized","lastHandledState","requestsQuery","snapshot","empty","setStage","STAGES","activeRides","docs","currentRide","rideData","data","requestID","id","price","status","isAppInitialization","Loc_lat","Loc_lng","LatLng","lat","lng","Des_lat","Des_lng","D_LatLng","locationAddress","Rider_Location","destinationAddress","Rider_Destination","handlePendingState","handleRideConfirmation","handleRideStart","handleRideCancellation","code","handleRemovedRide","clearRideData","driverInfo","rideHasStarted","is","permissionStatus","checkPermissions","location","create","header","message","buttons","text","handler","newStatus","requestPermissions","showLocationRequiredAlert","backdropDismiss","present","role","onDidDismiss","navigator","permissions","name","then","result","state","showWebLocationPrompt","geolocation","getCurrentPosition","savedPaymentMethods","getSavedPaymentMethods","length","selectedCard","cash","cardId","chooseCard","event","detail","value","processPayment","amount","showLoader","paymentResult","processPaymentWithCardId","toPromise","errorMessage","showPaymentErrorModal","modal","component","onWillDismiss","newCardId","setMapContainerHeight","extraPadding","mapRef","topBar","bottomBar","topHeight","nativeElement","offsetHeight","bottomHeight","availableHeight","innerHeight","style","height","top","position","zIndex","left","right","setMapHeightCreateAndAddMarkers","setMapHeightHandleDrivertoRider","setMapHeightHandleDrivertoDestination","ResetMapHeight","getStatus","isConnected","connected","networkStatus$","next","addListener","subscribe","navigate","ready","coordinates","timeout","reject","coords","latitude","longitude","accuracy","altitude","altitudeAccuracy","heading","speed","timestamp","updateLocation","startPollingPosition","startPermissionPolling","permissionCheckInterval","setInterval","clearInterval","lastLatLng","lastAddress","pollingInterval","newLatLng","hasSignificantLocationChange","address","getAddress","results","components","address_components","long_name","actualLocation","formatted_address","stopPolling","center","radiusInM","fetchAndDisplayDrivers","err","oldLatLng","minDistance","R","1","Math","PI","2","","","a","sin","cos","c","atan2","sqrt","distance","stopPollingPosition","warn","now","createMap","mapy","initializeDatabaseSubscriptions","getKnownPlaces","d","places","slice","initializeBackButtonCustomHandler","backButton","subscribeWithPriority","canGoBack","confirm","exitApp","history","back","setupMapListeners","newMap","setOnCameraIdleListener","g","run","showResetLocationButton","mapPinStage","addressResponse","processAddressResponse","logout","drivers","checkDriversWithin","handleDrivers","drivers_Requested","current_Request_Number","UpdateCarMarker","NoDrivers","closeDrivers","forEach","driver","duration","onlineState","push","updateDriverInfo","min","cleanupListeners","Object","values","activeListeners","carname","Driver_car","driverImage","Driver_imgUrl","driver_duration_apart","ceil","driver_ID","Driver_id","driver_number_of_seats","seats","DriverLatLng","Driver_lat","Driver_lng","StartRide","isLoadingDriver","all","enableTouch","BookRide","clearMarkers","marker1","removeMarker","marker2","toString","_carmarkers","marker","hasValidDriver","showNoDriversAlert","userDocRef","docSnapshot","exists","handleNoAvailableDriver","requestRideWithDriverDetails","requestDetails","latLng","dLatLng","driverId","RequestRideWithRiderDetails","currentDriver","rideRequestDocRef","unsub","handleRideUpdates","routeUpdateSubscription","numCalls","countDown","animatedMarker","handleRideStop","ReturnHome","locationPromise","getDriverLocation","timeoutPromise","_","setTimeout","race","clearPolyline","newPoly","setCamera","animate","animationDuration","zoom","coordinate","handleDriverToRider","EnterSearchingStage","startCountdown","presentCancelRideActionSheet","actionSheet","cancelRide","reason","rideRef","cancellationReason","canceledBy","toast","stopCountdown","ClearRide","driverDetails","driverDoc","addEventListener","mapError","driverLocationFetched","driverLocation","locationError","driver_lat","driver_lng","EnterDrivingToDestinationStage","canCheck","handleRiderToDestination","visualError","isRideStopProcessed","attempt","docData","tripId","driverName","Driver_name","driverCar","driverPlate","Driver_plate","pickup","destination","rating","Driver_rating","completed","completedAt","remove","key","RIDE_STATE_KEY","componentProps","clearRideState","driver_marker","rider_marker","destinationMarker","routePolyline","routePath","bookingStage","confirmStage","trackingStage","searchingStage","noDriverStage","drivingToDestinationStage","enableCurrentLocation","docOrData","docId","requestId","EnterTrackingStage","saveRideStateToStorage","rideState","stage","getCurrentStage","set","JSON","stringify","catch","EnterChat","options","swipeToClose","initialTime","countdownActive","timeRemaining","updateCountdown","UpdateCountDown","handleCountdownEnd","requestNextDriver","goBackToAutoComplete","ResetState","showAutocompleteModal","markers","clearPromises","filter","undefined","clearMarker","removePolylines","actualDestination","pinOnMap","EnterMapPinStage","mapPinDrag","home","searching","AddKnownPlace","full","whole","getLatLng","description","geometry","getDistanceAndDirections","RequestRide","dat","place","EnterNoDriverStage","EnterConfirmStage","origin1","google","maps","origin2","request","origin","travelMode","TravelMode","directions","route","response","direction","routes","legs","bounds","getPriceEstimate","createAndAddMarkers","getDistanceAndDirectionsDriver","D_duration","resetLocation","addressComponents","elements","LatLngBounds","driverMap","Map","element","updatedMarkers","get","latlng","extend","existingMarkerIndex","findIndex","mapDim","width","offsetWidth","minZoom","maxZoom","zoomLevel","getBoundsZoomLevel","max","getCenter","fitBounds","GoHome","GotoSupport","navigateForward","CancelRide","riderCleared","currentUser","riderDocRef","currentRequestId","bearing","CallDriver","driverLatLng","riderLatLng","markerSize","iconAnchor","x","y","driverMarker","addMarker","iconUrl","title","iconSize","riderMarker","photoURL","updateRoute","path","overview_path","locs","geoCode","calculateCenter","adjustedZoomLevel","setCameraToLocation","calculateBearing","addPolyline","animateMarker","routeUpdate$","UPDATE_INTERVAL","pipe","polylineId","destinationLatLng","iconOrigin","loc","des","polylineColor","polylines","strokeColor","strokeWeight","geodesic","addedPolylines","addPolylines","Array","isArray","disableTouch","lastMarker","i","ShowDriverInfoPop","ngOnInit","navigation","getCurrentNavigation","extras","mapLoadedSubscription","mapLoadedSubject","loaded","processBookAgainData","addLocationMarker","geocodeService","geocodeAddress","addDestinationMarker","drawRoute","calculatePrice","toastCtrl","color","selectors","viewQuery","ctx","environment","of","HttpParams","catchError","GeocodeService","client","http","DistanceMatrixService","DirectionsService","url","apiUrl","params","apiKey","getDirections","from","to","getDistanceMatrix","distanceMatrixService","observer","origins","destinations","complete","factory","providedIn","GoogleMap","MapService","_map","ref","config","styles","scaleControl","streetViewControl","rotateControl","fullscreenControl","enableTrafficLayer","destroyMap","destroy","points","latitudes","p","longitudes","avgLat","reduce","b","avgLng","WORLD_DIM","ZOOM_MAX","latRad","radX2","mapPx","worldPx","fraction","floor","LN2","ne","getNorthEast","sw","getSouthWest","latFraction","lngDiff","lngFraction","latZoom","lngZoom","start","end","startLat","startLng","endLat","endLng","dLng","NetworkService","networkStatus","asObservable","initializeNetworkListener","handleReconnect","handleDisconnect","checkInitialNetworkStatus","controller","AbortController","timeoutId","abort","fetch","method","mode","cache","signal","clearTimeout","fetchError","registerPlugin","web","m","AppWeb","GeolocationWeb","CapacitorGoogleMaps","southwest","northeast","contains","point","mapBoundsContains","mapBoundsExtend","MapType","CapacitorGoogleMapsWeb","_a","elem","document","elementFromPoint","internalId","dataset","mapInFocus","mapId","dispatchMapEvent","focus","Capacitor","MapCustomElement","HTMLElement","connectedCallback","innerHTML","getPlatform","overflow","overflowDiv","createElement","appendChild","customElements","define","resizeObserver","handleScrollEvent","updateMapBounds","callback","androidLiteMode","elementBounds","getElementBounds","devicePixelRatio","initScrolling","isNativePlatform","getMapBounds","_b","mapRect","getBoundingClientRect","onDisplay","mapBounds","onResize","ionicPage","closest","lastState","isHidden","ResizeObserver","observe","onMapReadyListener","retries","boundsInterval","enableClustering","minClusterSize","disableClustering","res","addMarkers","ids","markerId","removeMarkers","markerIds","addPolygons","polygons","removePolygons","polygonIds","addCircles","circles","removeCircles","circleIds","polylineIds","disableScrolling","disconnect","removeAllMapListeners","getMapType","type","setMapType","mapType","enableIndoorMaps","enabled","enableAccessibilityElements","setPadding","padding","ionContents","getElementsByTagName","scrollEvents","screen","orientation","onScroll","onCameraIdleListener","generateCallback","setOnBoundsChangedListener","onBoundsChangedListener","setOnCameraMoveStartedListener","onCameraMoveStartedListener","setOnClusterClickListener","onClusterClickListener","setOnClusterInfoWindowClickListener","onClusterInfoWindowClickListener","setOnInfoWindowClickListener","onInfoWindowClickListener","setOnMapClickListener","onMapClickListener","setOnPolygonClickListener","onPolygonClickListener","setOnCircleClickListener","onCircleClickListener","setOnMarkerClickListener","onMarkerClickListener","setOnPolylineClickListener","onPolylineClickListener","setOnMarkerDragStartListener","onMarkerDragStartListener","setOnMarkerDragListener","onMarkerDragListener","setOnMarkerDragEndListener","onMarkerDragEndListener","setOnMyLocationButtonClickListener","onMyLocationButtonClickListener","setOnMyLocationClickListener","onMyLocationClickListener","async","isNumeric","period","scheduler","schedule","subscriber","add","dispatch","counter"],"sourceRoot":"webpack:///","x_google_ignoreList":[7,8,9,10,11,12,13]}