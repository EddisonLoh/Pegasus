{"version":3,"file":"src_app_pages_payment_payment_module_ts.js","mappings":"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","sources":["./src/app/pages/payment/payment-routing.module.ts","./src/app/pages/payment/payment.module.ts","./src/app/pages/payment/payment.page.ts","./src/app/pages/payment/payment.page.html"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { PaymentPage } from './payment.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: PaymentPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class PaymentPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { PaymentPageRoutingModule } from './payment-routing.module';\r\nimport { PaymentPage } from './payment.page';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    PaymentPageRoutingModule,\r\n    TranslateModule.forChild()\r\n  ],\r\n  declarations: [PaymentPage]\r\n})\r\nexport class PaymentPageModule {}\r\n","import { Component, OnInit, AfterViewInit, ViewChild, ElementRef } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { AlertController, LoadingController } from '@ionic/angular';\r\nimport { PaymentService } from '../../services/payment.service';\r\nimport { AvatarService } from '../../services/avatar.service';\r\nimport { Router } from '@angular/router';\r\nimport { Card } from 'src/app/interfaces/card';\r\nimport { TranslateService } from '@ngx-translate/core';\r\n\r\ndeclare var Stripe: any;\r\n\r\n@Component({\r\n  selector: 'app-payment',\r\n  templateUrl: './payment.page.html',\r\n  styleUrls: ['./payment.page.scss'],\r\n})\r\nexport class PaymentPage implements OnInit, AfterViewInit {\r\n  @ViewChild('cardElement', { static: false }) cardElement: ElementRef;\r\n  paymentForm: FormGroup;\r\n  loading: HTMLIonLoadingElement;\r\n  stripe: any;\r\n  elements: any;\r\n  card: any;\r\n  approve: boolean = false;\r\n  cardInitialized: boolean = false;\r\n  selectedProvider: string = '';\r\n  savedPaymentMethods: Card[] = [];\r\n  selectedCardId: string = '';\r\n  defaultAmount: number = 1000;\r\n  isCardComplete: boolean = false; // New state for card completion\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private alertController: AlertController,\r\n    private loadingController: LoadingController,\r\n    private paymentService: PaymentService,\r\n    private avatarService: AvatarService,\r\n    private translate: TranslateService\r\n  ) {\r\n    this.paymentForm = this.fb.group({\r\n      provider: ['', Validators.required],\r\n      cardId: [''],\r\n      authCode: ['']\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.fetchSavedPaymentMethods();\r\n    this.onPaymentProviderChange('stripe');\r\n    this.getActiveCard();\r\n  }\r\n\r\n  ngAfterViewInit() {}\r\n\r\n  // Ensure Stripe card is initialized\r\n  initializeStripeCard() {\r\n    if (this.cardElement && this.cardElement.nativeElement) {\r\n      this.stripe = Stripe('pk_test_51SShK5PRgzt7CIyewdombVyUyoBjYRQGrw8uBfWOF58l49mTcKZzWoeeyeBrjcsLT8NzCDKKjbwZQfDnNnpFzoxn00ivj0cGEe');\r\n      this.elements = this.stripe.elements();\r\n      if (!this.card) {\r\n        this.card = this.elements.create('card');\r\n        this.card.mount(this.cardElement.nativeElement);\r\n        // Listen for changes on the card input\r\n        this.card.on('change', event => {\r\n          this.isCardComplete = event.complete;\r\n        });\r\n      }\r\n      this.cardInitialized = true;\r\n    }\r\n  }\r\n\r\n  onPaymentProviderChange(provider: string) {\r\n    this.selectedProvider = provider;\r\n    this.paymentForm.patchValue({ provider });\r\n\r\n    if (provider === 'stripe') {\r\n      setTimeout(() => {\r\n        this.initializeStripeCard();\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  async fetchSavedPaymentMethods() {\r\n    try {\r\n      this.savedPaymentMethods = await this.avatarService.getSavedPaymentMethods();\r\n      console.log('Saved Payment Methods:', this.savedPaymentMethods);\r\n      if (this.savedPaymentMethods.length > 0) {\r\n        this.selectedCardId = this.savedPaymentMethods[0].cardId; // Set default selected card\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching saved payment methods:', error);\r\n    }\r\n  }\r\n\r\n  async getActiveCard() {\r\n    const email = this.avatarService.user.email;\r\n    this.avatarService.getActiveCard(email).subscribe((data: any) => {\r\n      if (data && data.activeCardId) {\r\n        this.selectedCardId = data.activeCardId;\r\n      }\r\n    });\r\n  }\r\n\r\n  async setActiveCard(event: any) {\r\n    const cardId = event.detail.value;\r\n    if (cardId) {\r\n      try {\r\n        const email = this.avatarService.user.email;\r\n        await this.avatarService.setActiveCard(email, cardId);\r\n        this.selectedCardId = cardId;\r\n      } catch (error) {\r\n        console.error('Error setting active card:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  async processPayment() {\r\n    if (this.paymentForm.valid) {\r\n      const formValues = this.paymentForm.value;\r\n      formValues.email = this.avatarService.user.email; // Use email from avatarService\r\n  \r\n      this.showLoading();\r\n  \r\n      try {\r\n        const cardData = await this.processStripePayment(formValues);\r\n\r\n        console.log('Card added successfully:', cardData);\r\n        await this.showAlert('Success', 'Card added successfully!');\r\n        \r\n        // Refresh the saved payment methods list to show the new card\r\n        await this.fetchSavedPaymentMethods();\r\n        \r\n        // Clear the card input after successful addition\r\n        if (this.card) {\r\n          this.card.clear();\r\n        }\r\n  \r\n      } catch (error) {\r\n        console.error('Error adding card:', error);\r\n        const errorMessage = error.error ? error.error.error : 'An unexpected error occurred.';\r\n        await this.showAlert('Error', `Failed to add card: ${errorMessage}`);\r\n      } finally {\r\n        this.hideLoading();\r\n        this.approve = false;\r\n      }\r\n    } else {\r\n      this.showAlert('Form Error', 'Please fill out all required fields.');\r\n    }\r\n  }\r\n\r\n  async processStripePayment(formValues) {\r\n    console.log('Starting processStripePayment with formValues:', formValues);\r\n  \r\n    try {\r\n      const setupIntentResponse = await this.paymentService.createSetupIntent(formValues.email).toPromise();\r\n      console.log('Setup Intent raw response:', setupIntentResponse);\r\n      const resp: any = setupIntentResponse;\r\n      const clientSecret = resp && (resp.client_secret || resp.clientSecret || resp.clientSecretValue || resp.secret);\r\n      console.log('Resolved clientSecret:', clientSecret);\r\n\r\n      // Validate clientSecret looks like a client secret (contains the secret part)\r\n      if (!clientSecret) {\r\n        console.error('No client_secret returned from server. Response:', setupIntentResponse);\r\n        throw new Error('No client_secret returned from server for SetupIntent.');\r\n      }\r\n      // A client secret normally contains \"_secret_\"; if we only received an ID like 'seti_...'\r\n      // that's likely the server returned the SetupIntent id instead of the client_secret.\r\n      if (String(clientSecret).startsWith('seti_') && !String(clientSecret).includes('_secret_')) {\r\n        console.error('Client secret looks like a SetupIntent ID (missing secret). Did the server return the ID instead of the client_secret?),', clientSecret);\r\n        throw new Error('Invalid client_secret returned from server (looks like an ID). Ensure server returns the full client_secret.');\r\n      }\r\n  \r\n      const { setupIntent, error } = await this.stripe.confirmCardSetup(\r\n        clientSecret,\r\n        {\r\n          payment_method: {\r\n            card: this.card,\r\n            billing_details: {\r\n              email: formValues.email,\r\n            },\r\n          },\r\n        }\r\n      );\r\n  \r\n      if (error) {\r\n        console.error('Stripe confirmCardSetup returned error object:', error);\r\n        const errorElement = document.getElementById('card-errors');\r\n        if (errorElement) {\r\n          errorElement.textContent = error.message;\r\n        }\r\n        await this.showAlert('Payment Error', error.message);\r\n        this.approve = false;\r\n        console.error('Error confirming card setup:', error);\r\n        throw new Error(error.message);\r\n      }\r\n  \r\n      console.log('Card setup confirmed:', setupIntent);\r\n  \r\n      const paymentMethodId = setupIntent.payment_method;\r\n  \r\n      // Fetch the payment method details from your server (which will call Stripe)\r\n      const paymentMethod = await this.paymentService.retrievePaymentMethod(paymentMethodId).toPromise();\r\n      console.log('Payment method retrieved:', paymentMethod);\r\n  \r\n      const cardDetails = paymentMethod.card;\r\n      const last4 = cardDetails.last4;\r\n      const brand = cardDetails.brand; // Get card brand (visa, mastercard, etc.)\r\n  \r\n      console.log('Checking if card exists with email:', formValues.email, ' and last4:', last4);\r\n      const cardExists = await this.avatarService.checkCardExistsStripe(formValues.email, last4);\r\n      \r\n      if (cardExists) {\r\n        throw new Error('This card is already saved to your account.');\r\n      }\r\n      \r\n      // Save card to Firestore using the correct method\r\n      const cardData = {\r\n        cardId: paymentMethodId,\r\n        email: formValues.email,\r\n        last4: last4,\r\n        brand: brand || 'unknown'\r\n      };\r\n      \r\n      await this.avatarService.saveCard(cardData);\r\n      console.log('Card saved to Firestore:', cardData);\r\n      \r\n      // Also save to backend if needed\r\n      await this.paymentService.savePaymentMethod(formValues.email, paymentMethodId).toPromise();\r\n  \r\n      return cardData;\r\n  \r\n    } catch (error) {\r\n      console.error('Error in processStripePayment:', error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  async deletePaymentMethod(cardId: string) {\r\n    await this.avatarService.deleteSavedPaymentMethod(cardId);\r\n    this.fetchSavedPaymentMethods(); // Refresh the list of saved payment methods\r\n  }\r\n\r\n  async showLoading() {\r\n    this.loading = await this.loadingController.create({\r\n      message: await this.translate.get('PAYMENT.PROCESSING').toPromise(),\r\n    });\r\n    await this.loading.present();\r\n  }\r\n\r\n  async hideLoading() {\r\n    if (this.loading) {\r\n      await this.loading.dismiss();\r\n    }\r\n  }\r\n\r\n  async showAlert(header: string, message: string) {\r\n    const alert = await this.alertController.create({\r\n      header: await this.translate.get(header).toPromise(),\r\n      message: await this.translate.get(message).toPromise(),\r\n      buttons: ['OK'],\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  changeLanguage(lang: string) {\r\n    this.translate.use(lang);\r\n  }\r\n}\r\n","<ion-header class=\"ion-no-border\" [translucent]=\"true\">\r\n  <ion-toolbar>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-button color=\"primary\">\r\n        <ion-back-button></ion-back-button>\r\n      </ion-button>\r\n    </ion-buttons>\r\n    <ion-title>{{ 'PAYMENT.TITLE' | translate }}</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-text-center ion-padding\">\r\n  <ion-card class=\"ion-no-border no-shadow\">\r\n    <ion-card-content class=\"no-shadow\">\r\n      <div class=\"payment-details\" [ngClass]=\"{'slide-down': selectedProvider !== ''}\">\r\n        <form [formGroup]=\"paymentForm\" (ngSubmit)=\"processPayment()\">\r\n          <div *ngIf=\"selectedProvider === 'stripe'\">\r\n            <div #cardElement class=\"stripe-element\"></div>\r\n            <div id=\"card-errors\" role=\"alert\"></div>\r\n          </div>\r\n          <ion-button color=\"success\" shape=\"round\" expand=\"block\" size=\"large\" type=\"submit\" \r\n          [disabled]=\"!paymentForm.valid || !isCardComplete\">\r\n            {{ 'PAYMENT.ADD_CARD' | translate }}\r\n          </ion-button>\r\n        </form>\r\n      </div>\r\n    </ion-card-content>\r\n  </ion-card>\r\n\r\n  <ion-card *ngIf=\"savedPaymentMethods.length > 0\" class=\"no-shadow\">\r\n    <ion-card-header>\r\n      <ion-card-title>{{ 'PAYMENT.SAVED_METHODS' | translate }}</ion-card-title>\r\n    </ion-card-header>\r\n    <ion-card-content class=\"no-shadow\">\r\n      <ion-radio-group [(ngModel)]=\"selectedCardId\" (ionChange)=\"setActiveCard($event)\">\r\n        <ion-item *ngFor=\"let method of savedPaymentMethods\">\r\n          <ion-icon name=\"card-outline\" slot=\"start\" color=\"primary\"></ion-icon>\r\n          <ion-label>\r\n            <h2>{{ method.brand ? (method.brand | uppercase) : 'Card' }}</h2>\r\n            <p>**** **** **** {{ method.last4 }}</p>\r\n          </ion-label>\r\n          <ion-radio slot=\"end\" [value]=\"method.cardId\"></ion-radio>\r\n          <ion-button slot=\"end\" fill=\"clear\" color=\"danger\" (click)=\"deletePaymentMethod(method.cardId)\">\r\n            <ion-icon name=\"trash-outline\"></ion-icon>\r\n          </ion-button>\r\n        </ion-item>\r\n      </ion-radio-group>\r\n    </ion-card-content>\r\n  </ion-card>\r\n\r\n  <!-- Add language switcher -->\r\n  <ion-fab vertical=\"bottom\" horizontal=\"end\" slot=\"fixed\">\r\n    <ion-fab-button>\r\n      <ion-icon name=\"globe\"></ion-icon>\r\n    </ion-fab-button>\r\n    <ion-fab-list side=\"top\">\r\n      <ion-fab-button (click)=\"changeLanguage('en')\">\r\n        <ion-img src=\"https://cdn.kcak11.com/CountryFlags/countries/us.svg\" style=\"width: 24px; height: 24px;\"></ion-img>\r\n      </ion-fab-button>\r\n      <ion-fab-button (click)=\"changeLanguage('ar')\">\r\n        <ion-img src=\"https://cdn.kcak11.com/CountryFlags/countries/sa.svg\" style=\"width: 24px; height: 24px;\"></ion-img>\r\n      </ion-fab-button>\r\n    </ion-fab-list>\r\n  </ion-fab>\r\n</ion-content>\r\n"],"names":["ElementRef","Validators","i0","PaymentPage","constructor","fb","alertController","loadingController","paymentService","avatarService","translate","paymentForm","group","provider","required","cardId","authCode","ngOnInit","fetchSavedPaymentMethods","onPaymentProviderChange","getActiveCard","ngAfterViewInit","initializeStripeCard","cardElement","nativeElement","stripe","Stripe","elements","card","create","mount","on","event","isCardComplete","complete","cardInitialized","selectedProvider","patchValue","setTimeout","savedPaymentMethods","getSavedPaymentMethods","console","log","length","selectedCardId","error","email","user","subscribe","data","activeCardId","setActiveCard","detail","value","processPayment","valid","formValues","showLoading","cardData","processStripePayment","showAlert","clear","errorMessage","hideLoading","approve","setupIntentResponse","createSetupIntent","toPromise","resp","clientSecret","client_secret","clientSecretValue","secret","Error","String","startsWith","includes","setupIntent","confirmCardSetup","payment_method","billing_details","errorElement","document","getElementById","textContent","message","paymentMethodId","paymentMethod","retrievePaymentMethod","cardDetails","last4","brand","cardExists","checkCardExistsStripe","saveCard","savePaymentMethod","deletePaymentMethod","deleteSavedPaymentMethod","loading","get","present","dismiss","header","alert","buttons","changeLanguage","lang","use","selectors","viewQuery","ctx"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}